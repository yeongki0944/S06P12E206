/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{1055:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)}),c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,c){function d(e){try{h(r.next(e))}catch(e){c(e)}}function l(e){try{h(r.throw(e))}catch(e){c(e)}}function h(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,l)}h((r=r.apply(e,t||[])).next())}))},d=this&&this.__generator||function(e,body){var t,n,r,g,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return g={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function c(c){return function(d){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(r=2&c[0]?n.return:c[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,c[1])).done)return r;switch(n=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,n=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){o.label=c[1];break}if(6===c[0]&&o.label<r[1]){o.label=r[1],r=c;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(c);break}r[2]&&o.ops.pop(),o.trys.pop();continue}c=body.call(e,o)}catch(e){c=[6,e],n=0}finally{t=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,d])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Publisher=void 0;var l,h=n(990),f=n(1056),m=n(1059),v=n(1065),E=n(803),y=n(1063),S=n(804),w=n(452),O=n(568),C=w.OpenViduLogger.getInstance(),I=function(e){function t(t,n,r){var o=e.call(this,new f.Stream(r.session?r.session:new h.Session(r),{publisherProperties:n,mediaConstraints:{}}),t)||this;return o.accessAllowed=!1,o.isSubscribedToRemote=!1,o.accessDenied=!1,l=O.PlatformUtils.getInstance(),o.properties=n,o.openvidu=r,o.stream.ee.on("local-stream-destroyed",(function(e){o.stream.isLocalStreamPublished=!1;var t=new v.StreamEvent(!0,o,"streamDestroyed",o.stream,e);o.emitEvent("streamDestroyed",[t]),t.callDefaultBehavior()})),o}return o(t,e),t.prototype.publishAudio=function(e){var t=this;this.stream.audioActive!==e&&((this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream()).getAudioTracks().forEach((function(track){track.enabled=e})),this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"audioActive",newValue:e,reason:"publishAudio"},(function(n,r){n?C.error("Error sending 'streamPropertyChanged' event",n):(t.session.emitEvent("streamPropertyChanged",[new E.StreamPropertyChangedEvent(t.session,t.stream,"audioActive",e,!e,"publishAudio")]),t.emitEvent("streamPropertyChanged",[new E.StreamPropertyChangedEvent(t,t.stream,"audioActive",e,!e,"publishAudio")]),t.session.sendVideoData(t.stream.streamManager))})),this.stream.audioActive=e,C.info("'Publisher' has "+(e?"published":"unpublished")+" its audio stream"))},t.prototype.publishVideo=function(e){var t=this;this.stream.videoActive!==e&&((this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream()).getVideoTracks().forEach((function(track){track.enabled=e})),this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"videoActive",newValue:e,reason:"publishVideo"},(function(n,r){n?C.error("Error sending 'streamPropertyChanged' event",n):(t.session.emitEvent("streamPropertyChanged",[new E.StreamPropertyChangedEvent(t.session,t.stream,"videoActive",e,!e,"publishVideo")]),t.emitEvent("streamPropertyChanged",[new E.StreamPropertyChangedEvent(t,t.stream,"videoActive",e,!e,"publishVideo")]),t.session.sendVideoData(t.stream.streamManager))})),this.stream.videoActive=e,C.info("'Publisher' has "+(e?"published":"unpublished")+" its video stream"))},t.prototype.subscribeToRemote=function(e){e=void 0===e||e,this.isSubscribedToRemote=e,this.stream.subscribeToMyRemote(e)},t.prototype.on=function(t,n){var r=this;return e.prototype.on.call(this,t,n),"streamCreated"===t&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new v.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.on("stream-created-by-publisher",(function(){r.emitEvent("streamCreated",[new v.StreamEvent(!1,r,"streamCreated",r.stream,"")])}))),"remoteVideoPlaying"===t&&this.stream.displayMyRemote()&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&this.emitEvent("remoteVideoPlaying",[new y.VideoElementEvent(this.videos[0].video,this,"remoteVideoPlaying")]),"accessAllowed"===t&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),"accessDenied"===t&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},t.prototype.once=function(t,n){var r=this;return e.prototype.once.call(this,t,n),"streamCreated"===t&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new v.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.once("stream-created-by-publisher",(function(){r.emitEvent("streamCreated",[new v.StreamEvent(!1,r,"streamCreated",r.stream,"")])}))),"remoteVideoPlaying"===t&&this.stream.displayMyRemote()&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&this.emitEvent("remoteVideoPlaying",[new y.VideoElementEvent(this.videos[0].video,this,"remoteVideoPlaying")]),"accessAllowed"===t&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),"accessDenied"===t&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},t.prototype.replaceTrack=function(track){return c(this,void 0,void 0,(function(){var e,t,n,r,o=this;return d(this,(function(c){switch(c.label){case 0:e=function(){return new Promise((function(e,t){var n,r=o.stream.displayMyRemote()?o.stream.localMediaStreamWhenSubscribedToRemote:o.stream.getMediaStream();n="video"===track.kind?r.getVideoTracks()[0]:r.getAudioTracks()[0],r.removeTrack(n),n.stop(),r.addTrack(track),"video"===track.kind&&o.stream.isLocalStreamPublished&&(o.openvidu.sendNewVideoDimensionsIfRequired(o,"trackReplaced",50,30),o.session.sendVideoData(o.stream.streamManager,5,!0,5)),e()}))},t=function(){return new Promise((function(e,t){var n,r=o.stream.getRTCPeerConnection().getSenders();if("video"===track.kind){if(!(n=r.find((function(s){return!!s.track&&"video"===s.track.kind}))))return void t(new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object"))}else{if("audio"!==track.kind)return void t(new Error("Unknown track kind "+track.kind));if(!(n=r.find((function(s){return!!s.track&&"audio"===s.track.kind}))))return void t(new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object"))}n.replaceTrack(track).then((function(){e()})).catch((function(e){t(e)}))}))},n=track.enabled,"video"===track.kind?track.enabled=this.stream.videoActive:"audio"===track.kind&&(track.enabled=this.stream.audioActive),c.label=1;case 1:return c.trys.push([1,7,,8]),this.stream.isLocalStreamPublished?[4,t()]:[3,4];case 2:return c.sent(),[4,e()];case 3:return[2,c.sent()];case 4:return[4,e()];case 5:return[2,c.sent()];case 6:return[3,8];case 7:throw r=c.sent(),track.enabled=n,r;case 8:return[2]}}))}))},t.prototype.initialize=function(){var e=this;return new Promise((function(t,n){var r,o={},c={},d=1500,h=function(t){e.accessDenied=!0,e.accessAllowed=!1,C.error("Publisher initialization failed. "+t.name+": "+t.message),n(t)},f=function(n){if(e.accessAllowed=!0,e.accessDenied=!1,"undefined"!=typeof MediaStreamTrack&&e.properties.audioSource instanceof MediaStreamTrack&&(n.removeTrack(n.getAudioTracks()[0]),n.addTrack(e.properties.audioSource)),"undefined"!=typeof MediaStreamTrack&&e.properties.videoSource instanceof MediaStreamTrack&&(n.removeTrack(n.getVideoTracks()[0]),n.addTrack(e.properties.videoSource)),n.getAudioTracks()[0]){var r=void 0!==e.stream.audioActive&&null!==e.stream.audioActive?e.stream.audioActive:!!e.stream.outboundStreamOpts.publisherProperties.publishAudio;n.getAudioTracks()[0].enabled=r}if(n.getVideoTracks()[0]){r=void 0!==e.stream.videoActive&&null!==e.stream.videoActive?e.stream.videoActive:!!e.stream.outboundStreamOpts.publisherProperties.publishVideo;n.getVideoTracks()[0].enabled=r}e.initializeVideoReference(n),e.stream.displayMyRemote()||e.stream.updateMediaStreamInVideos(),delete e.firstVideoElement,e.stream.isSendVideo()?e.getVideoDimensions(n).then((function(t){e.stream.videoDimensions={width:t.width,height:t.height},e.stream.isSendScreen()&&(e.screenShareResizeInterval=setInterval((function(){var t=n.getVideoTracks()[0].getSettings(),r=t.width,o=t.height;!e.stream.isLocalStreamPublished||r===e.stream.videoDimensions.width&&o===e.stream.videoDimensions.height||e.openvidu.sendVideoDimensionsChangedEvent(e,"screenResized",e.stream.videoDimensions.width,e.stream.videoDimensions.height,r||0,o||0)}),650)),e.stream.isLocalStreamReadyToPublish=!0,e.stream.ee.emitEvent("stream-ready-to-publish",[])})):(e.stream.isLocalStreamReadyToPublish=!0,e.stream.ee.emitEvent("stream-ready-to-publish",[])),t()},m=function(t,n){e.clearPermissionDialogTimer(r,d),e.stream.isSendScreen()&&e.stream.isSendAudio()?(c.audio=n,c.video=!1,r=Date.now(),e.setPermissionDialogTimer(d),navigator.mediaDevices.getUserMedia(c).then((function(n){e.clearPermissionDialogTimer(r,d),t.addTrack(n.getAudioTracks()[0]),f(t)})).catch((function(n){e.clearPermissionDialogTimer(r,d),t.getAudioTracks().forEach((function(track){track.stop()})),t.getVideoTracks().forEach((function(track){track.stop()})),h(e.openvidu.generateAudioDeviceError(n,o))}))):f(t)},v=function(t){var n,c;switch(C.error("getMediaError: "+t.toString()),e.clearPermissionDialogTimer(r,d),"Error"===t.name&&(t.name=t.constructor.name),t.name.toLowerCase()){case"notfounderror":navigator.mediaDevices.getUserMedia({audio:!1,video:o.video}).then((function(e){e.getVideoTracks().forEach((function(track){track.stop()})),n=S.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,c=t.toString(),h(new S.OpenViduError(n,c))})).catch((function(e){n=S.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,c=t.toString(),h(new S.OpenViduError(n,c))}));break;case"notallowederror":n=e.stream.isSendScreen()?S.OpenViduErrorName.SCREEN_CAPTURE_DENIED:S.OpenViduErrorName.DEVICE_ACCESS_DENIED,c=t.toString(),h(new S.OpenViduError(n,c));break;case"overconstrainederror":navigator.mediaDevices.getUserMedia({audio:!1,video:o.video}).then((function(e){e.getVideoTracks().forEach((function(track){track.stop()})),"deviceid"===t.constraint.toLowerCase()?(n=S.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,c="Audio input device with deviceId '"+o.audio.deviceId.exact+"' not found"):(n=S.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,c="Audio input device doesn't support the value passed for constraint '"+t.constraint+"'"),h(new S.OpenViduError(n,c))})).catch((function(e){"deviceid"===t.constraint.toLowerCase()?(n=S.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,c="Video input device with deviceId '"+o.video.deviceId.exact+"' not found"):(n=S.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,c="Video input device doesn't support the value passed for constraint '"+t.constraint+"'"),h(new S.OpenViduError(n,c))}));break;case"aborterror":case"notreadableerror":n=S.OpenViduErrorName.DEVICE_ALREADY_IN_USE,c=t.toString(),h(new S.OpenViduError(n,c));break;default:n=S.OpenViduErrorName.GENERIC_ERROR,c=t.toString(),h(new S.OpenViduError(n,c))}};e.openvidu.generateMediaConstraints(e.properties).then((function(t){var n,h;if(t.videoTrack&&t.audioTrack||t.audioTrack&&!1===(null===(n=t.constraints)||void 0===n?void 0:n.video)||t.videoTrack&&!1===(null===(h=t.constraints)||void 0===h?void 0:h.audio))f(e.openvidu.addAlreadyProvidedTracks(t,new MediaStream));else{var E={mediaConstraints:o=t.constraints,publisherProperties:e.properties};e.stream.setOutboundStreamOptions(E);var y=void 0===o.audio||o.audio;c.audio=!e.stream.isSendScreen()&&y,c.video=o.video,r=Date.now(),e.setPermissionDialogTimer(d),e.stream.isSendScreen()&&navigator.mediaDevices.getDisplayMedia&&!l.isElectron()?navigator.mediaDevices.getDisplayMedia({video:!0}).then((function(n){e.openvidu.addAlreadyProvidedTracks(t,n),m(n,y)})).catch((function(e){v(e)})):navigator.mediaDevices.getUserMedia(c).then((function(n){e.openvidu.addAlreadyProvidedTracks(t,n),m(n,y)})).catch((function(e){v(e)}))}})).catch((function(e){h(e)}))}))},t.prototype.getVideoDimensions=function(e){var t=this;return new Promise((function(e,n){var r,o=l.isIonicIos()||l.isIOSWithSafari(),c=function(){var n,c;if("function"==typeof t.stream.getMediaStream().getVideoTracks()[0].getSettings){var d=t.stream.getMediaStream().getVideoTracks()[0].getSettings();n=d.width||t.videoReference.videoWidth,c=d.height||t.videoReference.videoHeight}else C.warn("MediaStreamTrack does not have getSettings method on "+l.getDescription()),n=t.videoReference.videoWidth,c=t.videoReference.videoHeight;null!=r&&t.videoReference.removeEventListener("loadedmetadata",r),o&&document.body.removeChild(t.videoReference),e({width:n,height:c})};t.videoReference.readyState>=1?c():(r=function(){if(t.videoReference.videoWidth)c();else var e=setInterval((function(){t.videoReference.videoWidth&&(clearInterval(e),c())}),40)},t.videoReference.addEventListener("loadedmetadata",r),o&&document.body.appendChild(t.videoReference))}))},t.prototype.reestablishStreamPlayingEvent=function(){this.ee.getListeners("streamPlaying").length>0&&this.addPlayEventToFirstVideo()},t.prototype.initializeVideoReference=function(e){this.videoReference=document.createElement("video"),this.videoReference.setAttribute("muted","true"),this.videoReference.style.display="none",(l.isSafariBrowser()||l.isIPhoneOrIPad()&&(l.isChromeMobileBrowser()||l.isEdgeMobileBrowser()||l.isOperaMobileBrowser()||l.isFirefoxMobileBrowser()))&&this.videoReference.setAttribute("playsinline","true"),this.stream.setMediaStream(e),this.firstVideoElement&&this.createVideoElement(this.firstVideoElement.targetElement,this.properties.insertMode),this.videoReference.srcObject=e},t.prototype.setPermissionDialogTimer=function(e){var t=this;this.permissionDialogTimeout=setTimeout((function(){t.emitEvent("accessDialogOpened",[])}),e)},t.prototype.clearPermissionDialogTimer=function(e,t){clearTimeout(this.permissionDialogTimeout),Date.now()-e>t&&this.emitEvent("accessDialogClosed",[])},t}(m.StreamManager);t.Publisher=I},1056:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,c){function d(e){try{h(r.next(e))}catch(e){c(e)}}function l(e){try{h(r.throw(e))}catch(e){c(e)}}function h(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,l)}h((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,body){var t,n,r,g,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return g={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function c(c){return function(d){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(r=2&c[0]?n.return:c[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,c[1])).done)return r;switch(n=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,n=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){o.label=c[1];break}if(6===c[0]&&o.label<r[1]){o.label=r[1],r=c;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(c);break}r[2]&&o.ops.pop(),o.trys.pop();continue}c=body.call(e,o)}catch(e){c=[6,e],n=0}finally{t=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,d])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Stream=void 0;var c,d=n(1057),l=n(1058),h=n(1248),f=n(1253),m=n(966),v=n(1124),E=n(1062),y=n(803),S=n(804),w=n(452),O=n(568),C=n(1254),I=n(1061),R=w.OpenViduLogger.getInstance(),P=function(){function e(e,t){var n=this;this.isSubscribeToRemote=!1,this.isLocalStreamReadyToPublish=!1,this.isLocalStreamPublished=!1,this.publishedOnce=!1,this.harkSpeakingEnabled=!1,this.harkSpeakingEnabledOnce=!1,this.harkStoppedSpeakingEnabled=!1,this.harkStoppedSpeakingEnabledOnce=!1,this.harkVolumeChangeEnabled=!1,this.harkVolumeChangeEnabledOnce=!1,this.ee=new I,c=O.PlatformUtils.getInstance(),this.session=e,t.hasOwnProperty("id")?(this.inboundStreamOpts=t,this.streamId=this.inboundStreamOpts.id,this.creationTime=this.inboundStreamOpts.createdAt,this.hasAudio=this.inboundStreamOpts.hasAudio,this.hasVideo=this.inboundStreamOpts.hasVideo,this.hasAudio&&(this.audioActive=this.inboundStreamOpts.audioActive),this.hasVideo&&(this.videoActive=this.inboundStreamOpts.videoActive,this.typeOfVideo=this.inboundStreamOpts.typeOfVideo?this.inboundStreamOpts.typeOfVideo:void 0,this.frameRate=-1===this.inboundStreamOpts.frameRate?void 0:this.inboundStreamOpts.frameRate,this.videoDimensions=this.inboundStreamOpts.videoDimensions),this.inboundStreamOpts.filter&&Object.keys(this.inboundStreamOpts.filter).length>0&&(this.inboundStreamOpts.filter.lastExecMethod&&0===Object.keys(this.inboundStreamOpts.filter.lastExecMethod).length&&delete this.inboundStreamOpts.filter.lastExecMethod,this.filter=this.inboundStreamOpts.filter)):(this.outboundStreamOpts=t,this.hasAudio=this.isSendAudio(),this.hasVideo=this.isSendVideo(),this.hasAudio&&(this.audioActive=!!this.outboundStreamOpts.publisherProperties.publishAudio),this.hasVideo&&(this.videoActive=!!this.outboundStreamOpts.publisherProperties.publishVideo,this.frameRate=this.outboundStreamOpts.publisherProperties.frameRate,"undefined"!=typeof MediaStreamTrack&&this.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?this.typeOfVideo="CUSTOM":this.typeOfVideo=this.isSendScreen()?"SCREEN":"CAMERA"),this.outboundStreamOpts.publisherProperties.filter&&(this.filter=this.outboundStreamOpts.publisherProperties.filter)),this.ee.on("mediastream-updated",(function(){n.streamManager.updateMediaStream(n.mediaStream),R.debug("Video srcObject ["+n.mediaStream+"] updated in stream ["+n.streamId+"]")}))}return e.prototype.reconnect=function(){return this.reconnectStream("API")},e.prototype.applyFilter=function(e,t){var n=this;return new Promise((function(r,o){n.session.sessionConnected()||o(n.session.notConnectedError()),R.info("Applying filter to stream "+n.streamId);var c=t=null!=t?t:{};"string"!=typeof c&&(c=JSON.stringify(c)),n.session.openvidu.sendRequest("applyFilter",{streamId:n.streamId,type:e,options:c},(function(c,l){if(c)R.error("Error applying filter for Stream "+n.streamId,c),401===c.code?o(new S.OpenViduError(S.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to apply a filter")):o(c);else{R.info("Filter successfully applied on Stream "+n.streamId);var h=n.filter;n.filter=new d.Filter(e,t),n.filter.stream=n,n.session.emitEvent("streamPropertyChanged",[new y.StreamPropertyChangedEvent(n.session,n,"filter",n.filter,h,"applyFilter")]),n.streamManager.emitEvent("streamPropertyChanged",[new y.StreamPropertyChangedEvent(n.streamManager,n,"filter",n.filter,h,"applyFilter")]),r(n.filter)}}))}))},e.prototype.removeFilter=function(){var e=this;return new Promise((function(t,n){e.session.sessionConnected()||n(e.session.notConnectedError()),R.info("Removing filter of stream "+e.streamId),e.session.openvidu.sendRequest("removeFilter",{streamId:e.streamId},(function(r,o){if(r)R.error("Error removing filter for Stream "+e.streamId,r),401===r.code?n(new S.OpenViduError(S.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to remove a filter")):n(r);else{R.info("Filter successfully removed from Stream "+e.streamId);var c=e.filter;delete e.filter,e.session.emitEvent("streamPropertyChanged",[new y.StreamPropertyChangedEvent(e.session,e,"filter",e.filter,c,"applyFilter")]),e.streamManager.emitEvent("streamPropertyChanged",[new y.StreamPropertyChangedEvent(e.streamManager,e,"filter",e.filter,c,"applyFilter")]),t()}}))}))},e.prototype.getRTCPeerConnection=function(){return this.webRtcPeer.pc},e.prototype.getMediaStream=function(){return this.mediaStream},e.prototype.setMediaStream=function(e){this.mediaStream=e},e.prototype.updateMediaStreamInVideos=function(){this.ee.emitEvent("mediastream-updated",[])},e.prototype.getWebRtcPeer=function(){return this.webRtcPeer},e.prototype.subscribeToMyRemote=function(e){this.isSubscribeToRemote=e},e.prototype.setOutboundStreamOptions=function(e){this.outboundStreamOpts=e},e.prototype.subscribe=function(){var e=this;return new Promise((function(t,n){e.initWebRtcPeerReceive(!1).then((function(){t()})).catch((function(e){n(e)}))}))},e.prototype.publish=function(){var e=this;return new Promise((function(t,n){e.isLocalStreamReadyToPublish?e.initWebRtcPeerSend(!1).then((function(){t()})).catch((function(e){n(e)})):e.ee.once("stream-ready-to-publish",(function(){e.publish().then((function(){t()})).catch((function(e){n(e)}))}))}))},e.prototype.disposeWebRtcPeer=function(){var e;this.webRtcPeer&&(this.webRtcPeer.dispose(),e=this.webRtcPeer.getId()),this.stopWebRtcStats(),R.info((this.outboundStreamOpts?"Outbound ":"Inbound ")+"RTCPeerConnection with id ["+e+"] from 'Stream' with id ["+this.streamId+"] is now closed")},e.prototype.disposeMediaStream=function(){this.mediaStream&&(this.mediaStream.getAudioTracks().forEach((function(track){track.stop()})),this.mediaStream.getVideoTracks().forEach((function(track){track.stop()})),delete this.mediaStream),this.localMediaStreamWhenSubscribedToRemote&&(this.localMediaStreamWhenSubscribedToRemote.getAudioTracks().forEach((function(track){track.stop()})),this.localMediaStreamWhenSubscribedToRemote.getVideoTracks().forEach((function(track){track.stop()})),delete this.localMediaStreamWhenSubscribedToRemote),this.speechEvent&&(this.speechEvent.stop&&this.speechEvent.stop(),delete this.speechEvent),R.info((this.outboundStreamOpts?"Local ":"Remote ")+"MediaStream from 'Stream' with id ["+this.streamId+"] is now disposed")},e.prototype.displayMyRemote=function(){return this.isSubscribeToRemote},e.prototype.isSendAudio=function(){return!!this.outboundStreamOpts&&null!==this.outboundStreamOpts.publisherProperties.audioSource&&!1!==this.outboundStreamOpts.publisherProperties.audioSource},e.prototype.isSendVideo=function(){return!!this.outboundStreamOpts&&null!==this.outboundStreamOpts.publisherProperties.videoSource&&!1!==this.outboundStreamOpts.publisherProperties.videoSource},e.prototype.isSendScreen=function(){var e="screen"===this.outboundStreamOpts.publisherProperties.videoSource;return c.isElectron()&&(e="string"==typeof this.outboundStreamOpts.publisherProperties.videoSource&&this.outboundStreamOpts.publisherProperties.videoSource.startsWith("screen:")),!!this.outboundStreamOpts&&e},e.prototype.enableHarkSpeakingEvent=function(){var e=this;this.setHarkListenerIfNotExists(),this.harkSpeakingEnabled||(this.harkSpeakingEnabled=!0,this.speechEvent.on("speaking",(function(){e.session.emitEvent("publisherStartSpeaking",[new v.PublisherSpeakingEvent(e.session,"publisherStartSpeaking",e.connection,e.streamId)]),e.streamManager.emitEvent("publisherStartSpeaking",[new v.PublisherSpeakingEvent(e.streamManager,"publisherStartSpeaking",e.connection,e.streamId)]),e.harkSpeakingEnabledOnce=!1})))},e.prototype.enableOnceHarkSpeakingEvent=function(){var e=this;this.setHarkListenerIfNotExists(),this.harkSpeakingEnabledOnce||(this.harkSpeakingEnabledOnce=!0,this.speechEvent.once("speaking",(function(){e.harkSpeakingEnabledOnce&&(e.session.emitEvent("publisherStartSpeaking",[new v.PublisherSpeakingEvent(e.session,"publisherStartSpeaking",e.connection,e.streamId)]),e.streamManager.emitEvent("publisherStartSpeaking",[new v.PublisherSpeakingEvent(e.streamManager,"publisherStartSpeaking",e.connection,e.streamId)])),e.disableHarkSpeakingEvent(!0)})))},e.prototype.disableHarkSpeakingEvent=function(e){if(this.speechEvent){if(this.harkSpeakingEnabledOnce=!1,e){if(this.harkSpeakingEnabled)return}else this.harkSpeakingEnabled=!1;this.harkVolumeChangeEnabled||this.harkVolumeChangeEnabledOnce||this.harkStoppedSpeakingEnabled||this.harkStoppedSpeakingEnabledOnce?this.speechEvent.off("speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},e.prototype.enableHarkStoppedSpeakingEvent=function(){var e=this;this.setHarkListenerIfNotExists(),this.harkStoppedSpeakingEnabled||(this.harkStoppedSpeakingEnabled=!0,this.speechEvent.on("stopped_speaking",(function(){e.session.emitEvent("publisherStopSpeaking",[new v.PublisherSpeakingEvent(e.session,"publisherStopSpeaking",e.connection,e.streamId)]),e.streamManager.emitEvent("publisherStopSpeaking",[new v.PublisherSpeakingEvent(e.streamManager,"publisherStopSpeaking",e.connection,e.streamId)]),e.harkStoppedSpeakingEnabledOnce=!1})))},e.prototype.enableOnceHarkStoppedSpeakingEvent=function(){var e=this;this.setHarkListenerIfNotExists(),this.harkStoppedSpeakingEnabledOnce||(this.harkStoppedSpeakingEnabledOnce=!0,this.speechEvent.once("stopped_speaking",(function(){e.harkStoppedSpeakingEnabledOnce&&(e.session.emitEvent("publisherStopSpeaking",[new v.PublisherSpeakingEvent(e.session,"publisherStopSpeaking",e.connection,e.streamId)]),e.streamManager.emitEvent("publisherStopSpeaking",[new v.PublisherSpeakingEvent(e.streamManager,"publisherStopSpeaking",e.connection,e.streamId)])),e.disableHarkStoppedSpeakingEvent(!0)})))},e.prototype.disableHarkStoppedSpeakingEvent=function(e){if(this.speechEvent){if(this.harkStoppedSpeakingEnabledOnce=!1,e){if(this.harkStoppedSpeakingEnabled)return}else this.harkStoppedSpeakingEnabled=!1;this.harkVolumeChangeEnabled||this.harkVolumeChangeEnabledOnce||this.harkSpeakingEnabled||this.harkSpeakingEnabledOnce?this.speechEvent.off("stopped_speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},e.prototype.enableHarkVolumeChangeEvent=function(e){var t=this;this.setHarkListenerIfNotExists()?this.harkVolumeChangeEnabled&&!e||(this.harkVolumeChangeEnabled=!0,this.speechEvent.on("volume_change",(function(e){var n={newValue:e,oldValue:t.speechEvent.oldVolumeValue};t.speechEvent.oldVolumeValue=e,t.streamManager.emitEvent("streamAudioVolumeChange",[new E.StreamManagerEvent(t.streamManager,"streamAudioVolumeChange",n)])}))):this.harkVolumeChangeEnabled=!0},e.prototype.enableOnceHarkVolumeChangeEvent=function(e){var t=this;this.setHarkListenerIfNotExists()?this.harkVolumeChangeEnabledOnce&&!e||(this.harkVolumeChangeEnabledOnce=!0,this.speechEvent.once("volume_change",(function(e){var n={newValue:e,oldValue:t.speechEvent.oldVolumeValue};t.speechEvent.oldVolumeValue=e,t.disableHarkVolumeChangeEvent(!0),t.streamManager.emitEvent("streamAudioVolumeChange",[new E.StreamManagerEvent(t.streamManager,"streamAudioVolumeChange",n)])}))):this.harkVolumeChangeEnabledOnce=!0},e.prototype.disableHarkVolumeChangeEvent=function(e){if(this.speechEvent){if(this.harkVolumeChangeEnabledOnce=!1,e){if(this.harkVolumeChangeEnabled)return}else this.harkVolumeChangeEnabled=!1;this.harkSpeakingEnabled||this.harkSpeakingEnabledOnce||this.harkStoppedSpeakingEnabled||this.harkStoppedSpeakingEnabledOnce?this.speechEvent.off("volume_change"):(this.speechEvent.stop(),delete this.speechEvent)}},e.prototype.isLocal=function(){return!this.inboundStreamOpts&&!!this.outboundStreamOpts},e.prototype.getSelectedIceCandidate=function(){var e=this;return new Promise((function(t,n){e.webRtcStats.getSelectedIceCandidateInfo().then((function(e){return t(e)})).catch((function(e){return n(e)}))}))},e.prototype.getRemoteIceCandidateList=function(){return this.webRtcPeer.remoteCandidatesQueue},e.prototype.getLocalIceCandidateList=function(){return this.webRtcPeer.localCandidatesQueue},e.prototype.streamIceConnectionStateBroken=function(){if(!this.getWebRtcPeer()||!this.getRTCPeerConnection())return!1;if(this.isLocal()&&this.session.openvidu.advancedConfiguration.forceMediaReconnectionAfterNetworkDrop)return R.warn('OpenVidu Browser advanced configuration option "forceMediaReconnectionAfterNetworkDrop" is enabled. Stream '+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") will force a reconnection"),!0;var e=this.getRTCPeerConnection().iceConnectionState;return"connected"!==e&&"completed"!==e},e.prototype.setHarkListenerIfNotExists=function(){if(this.mediaStream){if(!this.speechEvent){var e=this.harkOptions?this.harkOptions:this.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{};e.interval="number"==typeof e.interval?e.interval:100,e.threshold="number"==typeof e.threshold?e.threshold:-50,this.speechEvent=C(this.mediaStream,e)}return!0}return!1},e.prototype.setupReconnectionEventEmitter=function(e,t){return null==this.reconnectionEventEmitter?(this.reconnectionEventEmitter=new I,!1):(console.warn("Trying to reconnect stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") but an ongoing reconnection process is active. Waiting for response..."),this.reconnectionEventEmitter.once("success",(function(){e()})),this.reconnectionEventEmitter.once("error",(function(e){t(e)})),!0)},e.prototype.initWebRtcPeerSend=function(e){var t=this;return new Promise((function(n,r){if(e){if(t.setupReconnectionEventEmitter(n,r))return}else t.initHarkEvents();var o=function(n){var o;e&&(null===(o=t.reconnectionEventEmitter)||void 0===o||o.emitEvent("error",[n]),delete t.reconnectionEventEmitter),r(n)},c=function(r){R.debug("Sending SDP offer to publish as "+t.streamId,r);var c,d=e?"reconnectStream":"publishVideo";if(e)c={stream:t.streamId,sdpString:r};else{var l="";t.isSendVideo()&&(l="undefined"!=typeof MediaStreamTrack&&t.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?"CUSTOM":t.isSendScreen()?"SCREEN":"CAMERA"),c={doLoopback:t.displayMyRemote()||!1,hasAudio:t.isSendAudio(),hasVideo:t.isSendVideo(),audioActive:t.audioActive,videoActive:t.videoActive,typeOfVideo:l,frameRate:t.frameRate?t.frameRate:-1,videoDimensions:JSON.stringify(t.videoDimensions),filter:t.outboundStreamOpts.publisherProperties.filter,sdpOffer:r}}t.session.openvidu.sendRequest(d,c,(function(r,c){r?401===r.code?o(new S.OpenViduError(S.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to publish")):o("Error on publishVideo: "+JSON.stringify(r)):t.webRtcPeer.processRemoteAnswer(c.sdpAnswer).then((function(){var r;t.streamId=c.id,t.creationTime=c.createdAt,t.isLocalStreamPublished=!0,t.publishedOnce=!0,t.displayMyRemote()&&(t.localMediaStreamWhenSubscribedToRemote=t.mediaStream,t.remotePeerSuccessfullyEstablished(e)),e?t.ee.emitEvent("stream-reconnected-by-publisher",[]):t.ee.emitEvent("stream-created-by-publisher",[]),t.initWebRtcStats(),R.info("'Publisher' ("+t.streamId+") successfully "+(e?"reconnected":"published")+" to session"),e&&(null===(r=t.reconnectionEventEmitter)||void 0===r||r.emitEvent("success"),delete t.reconnectionEventEmitter),n()})).catch((function(e){o(e)}))}))},d={mediaConstraints:{audio:t.hasAudio,video:t.hasVideo},simulcast:t.session.openvidu.advancedConfiguration.enableSimulcastExperimental||!1,onIceCandidate:t.connection.sendIceCandidate.bind(t.connection),onIceConnectionStateException:function(e,n,data){t.session.emitEvent("exception",[new m.ExceptionEvent(t.session,e,t,n,data)])},iceServers:t.getIceServersConf(),mediaStream:t.mediaStream,mediaServer:t.session.openvidu.mediaServer};e&&t.disposeWebRtcPeer(),t.displayMyRemote()?t.webRtcPeer=new h.WebRtcPeerSendrecv(d):t.webRtcPeer=new h.WebRtcPeerSendonly(d),t.webRtcPeer.addIceConnectionStateChangeListener("publisher of "+t.connection.connectionId),t.webRtcPeer.createOffer().then((function(e){t.webRtcPeer.processLocalOffer(e).then((function(){c(e.sdp)})).catch((function(e){o(new Error("(publish) SDP process local offer error: "+JSON.stringify(e)))}))})).catch((function(e){o(new Error("(publish) SDP create offer error: "+JSON.stringify(e)))}))}))},e.prototype.finalResolveForSubscription=function(e,t){var n;R.info("'Subscriber' ("+this.streamId+") successfully "+(e?"reconnected":"subscribed")),this.remotePeerSuccessfullyEstablished(e),this.initWebRtcStats(),e&&(null===(n=this.reconnectionEventEmitter)||void 0===n||n.emitEvent("success"),delete this.reconnectionEventEmitter),t()},e.prototype.finalRejectForSubscription=function(e,t,n){var r;R.error("Error for 'Subscriber' ("+this.streamId+") while trying to "+(e?"reconnect":"subscribe")+": "+t.toString()),e&&(null===(r=this.reconnectionEventEmitter)||void 0===r||r.emitEvent("error",[t]),delete this.reconnectionEventEmitter),n(t)},e.prototype.initWebRtcPeerReceive=function(e){var t=this;return new Promise((function(n,r){e&&t.setupReconnectionEventEmitter(n,r)||("mediasoup"===t.session.openvidu.mediaServer?t.initWebRtcPeerReceiveFromServer(e).then((function(){return t.finalResolveForSubscription(e,n)})).catch((function(n){return t.finalRejectForSubscription(e,n,r)})):t.initWebRtcPeerReceiveFromClient(e).then((function(){return t.finalResolveForSubscription(e,n)})).catch((function(n){return t.finalRejectForSubscription(e,n,r)})))}))},e.prototype.initWebRtcPeerReceiveFromClient=function(e){var t=this;return new Promise((function(n,r){t.completeWebRtcPeerReceive(e,!1).then((function(e){t.webRtcPeer.processRemoteAnswer(e.sdpAnswer).then((function(){return n()})).catch((function(e){return r(e)}))})).catch((function(e){return r(e)}))}))},e.prototype.initWebRtcPeerReceiveFromServer=function(e){var t=this;return new Promise((function(n,r){t.session.openvidu.sendRequest("prepareReceiveVideoFrom",{sender:t.streamId,reconnect:e},(function(o,c){o?r(new Error("Error on prepareReceiveVideoFrom: "+JSON.stringify(o))):t.completeWebRtcPeerReceive(e,!1,c.sdpOffer).then((function(){return n()})).catch((function(e){return r(e)}))}))}))},e.prototype.completeWebRtcPeerReceive=function(e,t,n){var r=this;return new Promise((function(o,c){R.debug("'Session.subscribe(Stream)' called");var d=function(d){R.debug("Sending local SDP "+(n?"answer":"offer")+" to subscribe to "+r.streamId,d);var l=e?"reconnectStream":"receiveVideoFrom",h={};h[e?"stream":"sender"]=r.streamId,n?h[e?"sdpString":"sdpAnswer"]=d:h.sdpOffer=d,e&&(h.forciblyReconnect=t),r.session.openvidu.sendRequest(l,h,(function(e,t){e?c(new Error("Error on "+l+" : "+JSON.stringify(e))):o(t)}))},l={mediaConstraints:{audio:r.hasAudio,video:r.hasVideo},simulcast:!1,onIceCandidate:r.connection.sendIceCandidate.bind(r.connection),onIceConnectionStateException:function(e,t,data){r.session.emitEvent("exception",[new m.ExceptionEvent(r.session,e,r,t,data)])},iceServers:r.getIceServersConf(),mediaServer:r.session.openvidu.mediaServer};e&&r.disposeWebRtcPeer(),r.webRtcPeer=new h.WebRtcPeerRecvonly(l),r.webRtcPeer.addIceConnectionStateChangeListener(r.streamId),n?r.webRtcPeer.processRemoteOffer(n).then((function(){r.webRtcPeer.createAnswer().then((function(e){r.webRtcPeer.processLocalAnswer(e).then((function(){d(e.sdp)})).catch((function(e){c(new Error("(subscribe) SDP process local answer error: "+JSON.stringify(e)))}))})).catch((function(e){c(new Error("(subscribe) SDP create answer error: "+JSON.stringify(e)))}))})).catch((function(e){c(new Error("(subscribe) SDP process remote offer error: "+JSON.stringify(e)))})):r.webRtcPeer.createOffer().then((function(e){r.webRtcPeer.processLocalOffer(e).then((function(){d(e.sdp)})).catch((function(e){c(new Error("(subscribe) SDP process local offer error: "+JSON.stringify(e)))}))})).catch((function(e){c(new Error("(subscribe) SDP create offer error: "+JSON.stringify(e)))}))}))},e.prototype.remotePeerSuccessfullyEstablished=function(e){var t;e&&null!=this.mediaStream&&this.disposeMediaStream(),this.mediaStream=new MediaStream;for(var n=0,r=this.webRtcPeer.pc.getReceivers();n<r.length;n++)(t=r[n]).track&&this.mediaStream.addTrack(t.track);if(R.debug("Peer remote stream",this.mediaStream),this.mediaStream){if(this.streamManager instanceof l.Subscriber){if(this.mediaStream.getAudioTracks()[0]){var o=e?this.audioActive:!!this.streamManager.properties.subscribeToAudio;this.mediaStream.getAudioTracks()[0].enabled=o}if(this.mediaStream.getVideoTracks()[0]){o=e?this.videoActive:!!this.streamManager.properties.subscribeToVideo;this.mediaStream.getVideoTracks()[0].enabled=o}}this.updateMediaStreamInVideos(),this.initHarkEvents()}},e.prototype.initHarkEvents=function(){this.mediaStream.getAudioTracks()[0]&&(this.session.anySpeechEventListenerEnabled("publisherStartSpeaking",!0,this.streamManager)&&this.enableOnceHarkSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,this.streamManager)&&this.enableHarkSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStopSpeaking",!0,this.streamManager)&&this.enableOnceHarkStoppedSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,this.streamManager)&&this.enableHarkStoppedSpeakingEvent(),this.harkVolumeChangeEnabledOnce&&this.enableOnceHarkVolumeChangeEvent(!0),this.harkVolumeChangeEnabled&&this.enableHarkVolumeChangeEvent(!0))},e.prototype.onIceConnectionStateExceptionHandler=function(e,t,data){switch(e){case m.ExceptionEventName.ICE_CONNECTION_FAILED:this.onIceConnectionFailed();break;case m.ExceptionEventName.ICE_CONNECTION_DISCONNECTED:this.onIceConnectionDisconnected()}this.session.emitEvent("exception",[new m.ExceptionEvent(this.session,e,this,t,data)])},e.prototype.onIceConnectionFailed=function(){R.log("[ICE_CONNECTION_FAILED] Handling ICE_CONNECTION_FAILED event. Reconnecting stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+")"),this.reconnectStreamAndLogResultingIceConnectionState(m.ExceptionEventName.ICE_CONNECTION_FAILED)},e.prototype.onIceConnectionDisconnected=function(){var e=this;R.log("[ICE_CONNECTION_DISCONNECTED] Handling ICE_CONNECTION_DISCONNECTED event. Waiting for ICE to be restored and reconnect stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") if not possible");var t=this.session.openvidu.advancedConfiguration.iceConnectionDisconnectedExceptionTimeout||4e3;this.awaitWebRtcPeerConnectionState(t).then((function(n){switch(n){case"failed":R.warn("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream "+e.streamId+" ("+(e.isLocal()?"Publisher":"Subscriber")+") is now failed after ICE_CONNECTION_DISCONNECTED");break;case"connected":case"completed":R.log("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream "+e.streamId+" ("+(e.isLocal()?"Publisher":"Subscriber")+") automatically restored after ICE_CONNECTION_DISCONNECTED. Current ICE connection state: "+n);break;case"closed":case"checking":case"new":case"disconnected":R.warn("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream "+e.streamId+" ("+(e.isLocal()?"Publisher":"Subscriber")+") couldn't be restored after ICE_CONNECTION_DISCONNECTED event. Current ICE connection state after "+t+" ms: "+n),e.reconnectStreamAndLogResultingIceConnectionState(m.ExceptionEventName.ICE_CONNECTION_DISCONNECTED)}}))},e.prototype.reconnectStreamAndLogResultingIceConnectionState=function(e){return r(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.reconnectStreamAndReturnIceConnectionState(e)];case 1:switch(t=r.sent()){case"connected":case"completed":R.log("["+e+"] Stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") successfully reconnected after "+e+". Current ICE connection state: "+t);break;default:R.error("["+e+"] Stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") failed to reconnect after "+e+". Current ICE connection state: "+t)}return[3,3];case 2:return n=r.sent(),R.error("["+e+"] Error reconnecting stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") after "+e+": "+n),[3,3];case 3:return[2]}}))}))},e.prototype.reconnectStreamAndReturnIceConnectionState=function(e){return r(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:R.log("["+e+"] Reconnecting stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") after event "+e),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.reconnectStream(e)];case 2:return r.sent(),t=this.session.openvidu.advancedConfiguration.iceConnectionDisconnectedExceptionTimeout||4e3,[2,this.awaitWebRtcPeerConnectionState(t)];case 3:return n=r.sent(),R.warn("["+e+"] Error reconnecting stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+"). Reason: "+n),[2,this.awaitWebRtcPeerConnectionState(1)];case 4:return[2]}}))}))},e.prototype.reconnectStream=function(e){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return[4,this.isWebsocketConnected(e,3e3)];case 1:if(n.sent())return R.log("["+e+"] Trying to reconnect stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") and the websocket is opened"),this.isLocal()?[2,this.initWebRtcPeerSend(!0)]:[2,this.initWebRtcPeerReceive(!0)];throw t="["+e+"] Trying to reconnect stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") but the websocket wasn't opened",R.error(t),Error(t)}}))}))},e.prototype.isWebsocketConnected=function(e,t){var n=this;return new Promise((function(r,o){var c=n.session.openvidu.getWsReadyState();if(1===c){var d=setTimeout((function(){console.warn("["+e+"] Websocket timeout of "+t+"ms"),r(!1)}),t);n.session.openvidu.sendRequest("echo",{},(function(t,n){clearTimeout(d),t?(console.warn("["+e+"] Websocket 'echo' returned error: "+t),r(!1)):r(!0)}))}else console.warn("["+e+"] Websocket readyState is "+c),r(!1)}))},e.prototype.awaitWebRtcPeerConnectionState=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i;return o(this,(function(o){switch(o.label){case 0:t=this.getRTCPeerConnection().iceConnectionState,n=150,r=Math.ceil(e/n),i=0,o.label=1;case 1:return i<r?"connected"===(t=this.getRTCPeerConnection().iceConnectionState)||"completed"===t?[3,4]:[4,new Promise((function(e){return setTimeout(e,n)}))]:[3,4];case 2:o.sent(),o.label=3;case 3:return i++,[3,1];case 4:return[2,t]}}))}))},e.prototype.initWebRtcStats=function(){this.webRtcStats=new f.WebRtcStats(this),this.webRtcStats.initWebRtcStats()},e.prototype.stopWebRtcStats=function(){this.webRtcStats&&this.webRtcStats.isEnabled()&&this.webRtcStats.stopWebRtcStats()},e.prototype.getIceServersConf=function(){return this.session.openvidu.advancedConfiguration.iceServers?"freeice"===this.session.openvidu.advancedConfiguration.iceServers?void 0:this.session.openvidu.advancedConfiguration.iceServers:this.session.openvidu.iceServers?this.session.openvidu.iceServers:void 0},e.prototype.gatherStatsForPeer=function(){var e=this;return new Promise((function(t,n){e.isLocal()?e.getRTCPeerConnection().getSenders().forEach((function(t){return t.getStats().then((function(t){t.forEach((function(t){if(e.isReportWanted(t)){var n={};n.type=t.type,n.timestamp=t.timestamp,n.id=t.id,"outbound-rtp"===t.type&&(n.ssrc=t.ssrc,n.firCount=t.firCount,n.pliCount=t.pliCount,n.nackCount=t.nackCount,n.qpSum=t.qpSum,t.kind?n.mediaType=t.kind:t.mediaType?n.mediaType=t.mediaType:n.mediaType=-1!==t.id.indexOf("VideoStream")?"video":"audio","video"===n.mediaType&&(n.framesEncoded=t.framesEncoded),n.packetsSent=t.packetsSent,n.bytesSent=t.bytesSent),"candidate-pair"===t.type&&void 0!==t.totalRoundTripTime&&(n.availableOutgoingBitrate=t.availableOutgoingBitrate,n.rtt=t.currentRoundTripTime,n.averageRtt=t.totalRoundTripTime/t.responsesReceived),"remote-inbound-rtp"===t.type||t.type,R.log(n)}}))}))})):e.getRTCPeerConnection().getReceivers().forEach((function(t){return t.getStats().then((function(t){t.forEach((function(t){if(e.isReportWanted(t)){var n={};n.type=t.type,n.timestamp=t.timestamp,n.id=t.id,"inbound-rtp"===t.type&&(n.ssrc=t.ssrc,n.firCount=t.firCount,n.pliCount=t.pliCount,n.nackCount=t.nackCount,n.qpSum=t.qpSum,t.kind?n.mediaType=t.kind:t.mediaType?n.mediaType=t.mediaType:n.mediaType=-1!==t.id.indexOf("VideoStream")?"video":"audio","video"===n.mediaType&&(n.framesDecoded=t.framesDecoded),n.packetsReceived=t.packetsReceived,n.packetsLost=t.packetsLost,n.jitter=t.jitter,n.bytesReceived=t.bytesReceived),"candidate-pair"===t.type&&void 0!==t.totalRoundTripTime&&(n.availableIncomingBitrate=t.availableIncomingBitrate,n.rtt=t.currentRoundTripTime,n.averageRtt=t.totalRoundTripTime/t.responsesReceived),"remote-inbound-rtp"===t.type||t.type,R.log(n)}}))}))}))}))},e.prototype.isReportWanted=function(e){return"inbound-rtp"===e.type&&!this.isLocal()||"outbound-rtp"===e.type&&this.isLocal()||"candidate-pair"===e.type&&e.nominated&&e.bytesSent>0},e}();t.Stream=P},1057:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Filter=void 0;var r=n(803),o=n(804),c=n(452).OpenViduLogger.getInstance(),d=function(){function e(e,t){this.handlers=new Map,this.type=e,this.options=t}return e.prototype.execMethod=function(e,t){var n=this;return new Promise((function(d,l){var h;if(c.info("Executing filter method to stream "+n.stream.streamId),"string"!=typeof t)try{h=JSON.stringify(t)}catch(e){var f="'params' property must be a JSON formatted object";c.error(f),l(f)}else h=t;n.stream.session.openvidu.sendRequest("execFilterMethod",{streamId:n.stream.streamId,method:e,params:h},(function(t,f){if(t)c.error("Error executing filter method for Stream "+n.stream.streamId,t),401===t.code?l(new o.OpenViduError(o.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to execute a filter method")):l(t);else{c.info("Filter method successfully executed on Stream "+n.stream.streamId);var m=Object.assign({},n.stream.filter);n.stream.filter.lastExecMethod={method:e,params:JSON.parse(h)},n.stream.session.emitEvent("streamPropertyChanged",[new r.StreamPropertyChangedEvent(n.stream.session,n.stream,"filter",n.stream.filter,m,"execFilterMethod")]),n.stream.streamManager.emitEvent("streamPropertyChanged",[new r.StreamPropertyChangedEvent(n.stream.streamManager,n.stream,"filter",n.stream.filter,m,"execFilterMethod")]),d()}}))}))},e.prototype.addEventListener=function(e,t){var n=this;return new Promise((function(r,d){c.info("Adding filter event listener to event "+e+" to stream "+n.stream.streamId),n.stream.session.openvidu.sendRequest("addFilterEventListener",{streamId:n.stream.streamId,eventType:e},(function(l,h){l?(c.error("Error adding filter event listener to event "+e+"for Stream "+n.stream.streamId,l),401===l.code?d(new o.OpenViduError(o.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):d(l)):(n.handlers.set(e,t),c.info("Filter event listener to event "+e+" successfully applied on Stream "+n.stream.streamId),r())}))}))},e.prototype.removeEventListener=function(e){var t=this;return new Promise((function(n,r){c.info("Removing filter event listener to event "+e+" to stream "+t.stream.streamId),t.stream.session.openvidu.sendRequest("removeFilterEventListener",{streamId:t.stream.streamId,eventType:e},(function(d,l){d?(c.error("Error removing filter event listener to event "+e+"for Stream "+t.stream.streamId,d),401===d.code?r(new o.OpenViduError(o.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):r(d)):(t.handlers.delete(e),c.info("Filter event listener to event "+e+" successfully removed on Stream "+t.stream.streamId),n())}))}))},e}();t.Filter=d},1058:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)});Object.defineProperty(t,"__esModule",{value:!0}),t.Subscriber=void 0;var c=n(1059),d=n(452).OpenViduLogger.getInstance(),l=function(e){function t(t,n,r){var o=e.call(this,t,n)||this;return o.element=o.targetElement,o.stream=t,o.properties=r,o}return o(t,e),t.prototype.subscribeToAudio=function(e){return this.stream.getMediaStream().getAudioTracks().forEach((function(track){track.enabled=e})),this.stream.audioActive=e,d.info("'Subscriber' has "+(e?"subscribed to":"unsubscribed from")+" its audio stream"),this},t.prototype.subscribeToVideo=function(e){return this.stream.getMediaStream().getVideoTracks().forEach((function(track){track.enabled=e})),this.stream.videoActive=e,d.info("'Subscriber' has "+(e?"subscribed to":"unsubscribed from")+" its video stream"),this},t}(c.StreamManager);t.Subscriber=l},1059:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)});Object.defineProperty(t,"__esModule",{value:!0}),t.StreamManager=void 0;var c,d=n(1060),l=n(1062),h=n(1063),f=n(991),m=n(452),v=n(568),E=n(966),y=m.OpenViduLogger.getInstance(),S=function(e){function t(t,n){var r=e.call(this)||this;if(r.videos=[],r.lazyLaunchVideoElementCreatedEvent=!1,c=v.PlatformUtils.getInstance(),r.stream=t,r.stream.streamManager=r,r.remote=!r.stream.isLocal(),n){var o=void 0;"string"==typeof n?o=document.getElementById(n):n instanceof HTMLElement&&(o=n),o&&(r.firstVideoElement={targetElement:o,video:document.createElement("video"),id:"",canplayListenerAdded:!1},(c.isSafariBrowser()||c.isIPhoneOrIPad()&&(c.isChromeMobileBrowser()||c.isEdgeMobileBrowser()||c.isOperaMobileBrowser()||c.isFirefoxMobileBrowser()))&&r.firstVideoElement.video.setAttribute("playsinline","true"),r.targetElement=o,r.element=o)}return r.canPlayListener=function(){r.deactivateStreamPlayingEventExceptionTimeout(),r.remote?(y.info("Remote 'Stream' with id ["+r.stream.streamId+"] video is now playing"),r.ee.emitEvent("videoPlaying",[new h.VideoElementEvent(r.videos[0].video,r,"videoPlaying")])):r.stream.displayMyRemote()?(y.info("Your own remote 'Stream' with id ["+r.stream.streamId+"] video is now playing"),r.ee.emitEvent("remoteVideoPlaying",[new h.VideoElementEvent(r.videos[0].video,r,"remoteVideoPlaying")])):(y.info("Your local 'Stream' with id ["+r.stream.streamId+"] video is now playing"),r.ee.emitEvent("videoPlaying",[new h.VideoElementEvent(r.videos[0].video,r,"videoPlaying")])),r.ee.emitEvent("streamPlaying",[new l.StreamManagerEvent(r,"streamPlaying",void 0)])},r}return o(t,e),t.prototype.on=function(t,n){return e.prototype.onAux.call(this,t,"Event '"+t+"' triggered by '"+(this.remote?"Subscriber":"Publisher")+"'",n),"videoElementCreated"===t&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&(this.ee.emitEvent("videoElementCreated",[new h.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!1),"streamPlaying"!==t&&"videoPlaying"!==t||this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&(this.ee.emitEvent("streamPlaying",[new l.StreamManagerEvent(this,"streamPlaying",void 0)]),this.ee.emitEvent("videoPlaying",[new h.VideoElementEvent(this.videos[0].video,this,"videoPlaying")])),this.stream.hasAudio&&("publisherStartSpeaking"===t&&this.stream.enableHarkSpeakingEvent(),"publisherStopSpeaking"===t&&this.stream.enableHarkStoppedSpeakingEvent(),"streamAudioVolumeChange"===t&&this.stream.enableHarkVolumeChangeEvent(!1)),this},t.prototype.once=function(t,n){return e.prototype.onceAux.call(this,t,"Event '"+t+"' triggered once by '"+(this.remote?"Subscriber":"Publisher")+"'",n),"videoElementCreated"===t&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&this.ee.emitEvent("videoElementCreated",[new h.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),"streamPlaying"!==t&&"videoPlaying"!==t||this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&(this.ee.emitEvent("streamPlaying",[new l.StreamManagerEvent(this,"streamPlaying",void 0)]),this.ee.emitEvent("videoPlaying",[new h.VideoElementEvent(this.videos[0].video,this,"videoPlaying")])),this.stream.hasAudio&&("publisherStartSpeaking"===t&&this.stream.enableOnceHarkSpeakingEvent(),"publisherStopSpeaking"===t&&this.stream.enableOnceHarkStoppedSpeakingEvent(),"streamAudioVolumeChange"===t&&this.stream.enableOnceHarkVolumeChangeEvent(!1)),this},t.prototype.off=function(t,n){(e.prototype.off.call(this,t,n),"publisherStartSpeaking"===t)&&(0===this.ee.getListeners(t).length+this.stream.session.ee.getListeners(t).length&&this.stream.disableHarkSpeakingEvent(!1));"publisherStopSpeaking"===t&&(0===this.ee.getListeners(t).length+this.stream.session.ee.getListeners(t).length&&this.stream.disableHarkStoppedSpeakingEvent(!1));"streamAudioVolumeChange"===t&&(0===this.ee.getListeners(t).length&&this.stream.disableHarkVolumeChangeEvent(!1));return this},t.prototype.addVideoElement=function(video){this.initializeVideoProperties(video),!this.remote&&this.stream.displayMyRemote()&&video.srcObject!==this.stream.getMediaStream()&&(video.srcObject=this.stream.getMediaStream());for(var e=0,t=this.videos;e<t.length;e++){if(t[e].video===video)return 0}for(var n=1,r=0,o=this.stream.session.streamManagers;r<o.length;r++){if(o[r].disassociateVideo(video)){n=-1;break}}return this.stream.session.streamManagers.forEach((function(e){e.disassociateVideo(video)})),this.pushNewStreamManagerVideo({video:video,id:video.id,canplayListenerAdded:!1}),y.info("New video element associated to ",this),n},t.prototype.createVideoElement=function(e,t){var n;if("string"==typeof e){if(!(n=document.getElementById(e)))throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+e)}else{if(!(e instanceof HTMLElement))throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+e);n=e}var video=this.createVideo();this.initializeVideoProperties(video);var r=t||f.VideoInsertMode.APPEND;switch(r){case f.VideoInsertMode.AFTER:n.parentNode.insertBefore(video,n.nextSibling);break;case f.VideoInsertMode.APPEND:n.appendChild(video);break;case f.VideoInsertMode.BEFORE:n.parentNode.insertBefore(video,n);break;case f.VideoInsertMode.PREPEND:n.insertBefore(video,n.childNodes[0]);break;case f.VideoInsertMode.REPLACE:n.parentNode.replaceChild(video,n);break;default:r=f.VideoInsertMode.APPEND,n.appendChild(video)}var o={targetElement:n,video:video,insertMode:r,id:video.id,canplayListenerAdded:!1};return this.pushNewStreamManagerVideo(o),this.ee.emitEvent("videoElementCreated",[new h.VideoElementEvent(o.video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!!this.firstVideoElement,video},t.prototype.updatePublisherSpeakingEventsOptions=function(e){var t=this.stream.harkOptions?this.stream.harkOptions:this.stream.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{},n="number"==typeof e.interval?e.interval:"number"==typeof t.interval?t.interval:100,r="number"==typeof e.threshold?e.threshold:"number"==typeof t.threshold?t.threshold:-50;this.stream.harkOptions={interval:n,threshold:r},this.stream.speechEvent&&(this.stream.speechEvent.setInterval(n),this.stream.speechEvent.setThreshold(r))},t.prototype.initializeVideoProperties=function(video){!this.remote&&this.stream.displayMyRemote()||video.srcObject!==this.stream.getMediaStream()&&(video.srcObject=this.stream.getMediaStream()),video.autoplay=!0,video.controls=!1,(c.isSafariBrowser()||c.isIPhoneOrIPad()&&(c.isChromeMobileBrowser()||c.isEdgeMobileBrowser()||c.isOperaMobileBrowser()||c.isFirefoxMobileBrowser()))&&video.setAttribute("playsinline","true"),video.id||(video.id=(this.remote?"remote-":"local-")+"video-"+this.stream.streamId,!this.id&&this.targetElement&&(this.id=video.id)),this.remote||this.stream.displayMyRemote()||(video.muted=!0,"rotateY(180deg)"!==video.style.transform||this.stream.outboundStreamOpts.publisherProperties.mirror?this.stream.outboundStreamOpts.publisherProperties.mirror&&!this.stream.isSendScreen()&&this.mirrorVideo(video):this.removeMirrorVideo(video))},t.prototype.removeAllVideos=function(){for(var e=this,i=this.stream.session.streamManagers.length-1;i>=0;--i)this.stream.session.streamManagers[i]===this&&this.stream.session.streamManagers.splice(i,1);this.videos.forEach((function(t){t.video&&t.video.removeEventListener&&t.video.removeEventListener("canplay",e.canPlayListener),t.canplayListenerAdded=!1,t.targetElement&&(t.video.parentNode.removeChild(t.video),e.ee.emitEvent("videoElementDestroyed",[new h.VideoElementEvent(t.video,e,"videoElementDestroyed")])),e.removeSrcObject(t),e.videos.filter((function(e){return!e.targetElement}))}))},t.prototype.disassociateVideo=function(video){for(var e=!1,i=0;i<this.videos.length;i++)if(this.videos[i].video===video){this.videos[i].video.removeEventListener("canplay",this.canPlayListener),this.videos.splice(i,1),e=!0,y.info("Video element disassociated from ",this);break}return e},t.prototype.addPlayEventToFirstVideo=function(){this.videos[0]&&this.videos[0].video&&!this.videos[0].canplayListenerAdded&&(this.activateStreamPlayingEventExceptionTimeout(),this.videos[0].video.addEventListener("canplay",this.canPlayListener),this.videos[0].canplayListenerAdded=!0)},t.prototype.updateMediaStream=function(e){this.videos.forEach((function(t){if(t.video.srcObject=e,c.isIonicIos()){var n=t.video.parentElement,r=t.video;n.replaceChild(r,t.video),t.video=r}}))},t.prototype.emitEvent=function(e,t){this.ee.emitEvent(e,t)},t.prototype.createVideo=function(){return document.createElement("video")},t.prototype.removeSrcObject=function(e){e.video.srcObject=null,this.deactivateStreamPlayingEventExceptionTimeout()},t.prototype.pushNewStreamManagerVideo=function(e){this.videos.push(e),this.addPlayEventToFirstVideo(),-1===this.stream.session.streamManagers.indexOf(this)&&this.stream.session.streamManagers.push(this)},t.prototype.mirrorVideo=function(video){c.isIonicIos()||(video.style.transform="rotateY(180deg)",video.style.webkitTransform="rotateY(180deg)")},t.prototype.removeMirrorVideo=function(video){video.style.transform="unset",video.style.webkitTransform="unset"},t.prototype.activateStreamPlayingEventExceptionTimeout=function(){var e=this;if(this.remote&&null==this.streamPlayingEventExceptionTimeout){var t=this.stream.session.openvidu.advancedConfiguration.noStreamPlayingEventExceptionTimeout||4e3;this.streamPlayingEventExceptionTimeout=setTimeout((function(){var n="StreamManager of Stream "+e.stream.streamId+" ("+(e.remote?"Subscriber":"Publisher")+') did not trigger "streamPlaying" event in '+t+" ms";y.warn(n),e.stream.session.emitEvent("exception",[new E.ExceptionEvent(e.stream.session,E.ExceptionEventName.NO_STREAM_PLAYING_EVENT,e,n)]),delete e.streamPlayingEventExceptionTimeout}),t)}},t.prototype.deactivateStreamPlayingEventExceptionTimeout=function(){clearTimeout(this.streamPlayingEventExceptionTimeout),delete this.streamPlayingEventExceptionTimeout},t}(d.EventDispatcher);t.StreamManager=S},1060:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=void 0;var r=n(1061),o=n(452).OpenViduLogger.getInstance(),c=function(){function e(){this.userHandlerArrowHandler=new WeakMap,this.ee=new r}return e.prototype.off=function(e,t){if(t){var n=this.userHandlerArrowHandler.get(t);n&&this.ee.off(e,n),this.userHandlerArrowHandler.delete(t)}else this.ee.removeAllListeners(e);return this},e.prototype.onAux=function(e,t,n){var r=function(e){e?o.info(t,e):o.info(t),n(e)};return this.userHandlerArrowHandler.set(n,r),this.ee.on(e,r),this},e.prototype.onceAux=function(e,t,n){var r=this,c=function(e){e?o.info(t,e):o.info(t),n(e),r.userHandlerArrowHandler.delete(n)};return this.userHandlerArrowHandler.set(n,c),this.ee.once(e,c),this},e}();t.EventDispatcher=c},1061:function(e,t,n){var r;!function(t){"use strict";function o(){}var c=o.prototype,d=t.EventEmitter;function l(e,t){for(var i=e.length;i--;)if(e[i].listener===t)return i;return-1}function h(e){return function(){return this[e].apply(this,arguments)}}function f(e){return"function"==typeof e||e instanceof RegExp||!(!e||"object"!=typeof e)&&f(e.listener)}c.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp)for(n in t={},r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n]);else t=r[e]||(r[e]=[]);return t},c.flattenListeners=function(e){var i,t=[];for(i=0;i<e.length;i+=1)t.push(e[i].listener);return t},c.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&((t={})[e]=n),t||n},c.addListener=function(e,t){if(!f(t))throw new TypeError("listener must be a function");var n,r=this.getListenersAsObject(e),o="object"==typeof t;for(n in r)r.hasOwnProperty(n)&&-1===l(r[n],t)&&r[n].push(o?t:{listener:t,once:!1});return this},c.on=h("addListener"),c.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},c.once=h("addOnceListener"),c.defineEvent=function(e){return this.getListeners(e),this},c.defineEvents=function(e){for(var i=0;i<e.length;i+=1)this.defineEvent(e[i]);return this},c.removeListener=function(e,t){var n,r,o=this.getListenersAsObject(e);for(r in o)o.hasOwnProperty(r)&&-1!==(n=l(o[r],t))&&o[r].splice(n,1);return this},c.off=h("removeListener"),c.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},c.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},c.manipulateListeners=function(e,t,n){var i,r,o=e?this.removeListener:this.addListener,c=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(i=n.length;i--;)o.call(this,t,n[i]);else for(i in t)t.hasOwnProperty(i)&&(r=t[i])&&("function"==typeof r?o.call(this,i,r):c.call(this,i,r));return this},c.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},c.removeAllListeners=h("removeEvent"),c.emitEvent=function(e,t){var n,r,i,o,c=this.getListenersAsObject(e);for(o in c)if(c.hasOwnProperty(o))for(n=c[o].slice(0),i=0;i<n.length;i++)!0===(r=n[i]).once&&this.removeListener(e,r.listener),r.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,r.listener);return this},c.trigger=h("emitEvent"),c.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},c.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},c._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},c._getEvents=function(){return this._events||(this._events={})},o.noConflict=function(){return t.EventEmitter=d,o},void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r)}("undefined"!=typeof window?window:this||{})},1062:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)});Object.defineProperty(t,"__esModule",{value:!0}),t.StreamManagerEvent=void 0;var c=function(e){function t(t,n,r){var o=e.call(this,!1,t,n)||this;return o.value=r,o}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(n(473).Event);t.StreamManagerEvent=c},1063:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)});Object.defineProperty(t,"__esModule",{value:!0}),t.VideoElementEvent=void 0;var c=function(e){function t(element,t,n){var r=e.call(this,!1,t,n)||this;return r.element=element,r}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(n(473).Event);t.VideoElementEvent=c},1064:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)});Object.defineProperty(t,"__esModule",{value:!0}),t.SessionDisconnectedEvent=void 0;var c=n(473),d=n(452).OpenViduLogger.getInstance(),l=function(e){function t(t,n){var r=e.call(this,!0,t,"sessionDisconnected")||this;return r.reason=n,r}return o(t,e),t.prototype.callDefaultBehavior=function(){d.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'");var e=this.target;e.remoteConnections.forEach((function(t){var n,r,o,c,d,l,h,f,m=t.connectionId;if(null===(n=e.remoteConnections.get(m))||void 0===n?void 0:n.stream){null===(r=e.remoteConnections.get(m))||void 0===r||r.stream.disposeWebRtcPeer(),null===(o=e.remoteConnections.get(m))||void 0===o||o.stream.disposeMediaStream(),(null===(c=e.remoteConnections.get(m))||void 0===c?void 0:c.stream.streamManager)&&(null===(d=e.remoteConnections.get(m))||void 0===d||d.stream.streamManager.removeAllVideos());var v=null===(h=null===(l=e.remoteConnections.get(m))||void 0===l?void 0:l.stream)||void 0===h?void 0:h.streamId;v&&e.remoteStreamsCreated.delete(v),null===(f=e.remoteConnections.get(m))||void 0===f||f.dispose()}e.remoteConnections.delete(m)}))},t}(c.Event);t.SessionDisconnectedEvent=l},1065:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)});Object.defineProperty(t,"__esModule",{value:!0}),t.StreamEvent=void 0;var c=n(473),d=n(1055),l=n(990),h=n(452).OpenViduLogger.getInstance(),f=function(e){function t(t,n,r,o,c){var d=e.call(this,t,n,r)||this;return d.stream=o,d.reason=c,d}return o(t,e),t.prototype.callDefaultBehavior=function(){if("streamDestroyed"===this.type){if(this.target instanceof l.Session)h.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'"),this.stream.disposeWebRtcPeer();else if(this.target instanceof d.Publisher){h.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Publisher'"),clearInterval(this.target.screenShareResizeInterval),this.stream.isLocalStreamReadyToPublish=!1;for(var e=this.target.openvidu.publishers,i=0;i<e.length;i++)if(e[i]===this.target){e.splice(i,1);break}}this.stream.disposeMediaStream(),this.stream.streamManager&&this.stream.streamManager.removeAllVideos(),this.stream.session.remoteStreamsCreated.delete(this.stream.streamId);var t=this.stream.session.remoteConnections.get(this.stream.connection.connectionId);if(t&&t.remoteOptions){var n=t.remoteOptions.streams;for(i=n.length-1;i>=0;--i)n[i].id===this.stream.streamId&&n.splice(i,1)}}},t}(c.Event);t.StreamEvent=f},1119:function(e,t,n){var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)});function c(e){if(!e)return c.__;Array.prototype.reduce||(Array.prototype.reduce=function(e,t){for(var n=t,i=0;i<this.length;i++)n=e(n,this[i],i,this);return n});var t="";return("."+e).split(".").reduce((function(e,n,r,o){t?t+="."+n:t=n;var d=e["__"+t];return void 0===d&&(c.Logger.prototype=e,d=new c.Logger(t),e["__"+t]=d),d}),c.__)}!function(e){function t(e,t,n){void 0!==t[e]&&(null!==t[e]?n[e]=t[e]:delete n[e])}function n(t){if(null!=e.enabled&&!e.enabled)return!1;try{if(t.userAgentRegex&&!new RegExp(t.userAgentRegex).test(navigator.userAgent))return!1}catch(e){}try{if(t.ipRegex&&e.clientIP&&!new RegExp(t.ipRegex).test(e.clientIP))return!1}catch(e){}return!0}function r(e,t){try{if(e.disallow&&new RegExp(e.disallow).test(t))return!1}catch(e){}return!0}function c(e){return"function"==typeof e?e instanceof RegExp?e.toString():e():e}e.requestId="",e.entryId=0,e._createXMLHttpRequest=function(){return new XMLHttpRequest},e._getTime=function(){return(new Date).getTime()},e._console=console,e._appenderNames=[];var d=function(e,meta,t){this.msg=e,this.meta=meta,this.finalString=t};function l(t){var n,r=c(t);switch(typeof r){case"string":return new d(r,null,r);case"number":case"boolean":return n=r.toString(),new d(n,null,n);case"undefined":return new d("undefined",null,"undefined");case"object":return r instanceof RegExp||r instanceof String||r instanceof Number||r instanceof Boolean?(n=r.toString(),new d(n,null,n)):(n="function"==typeof e.serialize?e.serialize.call(this,r):JSON.stringify(r),new d("",r,n));default:return new d("unknown",null,"unknown")}}function h(){return 1e3}function f(){return 2e3}function m(){return 3e3}function v(){return 4e3}function E(){return 5e3}function y(){return 6e3}function S(e){return e<=1e3?"trace":e<=2e3?"debug":e<=3e3?"info":e<=4e3?"warn":e<=5e3?"error":"fatal"}e.setOptions=function(e){return t("enabled",e,this),t("maxMessages",e,this),t("defaultAjaxUrl",e,this),t("clientIP",e,this),t("requestId",e,this),t("defaultBeforeSend",e,this),t("serialize",e,this),this},e.getAllLevel=function(){return-2147483648},e.getTraceLevel=h,e.getDebugLevel=f,e.getInfoLevel=m,e.getWarnLevel=v,e.getErrorLevel=E,e.getFatalLevel=y,e.getOffLevel=function(){return 2147483647};var w=function(data,e){this.inner=e,this.name="JL.Exception",this.message=l(data).finalString};e.Exception=w,w.prototype=new Error;var O=function(e,t,n,r,u){this.l=e,this.m=t,this.n=n,this.t=r,this.u=u};function C(t,n,r){return e.entryId++,new O(t,n,r,e._getTime(),e.entryId)}function I(e){e.id&&(clearTimeout(e.id),e.id=null)}function R(e,t,n){var r=this;e.id||(e.id=setTimeout((function(){n.call(r)}),t))}e.LogItem=O;var P=function(){function o(t,n){this.appenderName=t,this.sendLogItems=n,this.level=e.getTraceLevel(),this.sendWithBufferLevel=2147483647,this.storeInBufferLevel=-2147483648,this.bufferSize=0,this.batchSize=1,this.maxBatchSize=20,this.batchTimeout=2147483647,this.sendTimeout=5e3,this.buffer=[],this.batchBuffer=[],this.batchTimeoutTimer={id:null},this.sendTimeoutTimer={id:null},this.nbrLogItemsSkipped=0,this.nbrLogItemsBeingSent=0;var r="Trying to create an appender without a name or with an empty name";if(null==t)throw r;if(-1!=e._appenderNames.indexOf(t)){if(!t)throw r;throw"Multiple appenders use the same name "+t}e._appenderNames.push(t)}return o.prototype.addLogItemsToBuffer=function(t){if(this.batchBuffer.length>=this.maxBatchSize)this.nbrLogItemsSkipped+=t.length;else{if(null!=e.maxMessages){if(e.maxMessages<1)return;e.maxMessages-=t.length}this.batchBuffer=this.batchBuffer.concat(t);var n=this;R(this.batchTimeoutTimer,this.batchTimeout,(function(){n.sendBatch.call(n)}))}},o.prototype.batchBufferHasOverdueMessages=function(){for(var i=0;i<this.batchBuffer.length;i++){if(e._getTime()-this.batchBuffer[i].t>this.batchTimeout)return!0}return!1},o.prototype.batchBufferHasStrandedMessage=function(){return!(null==e.maxMessages)&&e.maxMessages<1&&this.batchBuffer.length>0},o.prototype.sendBatchIfComplete=function(){(this.batchBuffer.length>=this.batchSize||this.batchBufferHasOverdueMessages()||this.batchBufferHasStrandedMessage())&&this.sendBatch()},o.prototype.onSendingEnded=function(){I(this.sendTimeoutTimer),this.nbrLogItemsBeingSent=0,this.sendBatchIfComplete()},o.prototype.setOptions=function(n){if(t("level",n,this),t("ipRegex",n,this),t("userAgentRegex",n,this),t("disallow",n,this),t("sendWithBufferLevel",n,this),t("storeInBufferLevel",n,this),t("bufferSize",n,this),t("batchSize",n,this),t("maxBatchSize",n,this),t("batchTimeout",n,this),t("sendTimeout",n,this),this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize),this.maxBatchSize<this.batchSize)throw new e.Exception({message:"maxBatchSize cannot be smaller than batchSize",maxBatchSize:this.maxBatchSize,batchSize:this.batchSize});return this},o.prototype.log=function(e,t,meta,o,c,d,l){var h;n(this)&&r(this,d)&&(c<this.storeInBufferLevel||(h=C(c,d,l),c<this.level?this.bufferSize>0&&(this.buffer.push(h),this.buffer.length>this.bufferSize&&this.buffer.shift()):(this.addLogItemsToBuffer([h]),c>=this.sendWithBufferLevel&&this.buffer.length&&(this.addLogItemsToBuffer(this.buffer),this.buffer.length=0),this.sendBatchIfComplete())))},o.prototype.sendBatch=function(){if(!(this.nbrLogItemsBeingSent>0)&&(I(this.batchTimeoutTimer),0!=this.batchBuffer.length)){this.nbrLogItemsBeingSent=this.batchBuffer.length;var e=this;R(this.sendTimeoutTimer,this.sendTimeout,(function(){e.onSendingEnded.call(e)})),this.sendLogItems(this.batchBuffer,(function(){e.batchBuffer.splice(0,e.nbrLogItemsBeingSent),e.nbrLogItemsSkipped>0&&(e.batchBuffer.push(C(4e3,"Lost "+e.nbrLogItemsSkipped+" messages. Either connection with the server was down or logging was disabled via the enabled option. Reduce lost messages by increasing the ajaxAppender option maxBatchSize.",e.appenderName)),e.nbrLogItemsSkipped=0),e.onSendingEnded.call(e)}))}},o}();e.Appender=P;var k=function(r){function c(e){return r.call(this,e,c.prototype.sendLogItemsAjax)||this}return o(c,r),c.prototype.setOptions=function(e){return t("url",e,this),t("beforeSend",e,this),r.prototype.setOptions.call(this,e),this},c.prototype.sendLogItemsAjax=function(t,r){try{if(!n(this))return;this.xhr&&0!=this.xhr.readyState&&4!=this.xhr.readyState&&this.xhr.abort(),this.xhr=e._createXMLHttpRequest();var o="/jsnlog.logger";null!=e.defaultAjaxUrl&&(o=e.defaultAjaxUrl),this.url&&(o=this.url),this.xhr.open("POST",o),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.setRequestHeader("JSNLog-RequestId",e.requestId);var c=this;this.xhr.onreadystatechange=function(){4==c.xhr.readyState&&c.xhr.status>=200&&c.xhr.status<300&&r()};var d={r:e.requestId,lg:t};"function"==typeof this.beforeSend?this.beforeSend.call(this,this.xhr,d):"function"==typeof e.defaultBeforeSend&&e.defaultBeforeSend.call(this,this.xhr,d);var l=JSON.stringify(d);this.xhr.send(l)}catch(e){}},c}(P);e.AjaxAppender=k;var _=function(t){function r(e){return t.call(this,e,r.prototype.sendLogItemsConsole)||this}return o(r,t),r.prototype.clog=function(t){e._console.log(t)},r.prototype.cerror=function(t){e._console.error?e._console.error(t):this.clog(t)},r.prototype.cwarn=function(t){e._console.warn?e._console.warn(t):this.clog(t)},r.prototype.cinfo=function(t){e._console.info?e._console.info(t):this.clog(t)},r.prototype.cdebug=function(t){e._console.debug?e._console.debug(t):this.cinfo(t)},r.prototype.sendLogItemsConsole=function(t,r){try{if(!n(this))return;if(!e._console)return;var i;for(i=0;i<t.length;++i){var li=t[i],o=li.n+": "+li.m;"undefined"==typeof window&&(o=new Date(li.t)+" | "+o),li.l<=e.getDebugLevel()?this.cdebug(o):li.l<=e.getInfoLevel()?this.cinfo(o):li.l<=e.getWarnLevel()?this.cwarn(o):this.cerror(o)}}catch(e){}r()},r}(P);e.ConsoleAppender=_;var N,T=function(){function e(e){this.loggerName=e,this.seenRegexes=[]}return e.prototype.setOptions=function(e){return t("level",e,this),t("userAgentRegex",e,this),t("disallow",e,this),t("ipRegex",e,this),t("appenders",e,this),t("onceOnly",e,this),this.seenRegexes=[],this},e.prototype.buildExceptionObject=function(e){var t={};return e.stack?t.stack=e.stack:t.e=e,e.message&&(t.message=e.message),e.name&&(t.name=e.name),e.data&&(t.data=e.data),e.inner&&(t.inner=this.buildExceptionObject(e.inner)),t},e.prototype.log=function(e,t,o){var d,h,i=0;if(!this.appenders)return this;if(e>=this.level&&n(this)&&(o?(h=this.buildExceptionObject(o)).logData=c(t):h=t,r(this,(d=l(h)).finalString))){if(this.onceOnly)for(i=this.onceOnly.length-1;i>=0;){if(new RegExp(this.onceOnly[i]).test(d.finalString)){if(this.seenRegexes[i])return this;this.seenRegexes[i]=!0}i--}for(d.meta=d.meta||{},i=this.appenders.length-1;i>=0;)this.appenders[i].log(S(e),d.msg,d.meta,(function(){}),e,d.finalString,this.loggerName),i--}return this},e.prototype.trace=function(e){return this.log(1e3,e)},e.prototype.debug=function(e){return this.log(2e3,e)},e.prototype.info=function(e){return this.log(3e3,e)},e.prototype.warn=function(e){return this.log(4e3,e)},e.prototype.error=function(e){return this.log(5e3,e)},e.prototype.fatal=function(e){return this.log(6e3,e)},e.prototype.fatalException=function(e,t){return this.log(6e3,e,t)},e}();e.Logger=T,e.createAjaxAppender=function(e){return new k(e)},e.createConsoleAppender=function(e){return new _(e)},N="undefined"!=typeof window?new k(""):new _(""),e.__=new e.Logger(""),e.__.setOptions({level:e.getDebugLevel(),appenders:[N]})}(c||(c={})),t.__esModule=!0,t.JL=c,"function"==typeof __jsnlog_configure&&__jsnlog_configure(c),"undefined"==typeof window||window.onerror||(window.onerror=function(e,t,n,r,o){return c("onerrorLogger").fatalException({msg:"Uncaught Exception",errorMsg:e?e.message||e:"",url:t,"line number":n,column:r},o),!1}),"undefined"==typeof window||window.onunhandledrejection||(window.onunhandledrejection=function(e){c("onerrorLogger").fatalException({msg:"unhandledrejection",errorMsg:e.reason?e.reason.message:e.message||null},e.reason)})},1120:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalRecorder=void 0;var r,o=n(1121),c=n(452),d=n(568),l=c.OpenViduLogger.getInstance(),h=function(){function e(e){this.stream=e,this.chunks=[],r=d.PlatformUtils.getInstance(),this.connectionId=this.stream.connection?this.stream.connection.connectionId:"default-connection",this.id=this.stream.streamId+"_"+this.connectionId+"_localrecord",this.state=o.LocalRecorderState.READY}return e.prototype.record=function(e){var t=this;return new Promise((function(n,r){try{if("undefined"==typeof MediaRecorder)throw l.error("MediaRecorder not supported on your browser. See compatibility in https://caniuse.com/#search=MediaRecorder"),Error("MediaRecorder not supported on your browser. See compatibility in https://caniuse.com/#search=MediaRecorder");if(t.state!==o.LocalRecorderState.READY)throw Error("'LocalRecord.record()' needs 'LocalRecord.state' to be 'READY' (current value: '"+t.state+"'). Call 'LocalRecorder.clean()' or init a new LocalRecorder before");l.log("Starting local recording of stream '"+t.stream.streamId+"' of connection '"+t.connectionId+"'");var c={};"function"==typeof MediaRecorder.isTypeSupported?e?(MediaRecorder.isTypeSupported(e)||r(new Error('mimeType "'+e+'" is not supported')),c={mimeType:e}):l.log("No mimeType parameter provided. Using default codecs"):l.warn("MediaRecorder#isTypeSupported is not supported. Using default codecs"),t.mediaRecorder=new MediaRecorder(t.stream.getMediaStream(),c),t.mediaRecorder.start(10)}catch(e){r(e)}t.mediaRecorder.ondataavailable=function(e){t.chunks.push(e.data)},t.mediaRecorder.onerror=function(e){l.error("MediaRecorder error: ",e)},t.mediaRecorder.onstart=function(){l.log("MediaRecorder started (state="+t.mediaRecorder.state+")")},t.mediaRecorder.onstop=function(){t.onStopDefault()},t.mediaRecorder.onpause=function(){l.log("MediaRecorder paused (state="+t.mediaRecorder.state+")")},t.mediaRecorder.onresume=function(){l.log("MediaRecorder resumed (state="+t.mediaRecorder.state+")")},t.mediaRecorder.onwarning=function(e){l.log("MediaRecorder warning: "+e)},t.state=o.LocalRecorderState.RECORDING,n()}))},e.prototype.stop=function(){var e=this;return new Promise((function(t,n){try{if(e.state===o.LocalRecorderState.READY||e.state===o.LocalRecorderState.FINISHED)throw Error("'LocalRecord.stop()' needs 'LocalRecord.state' to be 'RECORDING' or 'PAUSED' (current value: '"+e.state+"'). Call 'LocalRecorder.start()' before");e.mediaRecorder.onstop=function(){e.onStopDefault(),t()},e.mediaRecorder.stop()}catch(e){n(e)}}))},e.prototype.pause=function(){var e=this;return new Promise((function(t,n){try{e.state!==o.LocalRecorderState.RECORDING&&n(Error("'LocalRecord.pause()' needs 'LocalRecord.state' to be 'RECORDING' (current value: '"+e.state+"'). Call 'LocalRecorder.start()' or 'LocalRecorder.resume()' before")),e.mediaRecorder.pause(),e.state=o.LocalRecorderState.PAUSED,t()}catch(e){n(e)}}))},e.prototype.resume=function(){var e=this;return new Promise((function(t,n){try{if(e.state!==o.LocalRecorderState.PAUSED)throw Error("'LocalRecord.resume()' needs 'LocalRecord.state' to be 'PAUSED' (current value: '"+e.state+"'). Call 'LocalRecorder.pause()' before");e.mediaRecorder.resume(),e.state=o.LocalRecorderState.RECORDING,t()}catch(e){n(e)}}))},e.prototype.preview=function(e){if(this.state!==o.LocalRecorderState.FINISHED)throw Error("'LocalRecord.preview()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");if(this.videoPreview=document.createElement("video"),this.videoPreview.id=this.id,this.videoPreview.autoplay=!0,r.isSafariBrowser()&&this.videoPreview.setAttribute("playsinline","true"),"string"==typeof e){var t=document.getElementById(e);t&&(this.videoPreview=t.appendChild(this.videoPreview))}else this.videoPreview=e.appendChild(this.videoPreview);return this.videoPreview.src=this.videoPreviewSrc,this.videoPreview},e.prototype.clean=function(){var e=this,t=function(){delete e.blob,e.chunks=[],delete e.mediaRecorder,e.state=o.LocalRecorderState.READY};this.state===o.LocalRecorderState.RECORDING||this.state===o.LocalRecorderState.PAUSED?this.stop().then((function(){return t()})).catch((function(){return t()})):t()},e.prototype.download=function(){if(this.state!==o.LocalRecorderState.FINISHED)throw Error("'LocalRecord.download()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");var a=document.createElement("a");a.style.display="none",document.body.appendChild(a);var e=window.URL.createObjectURL(this.blob);a.href=e,a.download=this.id+".webm",a.click(),window.URL.revokeObjectURL(e),document.body.removeChild(a)},e.prototype.getBlob=function(){if(this.state!==o.LocalRecorderState.FINISHED)throw Error("Call 'LocalRecord.stop()' before getting Blob file");return this.blob},e.prototype.uploadAsBinary=function(e,t){var n=this;return new Promise((function(r,c){if(n.state!==o.LocalRecorderState.FINISHED)c(Error("'LocalRecord.uploadAsBinary()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+n.state+"'). Call 'LocalRecorder.stop()' before"));else{var d=new XMLHttpRequest;if(d.open("POST",e,!0),"object"==typeof t)for(var l=0,h=Object.keys(t);l<h.length;l++){var f=h[l];d.setRequestHeader(f,t[f])}d.onreadystatechange=function(){4===d.readyState&&("2"===d.status.toString().charAt(0)?r(d.responseText):c(d.status))},d.send(n.blob)}}))},e.prototype.uploadAsMultipartfile=function(e,t){var n=this;return new Promise((function(r,c){if(n.state!==o.LocalRecorderState.FINISHED)c(Error("'LocalRecord.uploadAsMultipartfile()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+n.state+"'). Call 'LocalRecorder.stop()' before"));else{var d=new XMLHttpRequest;if(d.open("POST",e,!0),"object"==typeof t)for(var l=0,h=Object.keys(t);l<h.length;l++){var f=h[l];d.setRequestHeader(f,t[f])}var m=new FormData;m.append("file",n.blob,n.id+".webm"),d.onreadystatechange=function(){4===d.readyState&&("2"===d.status.toString().charAt(0)?r(d.responseText):c(d.status))},d.send(m)}}))},e.prototype.onStopDefault=function(){l.log("MediaRecorder stopped  (state="+this.mediaRecorder.state+")"),this.blob=new Blob(this.chunks,{type:"video/webm"}),this.chunks=[],this.videoPreviewSrc=window.URL.createObjectURL(this.blob),this.state=o.LocalRecorderState.FINISHED},e}();t.LocalRecorder=h},1121:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalRecorderState=void 0,function(e){e.READY="READY",e.RECORDING="RECORDING",e.PAUSED="PAUSED",e.FINISHED="FINISHED"}(t.LocalRecorderState||(t.LocalRecorderState={}))},1122:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenViduLoggerConfiguration=void 0,function(e){e.disabled="disabled",e.debug="debug",e.debug_app="debug_app"}(t.OpenViduLoggerConfiguration||(t.OpenViduLoggerConfiguration={}))},1123:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=void 0;var r=n(1056),o=n(452),c=n(966),d=o.OpenViduLogger.getInstance(),l=function(){function e(e,t){this.session=e,this.disposed=!1;var n="'Connection' created ";t.role?(this.localOptions=t,this.connectionId=this.localOptions.id,this.creationTime=this.localOptions.createdAt,this.data=this.localOptions.metadata,this.rpcSessionId=this.localOptions.sessionId,this.role=this.localOptions.role,this.record=this.localOptions.record,n+="(local)"):(this.remoteOptions=t,this.connectionId=this.remoteOptions.id,this.creationTime=this.remoteOptions.createdAt,this.remoteOptions.metadata&&(this.data=this.remoteOptions.metadata),this.remoteOptions.streams&&this.initRemoteStreams(this.remoteOptions.streams),n+="(remote) with 'connectionId' ["+this.remoteOptions.id+"]"),d.info(n)}return e.prototype.sendIceCandidate=function(e){var t=this;d.debug((this.stream.outboundStreamOpts?"Local":"Remote")+"candidate for"+this.connectionId,e),this.session.openvidu.sendRequest("onIceCandidate",{endpointName:this.connectionId,candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex},(function(e,n){e&&(d.error("Error sending ICE candidate: "+JSON.stringify(e)),t.session.emitEvent("exception",[new c.ExceptionEvent(t.session,c.ExceptionEventName.ICE_CANDIDATE_ERROR,t.session,"There was an unexpected error on the server-side processing an ICE candidate generated and sent by the client-side",e)]))}))},e.prototype.initRemoteStreams=function(e){var t=this;e.forEach((function(e){var n={id:e.id,createdAt:e.createdAt,connection:t,hasAudio:e.hasAudio,hasVideo:e.hasVideo,audioActive:e.audioActive,videoActive:e.videoActive,typeOfVideo:e.typeOfVideo,frameRate:e.frameRate,videoDimensions:e.videoDimensions?JSON.parse(e.videoDimensions):void 0,filter:e.filter?e.filter:void 0},o=new r.Stream(t.session,n);t.addStream(o)})),d.info("Remote 'Connection' with 'connectionId' ["+this.connectionId+"] is now configured for receiving Streams with options: ",this.stream.inboundStreamOpts)},e.prototype.addStream=function(e){e.connection=this,this.stream=e},e.prototype.removeStream=function(e){delete this.stream},e.prototype.dispose=function(){this.stream&&delete this.stream,this.disposed=!0},e}();t.Connection=l},1124:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)});Object.defineProperty(t,"__esModule",{value:!0}),t.PublisherSpeakingEvent=void 0;var c=function(e){function t(t,n,r,o){var c=e.call(this,!1,t,n)||this;return c.type=n,c.connection=r,c.streamId=o,c}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(n(473).Event);t.PublisherSpeakingEvent=c},1125:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)});Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionEvent=void 0;var c=function(e){function t(t,n,r,o,c){var d=e.call(this,t,n,r)||this;return d.connection=o,d.reason=c,d}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(n(473).Event);t.ConnectionEvent=c},1126:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)});Object.defineProperty(t,"__esModule",{value:!0}),t.FilterEvent=void 0;var c=function(e){function t(t,n,data){var r=e.call(this,!1,t,n)||this;return r.data=data,r}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(n(473).Event);t.FilterEvent=c},1127:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)});Object.defineProperty(t,"__esModule",{value:!0}),t.RecordingEvent=void 0;var c=function(e){function t(t,n,r,o,c){var d=e.call(this,!1,t,n)||this;return d.id=r,o!==r&&(d.name=o),d.reason=c,d}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(n(473).Event);t.RecordingEvent=c},1128:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)});Object.defineProperty(t,"__esModule",{value:!0}),t.SignalEvent=void 0;var c=function(e){function t(t,n,data,r){var o=e.call(this,!1,t,"signal")||this;return n&&(o.type="signal:"+n),o.data=data,o.from=r,o}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(n(473).Event);t.SignalEvent=c},1129:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)});Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionPropertyChangedEvent=void 0;var c=function(e){function t(t,n,r,o,c){var d=e.call(this,!1,t,"connectionPropertyChanged")||this;return d.connection=n,d.changedProperty=r,d.newValue=o,d.oldValue=c,d}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(n(473).Event);t.ConnectionPropertyChangedEvent=c},1130:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)});Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkQualityLevelChangedEvent=void 0;var c=function(e){function t(t,n,r,o){var c=e.call(this,!1,t,"networkQualityLevelChanged")||this;return c.newValue=n,c.oldValue=r,c.connection=o,c}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(n(473).Event);t.NetworkQualityLevelChangedEvent=c},1131:function(e,t,n){var r=!1;if(Object.defineProperty)try{Object.defineProperty({},"x",{})}catch(e){r=!0}Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},o=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,o.prototype=new r,o});var o=n(1258).EventEmitter,c=n(1259),d=n(1260),l=n(1263),h=5e3;function f(e){if(e){if(e instanceof Function)return{send:e};if(e.send instanceof Function)return e;if(e.postMessage instanceof Function)return e.send=e.postMessage,e;if(e.write instanceof Function)return e.send=e.write,e;if(void 0===e.onmessage&&!(e.pause instanceof Function))throw new SyntaxError("Transport is not a function nor a valid object")}}function m(e,t){r?(this.method=e,this.params=t):(Object.defineProperty(this,"method",{value:e,enumerable:!0}),Object.defineProperty(this,"params",{value:t,enumerable:!0}))}function v(e,t,n,d){var v=this;if(!e)throw new SyntaxError("Packer is not defined");if(!e.pack||!e.unpack)throw new SyntaxError("Packer is invalid");var E=function(e){if(!e)return{};for(var t in e){var n=e[t];"string"==typeof n&&(e[t]={response:n})}return e}(e.responseMethods);if(t instanceof Function){if(null!=n)throw new SyntaxError("There can't be parameters after onRequest");d=t,n=void 0,t=void 0}if(t&&t.send instanceof Function){if(n&&!(n instanceof Function))throw new SyntaxError("Only a function can be after transport");d=n,n=t,t=void 0}if(n instanceof Function){if(null!=d)throw new SyntaxError("There can't be parameters after onRequest");d=n,n=void 0}if(n&&n.send instanceof Function&&d&&!(d instanceof Function))throw new SyntaxError("Only a function can be after transport");t=t||{},o.call(this),d&&this.on("request",d),r?this.peerID=t.peerID:Object.defineProperty(this,"peerID",{value:t.peerID});var y=t.max_retries||0;function S(e){v.decode(e.data||e)}this.getTransport=function(){return n},this.setTransport=function(e){n&&(n.removeEventListener?n.removeEventListener("message",S):n.removeListener&&n.removeListener("data",S)),e&&(e.addEventListener?e.addEventListener("message",S):e.addListener&&e.addListener("data",S)),n=f(e)},r||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)}),this.setTransport(n);var w=t.request_timeout||h,O=t.ping_request_timeout||w,C=t.response_timeout||h,I=t.duplicates_timeout||h,R=0,P=new l,k=new l,_=new l,N={};function T(e,t){var n=setTimeout((function(){_.remove(e,t)}),I);_.set(n,e,t)}function L(t,n,o,c,d){m.call(this,t,n),this.getTransport=function(){return d},this.setTransport=function(e){d=f(e)},r||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)});var l=k.get(o,c);d||v.getTransport()||(r?this.duplicated=Boolean(l):Object.defineProperty(this,"duplicated",{value:Boolean(l)}));var h=E[t];this.pack=e.pack.bind(e,this,o),this.reply=function(t,n,r){if(t instanceof Function||t&&t.send instanceof Function){if(null!=n)throw new SyntaxError("There can't be parameters after callback");r=t,n=null,t=void 0}else if(n instanceof Function||n&&n.send instanceof Function){if(null!=r)throw new SyntaxError("There can't be parameters after callback");r=n,n=null}var d;if(r=f(r),l&&clearTimeout(l.timeout),null!=c&&(t&&(t.dest=c),n&&(n.dest=c)),t||null!=n){if(null!=v.peerID&&(t?t.from=v.peerID:n.from=v.peerID),h)if(null==h.error&&t)d={error:t};else d={method:t?h.error:h.response,params:t||n};else d={error:t,result:n};d=e.pack(d,o)}else d=l?l.message:e.pack({result:null},o);return function(e,t,n){var r={message:e,timeout:setTimeout((function(){k.remove(t,n)}),C)};k.set(r,t,n)}(d,o,c),(r=r||this.getTransport()||v.getTransport())?r.send(d):d}}function M(e){var t=N[e];if(t){delete N[e];var n=P.pop(t.id,t.dest);n&&(clearTimeout(n.timeout),T(t.id,t.dest))}}c(L,m),this.cancel=function(e){if(e)return M(e);for(var e in N)M(e)},this.close=function(){var e=this.getTransport();e&&e.close&&e.close(4003,"Cancel request"),this.cancel(),_.forEach(clearTimeout),k.forEach((function(e){clearTimeout(e.timeout)}))},this.encode=function(t,n,r,o,c){if(n instanceof Function){if(null!=r)throw new SyntaxError("There can't be parameters after callback");c=n,o=void 0,r=void 0,n=void 0}else if(r instanceof Function){if(null!=o)throw new SyntaxError("There can't be parameters after callback");c=r,o=void 0,r=void 0}else if(o instanceof Function){if(null!=c)throw new SyntaxError("There can't be parameters after callback");c=o,o=void 0}null!=v.peerID&&((n=n||{}).from=v.peerID),null!=r&&((n=n||{}).dest=r);var d={method:t,params:n};if(c){var l=R++,h=0;function m(e,t){v.cancel(d),c(e,t)}var S={message:d=e.pack(d,l),callback:m,responseMethods:E[t]||{}},C=f(o);function I(e){var rt="ping"===t?O:w;return S.timeout=setTimeout(T,rt*Math.pow(2,h++)),N[d]={id:l,dest:r},P.set(S,l,r),(e=e||C||v.getTransport())?e.send(d):d}function k(e){e=f(e),console.warn(h+" retry for request message:",d);var t=_.pop(l,r);return clearTimeout(t),I(e)}function T(){if(h<y)return k(o);var e=new Error("Request has timed out");e.request=d,e.retry=k,m(e)}return I(o)}return d=e.pack(d),(o=o||this.getTransport())?o.send(d):d},this.decode=function(t,n){if(!t)throw new TypeError("Message is not defined");try{t=e.unpack(t)}catch(e){return console.debug(e,t)}var r=t.id,o=t.ack,c=t.method,d=t.params||{},l=d.from,h=d.dest;if(null==v.peerID||l!=v.peerID){if(null==r&&null==o){var E=new m(c,d);if(v.emit("request",E))return;return E}if(c){if(null==h||h==v.peerID){if(O=P.get(o,l)){var y=O.responseMethods;return c==y.error?R(O,d):c==y.response?R(O,null,d):I()}if(C=_.get(o,l))return N(C)}return I()}var S=t.error,w=t.result;if(!(S&&S.dest&&S.dest!=v.peerID||w&&w.dest&&w.dest!=v.peerID)){var O,C;if(!(O=P.get(o,l)))return(C=_.get(o,l))?N(C):console.warn("No callback was defined for this message",t);R(O,S,w)}}function I(){if(n=f(n)||v.getTransport()){var e=k.get(r,l);if(e)return n.send(e.message)}var t=new L(c,d,null!=r?r:o,l,n);if(!v.emit("request",t))return t}function R(e,t,n){e.callback(t,n)}function N(e){console.warn("Response already processed",t),clearTimeout(e),T(o,l)}}}c(v,o),v.RpcNotification=m,e.exports=v;var E=n(1264),y=n(1266);v.clients=E,v.clients.transports=y,v.packers=d},1132:function(e,t,n){"use strict";var r=n(452).OpenViduLogger.getInstance();e.exports=function(e){var t,n=!1,o=e.uri,c=!1,d=new WebSocket(o);d.onopen=function(){r.debug("WebSocket connected to "+o),e.onconnected&&e.onconnected()},d.onerror=function(t){r.error("Could not connect to "+o+" (invoking onerror if defined)",t),e.onerror&&e.onerror(t)};var l=function(){3===d.readyState?n?r.debug("Connection closed by user"):e.ismasternodecrashed()?r.error("Master Node has crashed. Stopping reconnection process"):(r.debug("Connection closed unexpectedly. Reconnecting..."),h(2e3,1)):r.debug("Close callback from previous websocket. Ignoring it")};function h(n,f){if(r.debug("reconnect (attempt #"+f+", max="+n+")"),1===f){if(c)return void r.warn("Trying to reconnect when already reconnecting... Ignoring this reconnection.");c=!0,e.onreconnecting&&e.onreconnecting()}!function(n,f){r.debug("Reconnection attempt #"+f),d.close(),(d=new WebSocket(o)).onopen=function(){r.debug("Reconnected to "+o+" after "+f+" attempts..."),c=!1,t(),e.onreconnected()&&e.onreconnected(),d.onclose=l},d.onerror=function(t){r.warn("Reconnection error: ",t),f===n?e.ondisconnect&&e.ondisconnect():setTimeout((function(){h(n,f+1)}),3e3)}}(n,f)}d.onclose=l,this.close=function(){n=!0,d.close()},this.forceClose=function(){d.close()},this.reconnectWs=function(){r.debug("reconnectWs"),h(2e3,1)},this.send=function(e){d.send(e)},this.addEventListener=function(e,n){(t=function(){d.addEventListener(e,n)})()},this.getReadyState=function(){return d.readyState}}},1245:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenVidu=void 0;var r,o=n(1120),c=n(1055),d=n(990),l=n(1064),h=n(803),f=n(804),m=n(991),v=n(452),E=n(568),y=n(1256),S=n(1257),w=n(1122),O=n(1061),C=n(1131),I=n(1267),R=v.OpenViduLogger.getInstance(),P=function(){function e(){var e=this;this.masterNodeHasCrashed=!1,this.publishers=[],this.secret="",this.recorder=!1,this.life=-1,this.advancedConfiguration={},this.webrtcStatsInterval=-1,this.sendBrowserLogs=w.OpenViduLoggerConfiguration.disabled,this.isPro=!1,this.ee=new O,r=E.PlatformUtils.getInstance(),this.libraryVersion=I.version,R.info("OpenVidu initialized"),R.info("Platform detected: "+r.getDescription()),R.info("openvidu-browser version: "+this.libraryVersion),(r.isMobileDevice()||r.isReactNative())&&this.onOrientationChanged((function(){e.publishers.forEach((function(t){t.stream.isLocalStreamPublished&&t.stream&&t.stream.hasVideo&&e.sendNewVideoDimensionsIfRequired(t,"deviceRotated",75,10)}))}))}return e.prototype.onOrientationChanged=function(e){window.addEventListener("orientationchange",e)},e.prototype.sendNewVideoDimensionsIfRequired=function(e,t,n,r){var o=this,c=0,d=e.stream.videoDimensions.width,l=e.stream.videoDimensions.height,h=setInterval((function(){++c>r&&clearTimeout(h),e.getVideoDimensions(e.stream.getMediaStream()).then((function(n){n.width===d&&n.height===l||(clearTimeout(h),o.sendVideoDimensionsChangedEvent(e,t,d,l,n.width,n.height))}))}),n)},e.prototype.sendVideoDimensionsChangedEvent=function(e,t,n,r,o,c){var d=this;e.stream.videoDimensions={width:o||0,height:c||0},this.sendRequest("streamPropertyChanged",{streamId:e.stream.streamId,property:"videoDimensions",newValue:JSON.stringify(e.stream.videoDimensions),reason:t},(function(o,c){o?R.error("Error sending 'streamPropertyChanged' event",o):(d.session.emitEvent("streamPropertyChanged",[new h.StreamPropertyChangedEvent(d.session,e.stream,"videoDimensions",e.stream.videoDimensions,{width:n,height:r},t)]),e.emitEvent("streamPropertyChanged",[new h.StreamPropertyChangedEvent(e,e.stream,"videoDimensions",e.stream.videoDimensions,{width:n,height:r},t)]),d.session.sendVideoData(e))}))},e.prototype.initSession=function(){return this.session=new d.Session(this),this.session},e.prototype.initPublisher=function(e,t,n){var r;r=t&&"function"!=typeof t?{audioSource:void 0!==(r=t).audioSource?r.audioSource:void 0,frameRate:"undefined"!=typeof MediaStreamTrack&&r.videoSource instanceof MediaStreamTrack?void 0:void 0!==r.frameRate?r.frameRate:void 0,insertMode:void 0!==r.insertMode?"string"==typeof r.insertMode?m.VideoInsertMode[r.insertMode]:r.insertMode:m.VideoInsertMode.APPEND,mirror:void 0===r.mirror||r.mirror,publishAudio:void 0===r.publishAudio||r.publishAudio,publishVideo:void 0===r.publishVideo||r.publishVideo,resolution:"undefined"!=typeof MediaStreamTrack&&r.videoSource instanceof MediaStreamTrack?void 0:void 0!==r.resolution?r.resolution:"640x480",videoSource:void 0!==r.videoSource?r.videoSource:void 0,filter:r.filter}:{insertMode:m.VideoInsertMode.APPEND,mirror:!0,publishAudio:!0,publishVideo:!0,resolution:"640x480"};var o,d=new c.Publisher(e,r,this);return t&&"function"==typeof t?o=t:n&&(o=n),d.initialize().then((function(){void 0!==o&&o(void 0),d.emitEvent("accessAllowed",[])})).catch((function(e){void 0!==o&&o(e),d.emitEvent("accessDenied",[e])})),this.publishers.push(d),d},e.prototype.initPublisherAsync=function(e,t){var n=this;return new Promise((function(r,o){var c,d=function(e){e?o(e):r(c)};c=t?n.initPublisher(e,t,d):n.initPublisher(e,d)}))},e.prototype.initLocalRecorder=function(e){return new o.LocalRecorder(e)},e.prototype.checkSystemRequirements=function(){return r.isIPhoneOrIPad()?r.isIOSWithSafari()||r.isIonicIos()||r.isChromeMobileBrowser()||r.isEdgeMobileBrowser()||r.isOperaMobileBrowser()||r.isFirefoxMobileBrowser()?1:0:r.isChromeBrowser()||r.isChromeMobileBrowser()||r.isFirefoxBrowser()||r.isFirefoxMobileBrowser()||r.isOperaBrowser()||r.isOperaMobileBrowser()||r.isEdgeBrowser()||r.isEdgeMobileBrowser()||r.isSafariBrowser()||r.isAndroidBrowser()||r.isElectron()||r.isSamsungBrowser()?1:0},e.prototype.checkScreenSharingCapabilities=function(){return r.canScreenShare()},e.prototype.getDevices=function(){return new Promise((function(e,t){navigator.mediaDevices.enumerateDevices().then((function(t){var n,o=[];r.isIonicAndroid()&&"undefined"!=typeof cordova&&(null===(n=null===cordova||void 0===cordova?void 0:cordova.plugins)||void 0===n?void 0:n.EnumerateDevicesPlugin)?cordova.plugins.EnumerateDevicesPlugin.getEnumerateDevices().then((function(n){var r=[],c=[],d=[];r=n.filter((function(e){return"audioinput"===e.kind})),c=t.filter((function(e){return"videoinput"===e.kind})),d=t.filter((function(e){return"audioinput"===e.kind})),c.forEach((function(e,t){if(e.label)o.push({kind:e.kind,deviceId:e.deviceId,label:e.label});else{var label="";label=0===t?"Front Camera":1===t?"Back Camera":"Unknown Camera",o.push({kind:e.kind,deviceId:e.deviceId,label:label})}})),d.forEach((function(e,t){if(e.label)o.push({kind:e.kind,deviceId:e.deviceId,label:e.label});else{var label="";switch(t){case 0:label="Default";break;case 1:var n=r.filter((function(e){return e.label.includes("Built")}))[0];label=n?n.label:"Built-in Microphone";break;case 2:var c=r.filter((function(e){return e.label.includes("Wired")}))[0];label=c?c.label:"Headset earpiece";break;case 3:var d=r.filter((function(e){return e.label.includes("Bluetooth")}))[0];label=d?d.label:"Wireless";break;default:label="Unknown Microphone"}o.push({kind:e.kind,deviceId:e.deviceId,label:label})}})),e(o)})):(t.forEach((function(e){"audioinput"!==e.kind&&"videoinput"!==e.kind||o.push({kind:e.kind,deviceId:e.deviceId,label:e.label})})),e(o))})).catch((function(e){R.error("Error getting devices",e),t(e)}))}))},e.prototype.getUserMedia=function(e){var t=this;return new Promise((function(n,o){var c=function(e,r){var c={audio:void 0===r.audio||r.audio,video:!1};navigator.mediaDevices.getUserMedia(c).then((function(t){e.addTrack(t.getAudioTracks()[0]),n(e)})).catch((function(n){e.getAudioTracks().forEach((function(track){track.stop()})),e.getVideoTracks().forEach((function(track){track.stop()})),o(t.generateAudioDeviceError(n,c))}))};t.generateMediaConstraints(e).then((function(d){var l,h;if(d.videoTrack&&d.audioTrack||d.audioTrack&&!1===(null===(l=d.constraints)||void 0===l?void 0:l.video)||d.videoTrack&&!1===(null===(h=d.constraints)||void 0===h?void 0:h.audio))n(t.addAlreadyProvidedTracks(d,new MediaStream));else{d.videoTrack&&delete d.constraints.video,d.audioTrack&&delete d.constraints.audio;var m=!1;if("string"==typeof e.videoSource&&("screen"===e.videoSource||"window"===e.videoSource||r.isElectron()&&e.videoSource.startsWith("screen:"))&&(m=!d.audioTrack&&null!==e.audioSource&&!1!==e.audioSource,navigator.mediaDevices.getDisplayMedia&&!r.isElectron()))return void navigator.mediaDevices.getDisplayMedia({video:!0}).then((function(e){t.addAlreadyProvidedTracks(d,e),m?c(e,d.constraints):n(e)})).catch((function(e){var t=f.OpenViduErrorName.SCREEN_CAPTURE_DENIED,n=e.toString();o(new f.OpenViduError(t,n))}));var v=m?{video:d.constraints.video}:d.constraints;navigator.mediaDevices.getUserMedia(v).then((function(e){t.addAlreadyProvidedTracks(d,e),m?c(e,d.constraints):n(e)})).catch((function(t){var n,r=t.toString();n="screen"!==e.videoSource?f.OpenViduErrorName.DEVICE_ACCESS_DENIED:f.OpenViduErrorName.SCREEN_CAPTURE_DENIED,o(new f.OpenViduError(n,r))}))}})).catch((function(e){o(e)}))}))},e.prototype.enableProdMode=function(){R.enableProdMode()},e.prototype.setAdvancedConfiguration=function(e){this.advancedConfiguration=e},e.prototype.generateMediaConstraints=function(e){var t=this;return new Promise((function(n,r){var o={audioTrack:void 0,videoTrack:void 0,constraints:{audio:void 0,video:void 0}},c=e.audioSource,d=e.videoSource;if(null!==c&&!1!==c||(o.constraints.audio=!1),null!==d&&!1!==d||(o.constraints.video=!1),!1===o.constraints.audio&&!1===o.constraints.video&&r(new f.OpenViduError(f.OpenViduErrorName.NO_INPUT_SOURCE_SET,"Properties 'audioSource' and 'videoSource' cannot be set to false or null at the same time")),"undefined"!=typeof MediaStreamTrack&&c instanceof MediaStreamTrack&&(o.audioTrack=c),"undefined"!=typeof MediaStreamTrack&&d instanceof MediaStreamTrack&&(o.videoTrack=d),void 0===c&&(o.constraints.audio=!0),void 0===d&&(o.constraints.video={width:{ideal:640},height:{ideal:480}}),null!==d&&!1!==d){if(e.resolution){var l=e.resolution.toLowerCase().split("x"),h=Number(l[0]),m=Number(l[1]);o.constraints.video={width:{ideal:h},height:{ideal:m}}}e.frameRate&&(o.constraints.video.frameRate={ideal:e.frameRate})}t.configureDeviceIdOrScreensharing(o,e,n,r),n(o)}))},e.prototype.startWs=function(e){var t={heartbeat:5e3,ws:{uri:this.wsUri+"?sessionId="+this.session.sessionId,onconnected:e,ondisconnect:this.disconnectCallback.bind(this),onreconnecting:this.reconnectingCallback.bind(this),onreconnected:this.reconnectedCallback.bind(this),ismasternodecrashed:this.isMasterNodeCrashed.bind(this)},rpc:{requestTimeout:1e4,participantJoined:this.session.onParticipantJoined.bind(this.session),participantPublished:this.session.onParticipantPublished.bind(this.session),participantUnpublished:this.session.onParticipantUnpublished.bind(this.session),participantLeft:this.session.onParticipantLeft.bind(this.session),participantEvicted:this.session.onParticipantEvicted.bind(this.session),recordingStarted:this.session.onRecordingStarted.bind(this.session),recordingStopped:this.session.onRecordingStopped.bind(this.session),sendMessage:this.session.onNewMessage.bind(this.session),streamPropertyChanged:this.session.onStreamPropertyChanged.bind(this.session),connectionPropertyChanged:this.session.onConnectionPropertyChanged.bind(this.session),networkQualityLevelChanged:this.session.onNetworkQualityLevelChangedChanged.bind(this.session),filterEventDispatched:this.session.onFilterEventDispatched.bind(this.session),iceCandidate:this.session.recvIceCandidate.bind(this.session),mediaError:this.session.onMediaError.bind(this.session),masterNodeCrashedNotification:this.onMasterNodeCrashedNotification.bind(this),forciblyReconnectSubscriber:this.session.onForciblyReconnectSubscriber.bind(this.session)}};this.jsonRpcClient=new C.clients.JsonRpcClient(t)},e.prototype.onMasterNodeCrashedNotification=function(e){console.error("Master Node has crashed"),this.masterNodeHasCrashed=!0,this.session.onLostConnection("nodeCrashed"),this.jsonRpcClient.close(4103,"Master Node has crashed")},e.prototype.getWsReadyState=function(){return this.jsonRpcClient.getReadyState()},e.prototype.closeWs=function(){this.jsonRpcClient.close(4102,"Connection closed by client")},e.prototype.sendRequest=function(e,t,n){t&&t instanceof Function&&(n=t,t={}),R.debug('Sending request: {method:"'+e+'", params: '+JSON.stringify(t)+"}"),this.jsonRpcClient.send(e,t,n)},e.prototype.getWsUri=function(){return this.wsUri},e.prototype.getSecret=function(){return this.secret},e.prototype.getRecorder=function(){return this.recorder},e.prototype.generateAudioDeviceError=function(e,t){var n,r;switch("Error"===e.name&&(e.name=e.constructor.name),e.name.toLowerCase()){case"notfounderror":return n=f.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,r=e.toString(),new f.OpenViduError(n,r);case"notallowederror":return n=f.OpenViduErrorName.DEVICE_ACCESS_DENIED,r=e.toString(),new f.OpenViduError(n,r);case"overconstrainederror":return"deviceid"===e.constraint.toLowerCase()?(n=f.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,r="Audio input device with deviceId '"+t.audio.deviceId.exact+"' not found"):(n=f.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,r="Audio input device doesn't support the value passed for constraint '"+e.constraint+"'"),new f.OpenViduError(n,r);case"notreadableerror":return n=f.OpenViduErrorName.DEVICE_ALREADY_IN_USE,r=e.toString(),new f.OpenViduError(n,r);default:return new f.OpenViduError(f.OpenViduErrorName.INPUT_AUDIO_DEVICE_GENERIC_ERROR,e.toString())}},e.prototype.addAlreadyProvidedTracks=function(e,t){return e.videoTrack&&t.addTrack(e.videoTrack),e.audioTrack&&t.addTrack(e.audioTrack),t},e.prototype.configureDeviceIdOrScreensharing=function(e,t,n,o){var c=this,d=t.audioSource,l=t.videoSource;if("string"==typeof d&&(e.constraints.audio={deviceId:{exact:d}}),"string"==typeof l)if(this.isScreenShare(l))if(this.checkScreenSharingCapabilities())if(r.isElectron()){var h="screen:",m=l,v=m.substr(m.indexOf(h)+h.length);e.constraints.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:v}},n(e)}else{if(this.advancedConfiguration.screenShareChromeExtension&&!r.isFirefoxBrowser()&&!r.isFirefoxMobileBrowser()&&!navigator.mediaDevices.getDisplayMedia)return void S.getScreenConstraints((function(t,r){if(t||r.mandatory&&"screen"===r.mandatory.chromeMediaSource){if("permission-denied"!==t&&"PermissionDeniedError"!==t){var d=c.advancedConfiguration.screenShareChromeExtension.split("/").pop().trim();return void S.getChromeExtensionStatus(d,(function(e){if("installed-disabled"===e){var t=new f.OpenViduError(f.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");R.error(t),o(t)}if("not-installed"===e){var n=new f.OpenViduError(f.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,c.advancedConfiguration.screenShareChromeExtension);R.error(n),o(n)}}))}var l=new f.OpenViduError(f.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");R.error(l),o(l)}else e.constraints.video=r,n(e)}));if(!navigator.mediaDevices.getDisplayMedia){var E=r.isFirefoxBrowser()||r.isFirefoxMobileBrowser()?t.videoSource:void 0;return void y.getScreenId(E,(function(t,r,d){if(t)if("not-installed"===t){var l=c.advancedConfiguration.screenShareChromeExtension?c.advancedConfiguration.screenShareChromeExtension:"https://chrome.google.com/webstore/detail/openvidu-screensharing/lfcgfepafnobdloecchnfaclibenjold",h=new f.OpenViduError(f.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,l);R.error(h),o(h)}else if("installed-disabled"===t){h=new f.OpenViduError(f.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");R.error(h),o(h)}else if("permission-denied"===t){h=new f.OpenViduError(f.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");R.error(h),o(h)}else{h=new f.OpenViduError(f.OpenViduErrorName.GENERIC_ERROR,"Unknown error when accessing screen share");R.error(h),R.error(t),o(h)}else e.constraints.video=d.video,n(e)}))}n(e)}else{var w=new f.OpenViduError(f.OpenViduErrorName.SCREEN_SHARING_NOT_SUPPORTED,"You can only screen share in desktop Chrome, Firefox, Opera, Safari (>=13.0), Edge (>= 80) or Electron. Detected client: "+r.getName()+" "+r.getVersion());R.error(w),o(w)}else this.setVideoSource(e,l)},e.prototype.setVideoSource=function(e,t){e.constraints.video||(e.constraints.video={}),e.constraints.video.deviceId={exact:t}},e.prototype.disconnectCallback=function(){R.warn("Websocket connection lost"),this.isRoomAvailable()?this.session.onLostConnection("networkDisconnect"):alert("Connection error. Please reload page.")},e.prototype.reconnectingCallback=function(){R.warn("Websocket connection lost (reconnecting)"),this.isRoomAvailable()?this.session.emitEvent("reconnecting",[]):alert("Connection error. Please reload page.")},e.prototype.reconnectedCallback=function(){var e=this;if(R.warn("Websocket reconnected"),this.isRoomAvailable())if(this.session.connection)this.sendRequest("connect",{sessionId:this.session.connection.rpcSessionId},(function(t,n){if(t)if(e.isMasterNodeCrashed())R.warn("Master Node has crashed!");else{R.error(t);var r=function(t){R.warn("Websocket was able to reconnect to OpenVidu Server, but your Connection was already destroyed due to timeout. You are no longer a participant of the Session and your media streams have been destroyed"),e.session.onLostConnection("networkDisconnect"),e.jsonRpcClient.close(4101,"Reconnection fault")};-1===e.life?r():e.sendRequest("sessionStatus",{sessionId:e.session.sessionId},(function(t,n){e.life===n.life?r():(R.warn("Websocket was able to reconnect to OpenVidu Server, but your Master Node crashed."),e.session.onLostConnection("nodeCrashed"),e.jsonRpcClient.close(4101,"Reconnection fault"))}))}else e.jsonRpcClient.resetPing(),e.session.onRecoveredConnection()}));else{R.warn("There was no previous connection when running reconnection callback");var t=new l.SessionDisconnectedEvent(this.session,"networkDisconnect");this.session.ee.emitEvent("sessionDisconnected",[t]),t.callDefaultBehavior()}else alert("Connection error. Please reload page.")},e.prototype.isMasterNodeCrashed=function(){return this.masterNodeHasCrashed},e.prototype.isRoomAvailable=function(){return void 0!==this.session&&this.session instanceof d.Session||(R.warn("Session instance not found"),!1)},e.prototype.isScreenShare=function(e){return"screen"===e||"window"===e||r.isElectron()&&e.startsWith("screen:")},e}();t.OpenVidu=P},1246:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleLogger=void 0;var r=function(e){this.logger=e,this.log=window.console.log,this.info=window.console.info,this.debug=window.console.debug,this.warn=window.console.warn,this.error=window.console.error};t.ConsoleLogger=r},1247:function(e,t,n){(function(e,r){var o;(function(){"use strict";var c={function:!0,object:!0},d=c[typeof window]&&window||this,l=c[typeof t]&&t,h=c[typeof e]&&e&&!e.nodeType&&e,f=l&&h&&"object"==typeof r&&r;!f||f.global!==f&&f.window!==f&&f.self!==f||(d=f);var m=Math.pow(2,53)-1,v=/\bOpera/,E=Object.prototype,y=E.hasOwnProperty,S=E.toString;function w(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function O(e){return e=k(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:w(e)}function C(object,e){for(var t in object)y.call(object,t)&&e(object[t],t,object)}function I(e){return null==e?w(e):S.call(e).slice(8,-1)}function R(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function P(e,t){var n=null;return function(object,e){var t=-1,n=object?object.length:0;if("number"==typeof n&&n>-1&&n<=m)for(;++t<n;)e(object[t],t,object);else C(object,e)}(e,(function(r,o){n=t(n,r,o,e)})),n}function k(e){return String(e).replace(/^ +| +$/g,"")}var _=function e(t){var n=d,r=t&&"object"==typeof t&&"String"!=I(t);r&&(n=t,t=null);var nav=n.navigator||{},o=nav.userAgent||"";t||(t=o);var data,c,object,l,h,f=r?!!nav.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(S.toString()),m="Object",E=r?m:"ScriptBridgingProxyObject",y=r?m:"Environment",w=r&&n.java?"JavaPackage":I(n.java),_=r?m:"RuntimeObject",N=/\bJava/.test(w)&&n.java,T=N&&I(n.environment)==y,L=N?"a":"",M=N?"b":"",D=n.document||{},A=n.operamini||n.opera,V=v.test(V=r&&A?A["[[Class]]"]:I(A))?V:A=null,x=t,B=[],j=null,F=t==o,W=F&&A&&"function"==typeof A.version&&A.version(),U=P([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,n){return e||RegExp("\\b"+(n.pattern||R(n))+"\\b","i").exec(t)&&(n.label||n)})),H=function(e){return P(e,(function(e,n){return e||RegExp("\\b"+(n.pattern||R(n))+"\\b","i").exec(t)&&(n.label||n)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),J=X([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),G=function(e){return P(e,(function(e,n,r){return e||(n[J]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(J)]||RegExp("\\b"+R(r)+"(?:\\b|\\w*\\d)","i").exec(t))&&r}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),z=function(e){return P(e,(function(e,n){var pattern=n.pattern||R(n);return!e&&(e=RegExp("\\b"+pattern+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,pattern,label){var data={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return pattern&&label&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(data=data[/[\d.]+$/.exec(e)])&&(e="Windows "+data),e=String(e),pattern&&label&&(e=e.replace(RegExp(pattern,"i"),label)),O(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,pattern,n.label||n)),e}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function X(e){return P(e,(function(e,n){var pattern=n.pattern||R(n);return!e&&(e=RegExp("\\b"+pattern+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+pattern+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+pattern+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(n.label&&!RegExp(pattern,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=O(e[0].replace(RegExp(pattern,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function Y(e){return P(e,(function(e,pattern){return e||(RegExp(pattern+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(U&&(U=[U]),/\bAndroid\b/.test(z)&&!J&&(data=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(J=k(data[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),G&&!J?J=X([G]):G&&J&&(J=J.replace(RegExp("^("+R(G)+")[-_.\\s]","i"),G+" ").replace(RegExp("^("+R(G)+")[-_.]?(\\w)","i"),G+" $2")),(data=/\bGoogle TV\b/.exec(J))&&(J=data[0]),/\bSimulator\b/i.test(t)&&(J=(J?J+" ":"")+"Simulator"),"Opera Mini"==H&&/\bOPiOS\b/.test(t)&&B.push("running in Turbo/Uncompressed mode"),"IE"==H&&/\blike iPhone OS\b/.test(t)?(G=(data=e(t.replace(/like iPhone OS/,""))).manufacturer,J=data.product):/^iP/.test(J)?(H||(H="Safari"),z="iOS"+((data=/ OS ([\d_]+)/i.exec(t))?" "+data[1].replace(/_/g,"."):"")):"Konqueror"==H&&/^Linux\b/i.test(z)?z="Kubuntu":G&&"Google"!=G&&(/Chrome/.test(H)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(J))||/\bAndroid\b/.test(z)&&/^Chrome/.test(H)&&/\bVersion\//i.test(t)?(H="Android Browser",z=/\bAndroid\b/.test(z)?z:"Android"):"Silk"==H?(/\bMobi/i.test(t)||(z="Android",B.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&B.unshift("accelerated")):"UC Browser"==H&&/\bUCWEB\b/.test(t)?B.push("speed mode"):"PaleMoon"==H&&(data=/\bFirefox\/([\d.]+)\b/.exec(t))?B.push("identifying as Firefox "+data[1]):"Firefox"==H&&(data=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(z||(z="Firefox OS"),J||(J=data[1])):!H||(data=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(H))?(H&&!J&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(data+"/")+8))&&(H=null),(data=J||G||z)&&(J||G||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(z))&&(H=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(z)?z:data)+" Browser")):"Electron"==H&&(data=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&B.push("Chromium "+data),W||(W=Y(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",R(H),"(?:Firefox|Minefield|NetFront)"])),(data=("iCab"==U&&parseFloat(W)>3?"WebKit":/\bOpera\b/.test(H)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(U)&&"WebKit"||!U&&/\bMSIE\b/i.test(t)&&("Mac OS"==z?"Tasman":"Trident")||"WebKit"==U&&/\bPlayStation\b(?! Vita\b)/i.test(H)&&"NetFront")&&(U=[data]),"IE"==H&&(data=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(H+=" Mobile",z="Windows Phone "+(/\+$/.test(data)?data:data+".x"),B.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(H="IE Mobile",z="Windows Phone 8.x",B.unshift("desktop mode"),W||(W=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=H&&"Trident"==U&&(data=/\brv:([\d.]+)/.exec(t))&&(H&&B.push("identifying as "+H+(W?" "+W:"")),H="IE",W=data[1]),F){if(l="global",h=null!=(object=n)?typeof object[l]:"number",/^(?:boolean|number|string|undefined)$/.test(h)||"object"==h&&!object[l])I(data=n.runtime)==E?(H="Adobe AIR",z=data.flash.system.Capabilities.os):I(data=n.phantom)==_?(H="PhantomJS",W=(data=data.version||null)&&data.major+"."+data.minor+"."+data.patch):"number"==typeof D.documentMode&&(data=/\bTrident\/(\d+)/i.exec(t))?(W=[W,D.documentMode],(data=+data[1]+4)!=W[1]&&(B.push("IE "+W[1]+" mode"),U&&(U[1]=""),W[1]=data),W="IE"==H?String(W[1].toFixed(1)):W[0]):"number"==typeof D.documentMode&&/^(?:Chrome|Firefox)\b/.test(H)&&(B.push("masking as "+H+" "+W),H="IE",W="11.0",U=["Trident"],z="Windows");else if(N&&(x=(data=N.lang.System).getProperty("os.arch"),z=z||data.getProperty("os.name")+" "+data.getProperty("os.version")),T){try{W=n.require("ringo/engine").version.join("."),H="RingoJS"}catch(e){(data=n.system)&&data.global.system==n.system&&(H="Narwhal",z||(z=data[0].os||null))}H||(H="Rhino")}else"object"==typeof n.process&&!n.process.browser&&(data=n.process)&&("object"==typeof data.versions&&("string"==typeof data.versions.electron?(B.push("Node "+data.versions.node),H="Electron",W=data.versions.electron):"string"==typeof data.versions.nw&&(B.push("Chromium "+W,"Node "+data.versions.node),H="NW.js",W=data.versions.nw)),H||(H="Node.js",x=data.arch,z=data.platform,W=(W=/[\d.]+/.exec(data.version))?W[0]:null));z=z&&O(z)}if(W&&(data=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(W)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(F&&nav.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(j=/b/i.test(data)?"beta":"alpha",W=W.replace(RegExp(data+"\\+?$"),"")+("beta"==j?M:L)+(/\d+\+?/.exec(data)||"")),"Fennec"==H||"Firefox"==H&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(z))H="Firefox Mobile";else if("Maxthon"==H&&W)W=W.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(J))"Xbox 360"==J&&(z=null),"Xbox 360"==J&&/\bIEMobile\b/.test(t)&&B.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(H)&&(!H||J||/Browser|Mobi/.test(H))||"Windows CE"!=z&&!/Mobi/i.test(t))if("IE"==H&&F)try{null===n.external&&B.unshift("platform preview")}catch(e){B.unshift("embedded")}else(/\bBlackBerry\b/.test(J)||/\bBB10\b/.test(t))&&(data=(RegExp(J.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||W)?(z=((data=[data,/BB10/.test(t)])[1]?(J=null,G="BlackBerry"):"Device Software")+" "+data[0],W=null):this!=C&&"Wii"!=J&&(F&&A||/Opera/.test(H)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==H&&/\bOS X (?:\d+\.){2,}/.test(z)||"IE"==H&&(z&&!/^Win/.test(z)&&W>5.5||/\bWindows XP\b/.test(z)&&W>8||8==W&&!/\bTrident\b/.test(t)))&&!v.test(data=e.call(C,t.replace(v,"")+";"))&&data.name&&(data="ing as "+data.name+((data=data.version)?" "+data:""),v.test(H)?(/\bIE\b/.test(data)&&"Mac OS"==z&&(z=null),data="identify"+data):(data="mask"+data,H=V?O(V.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(data)&&(z=null),F||(W=null)),U=["Presto"],B.push(data));else H+=" Mobile";(data=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(data=[parseFloat(data.replace(/\.(\d)$/,".0$1")),data],"Safari"==H&&"+"==data[1].slice(-1)?(H="WebKit Nightly",j="alpha",W=data[1].slice(0,-1)):W!=data[1]&&W!=(data[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(W=null),data[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==data[0]&&537.36==data[2]&&parseFloat(data[1])>=28&&"WebKit"==U&&(U=["Blink"]),F&&(f||data[1])?(U&&(U[1]="like Chrome"),data=data[1]||((data=data[0])<530?1:data<532?2:data<532.05?3:data<533?4:data<534.03?5:data<534.07?6:data<534.1?7:data<534.13?8:data<534.16?9:data<534.24?10:data<534.3?11:data<535.01?12:data<535.02?"13+":data<535.07?15:data<535.11?16:data<535.19?17:data<536.05?18:data<536.1?19:data<537.01?20:data<537.11?"21+":data<537.13?23:data<537.18?24:data<537.24?25:data<537.36?26:"Blink"!=U?"27":"28")):(U&&(U[1]="like Safari"),data=(data=data[0])<400?1:data<500?2:data<526?3:data<533?4:data<534?"4+":data<535?5:data<537?6:data<538?7:data<601?8:data<602?9:data<604?10:data<606?11:data<608?12:"12"),U&&(U[1]+=" "+(data+="number"==typeof data?".x":/[.+]/.test(data)?"":"+")),"Safari"==H&&(!W||parseInt(W)>45)?W=data:"Chrome"==H&&/\bHeadlessChrome/i.test(t)&&B.unshift("headless")),"Opera"==H&&(data=/\bzbov|zvav$/.exec(z))?(H+=" ",B.unshift("desktop mode"),"zvav"==data?(H+="Mini",W=null):H+="Mobile",z=z.replace(RegExp(" *"+data+"$"),"")):"Safari"==H&&/\bChrome\b/.exec(U&&U[1])?(B.unshift("desktop mode"),H="Chrome Mobile",W=null,/\bOS X\b/.test(z)?(G="Apple",z="iOS 4.3+"):z=null):/\bSRWare Iron\b/.test(H)&&!W&&(W=Y("Chrome")),W&&0==W.indexOf(data=/[\d.]+$/.exec(z))&&t.indexOf("/"+data+"-")>-1&&(z=k(z.replace(data,""))),z&&-1!=z.indexOf(H)&&!RegExp(H+" OS").test(z)&&(z=z.replace(RegExp(" *"+R(H)+" *"),"")),U&&!/\b(?:Avant|Nook)\b/.test(H)&&(/Browser|Lunascape|Maxthon/.test(H)||"Safari"!=H&&/^iOS/.test(z)&&/\bSafari\b/.test(U[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(H)&&U[1])&&(data=U[U.length-1])&&B.push(data),B.length&&(B=["("+B.join("; ")+")"]),G&&J&&J.indexOf(G)<0&&B.push("on "+G),J&&B.push((/^on /.test(B[B.length-1])?"":"on ")+J),z&&(data=/ ([\d.+]+)$/.exec(z),c=data&&"/"==z.charAt(z.length-data[0].length-1),z={architecture:32,family:data&&!c?z.replace(data[0],""):z,version:data?data[1]:null,toString:function(){var e=this.version;return this.family+(e&&!c?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(data=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(x))&&!/\bi686\b/i.test(x)?(z&&(z.architecture=64,z.family=z.family.replace(RegExp(" *"+data),"")),H&&(/\bWOW64\b/i.test(t)||F&&/\w(?:86|32)$/.test(nav.cpuClass||nav.platform)&&!/\bWin64; x64\b/i.test(t))&&B.unshift("32-bit")):z&&/^OS X/.test(z.family)&&"Chrome"==H&&parseFloat(W)>=39&&(z.architecture=64),t||(t=null);var $={};return $.description=t,$.layout=U&&U[0],$.manufacturer=G,$.name=H,$.prerelease=j,$.product=J,$.ua=t,$.version=H&&W,$.os=z||{architecture:null,family:null,version:null,toString:function(){return"null"}},$.parse=e,$.toString=function(){return this.description||""},$.version&&B.unshift(W),$.name&&B.unshift(H),z&&H&&(z!=String(z).split(" ")[0]||z!=H.split(" ")[0]&&!J)&&B.push(J?"("+z+")":"on "+z),B.length&&($.description=B.join(" ")),$}();d.platform=_,void 0===(o=function(){return _}.call(t,n,t,e))||(e.exports=o)}).call(this)}).call(this,n(424)(e),n(52))},1248:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)}),c=this&&this.__assign||function(){return c=Object.assign||function(e){for(var s,i=1,t=arguments.length;i<t;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(e[p]=s[p]);return e},c.apply(this,arguments)},d=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,c){function d(e){try{h(r.next(e))}catch(e){c(e)}}function l(e){try{h(r.throw(e))}catch(e){c(e)}}function h(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,l)}h((r=r.apply(e,t||[])).next())}))},l=this&&this.__generator||function(e,body){var t,n,r,g,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return g={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function c(c){return function(d){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(r=2&c[0]?n.return:c[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,c[1])).done)return r;switch(n=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,n=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){o.label=c[1];break}if(6===c[0]&&o.label<r[1]){o.label=r[1],r=c;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(c);break}r[2]&&o.ops.pop(),o.trys.pop();continue}c=body.call(e,o)}catch(e){c=[6,e],n=0}finally{t=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,d])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebRtcPeerSendrecv=t.WebRtcPeerSendonly=t.WebRtcPeerRecvonly=t.WebRtcPeer=void 0;var h=n(1249),f=n(1333),m=n(966),v=n(452),E=n(568),y=v.OpenViduLogger.getInstance(),S=[{rid:"r0",scaleResolutionDownBy:4},{rid:"r1",scaleResolutionDownBy:2},{rid:"r2",scaleResolutionDownBy:1}],w=function(){function e(e){var t=this;this.remoteCandidatesQueue=[],this.localCandidatesQueue=[],this.iceCandidateList=[],this.candidategatheringdone=!1,E.PlatformUtils.getInstance(),this.configuration=c(c({},e),{iceServers:e.iceServers&&e.iceServers.length>0?e.iceServers:h(),mediaStream:void 0!==e.mediaStream?e.mediaStream:null,mode:e.mode?e.mode:"sendrecv",id:e.id?e.id:this.generateUniqueId()}),this.pc=new RTCPeerConnection({iceServers:this.configuration.iceServers}),this.pc.addEventListener("icecandidate",(function(e){if(null!=e.candidate){var n=e.candidate;t.configuration.onIceCandidate(n),""!==n.candidate&&t.localCandidatesQueue.push({candidate:n.candidate})}})),this.pc.addEventListener("signalingstatechange",(function(){if("stable"===t.pc.signalingState)for(;t.iceCandidateList.length>0;){var e=t.iceCandidateList.shift();t.pc.addIceCandidate(e)}}))}return e.prototype.getId=function(){return this.configuration.id},e.prototype.dispose=function(){if(y.debug("Disposing WebRtcPeer"),this.pc){if("closed"===this.pc.signalingState)return;this.pc.close(),this.remoteCandidatesQueue=[],this.localCandidatesQueue=[]}},e.prototype.createOffer=function(){var e=this;return new Promise((function(t,n){return d(e,void 0,void 0,(function(){var e,r,track,o,c,d,h,f,m,v,E,w;return l(this,(function(l){switch(l.label){case 0:if(!("addTransceiver"in this.pc))return[3,7];if(y.debug("[createOffer] Method RTCPeerConnection.addTransceiver() is available; using it"),"recvonly"===this.configuration.mode)return[3,5];if(!this.configuration.mediaStream)return n(new Error(this.configuration.mode+" direction requested, but no stream was configured to be sent")),[2];e=0,r=this.configuration.mediaStream.getTracks(),l.label=1;case 1:return e<r.length?(track=r[e],o={direction:this.configuration.mode,streams:[this.configuration.mediaStream]},this.configuration.simulcast&&"video"===track.kind&&(o.sendEncodings=S),c=this.pc.addTransceiver(track,o),this.configuration.simulcast&&"video"===track.kind?"encodings"in(d=c.sender.getParameters())&&d.encodings.length===o.sendEncodings.length?[3,3]:(d.encodings=o.sendEncodings,[4,c.sender.setParameters(d)]):[3,3]):[3,4];case 2:l.sent(),l.label=3;case 3:return e++,[3,1];case 4:return[3,6];case 5:for(h=0,f=["audio","video"];h<f.length;h++)m=f[h],this.configuration.mediaConstraints[m]&&(this.configuration.mediaStream=new MediaStream,this.pc.addTransceiver(m,{direction:this.configuration.mode,streams:[this.configuration.mediaStream]}));l.label=6;case 6:return this.pc.createOffer().then((function(e){return t(e)})).catch((function(e){return n(e)})),[3,8];case 7:y.warn("[createOffer] Method RTCPeerConnection.addTransceiver() is NOT available; using LEGACY offerToReceive{Audio,Video}"),this.configuration.mediaStream&&this.deprecatedPeerConnectionTrackApi(),v=this.configuration.mediaConstraints.audio,E=this.configuration.mediaConstraints.video,w={offerToReceiveAudio:"sendonly"!==this.configuration.mode&&v,offerToReceiveVideo:"sendonly"!==this.configuration.mode&&E},y.debug("RTCPeerConnection.createOffer() options:",JSON.stringify(w)),this.pc.createOffer(w).then((function(e){return t(e)})).catch((function(e){return n(e)})),l.label=8;case 8:return[2]}}))}))}))},e.prototype.deprecatedPeerConnectionTrackApi=function(){for(var e=0,t=this.configuration.mediaStream.getTracks();e<t.length;e++){var track=t[e];this.pc.addTrack(track,this.configuration.mediaStream)}},e.prototype.createAnswer=function(){var e=this;return new Promise((function(t,n){if("getTransceivers"in e.pc){y.debug("[createAnswer] Method RTCPeerConnection.getTransceivers() is available; using it");for(var r=function(t){if(!e.configuration.mediaConstraints[t])return"continue";var r=e.pc.getTransceivers().find((function(e){return e.receiver.track.kind===t}));r?r.direction=e.configuration.mode:n(new Error(t+" requested, but no transceiver was created from remote description"))},o=0,c=["audio","video"];o<c.length;o++){r(c[o])}e.pc.createAnswer().then((function(e){return t(e)})).catch((function(e){return n(e)}))}else{if(e.configuration.mediaConstraints){var d={offerToReceiveAudio:"boolean"!=typeof e.configuration.mediaConstraints.audio||e.configuration.mediaConstraints.audio,offerToReceiveVideo:"boolean"!=typeof e.configuration.mediaConstraints.video||e.configuration.mediaConstraints.video};e.pc.createAnswer(d).then((function(e){t(e)})).catch((function(e){n(e)}))}}}))},e.prototype.processLocalOffer=function(e){var t=this;return new Promise((function(n,r){t.pc.setLocalDescription(e).then((function(){var e=t.pc.localDescription;e?(y.debug("Local description set",e.sdp),n()):r("Local description is not defined")})).catch((function(e){r(e)}))}))},e.prototype.processRemoteOffer=function(e){var t=this;return new Promise((function(n,r){var o={type:"offer",sdp:e};y.debug("SDP offer received, setting remote description",o),"closed"===t.pc.signalingState&&r("RTCPeerConnection is closed when trying to set remote description"),t.setRemoteDescription(o).then((function(){n()})).catch((function(e){r(e)}))}))},e.prototype.processLocalAnswer=function(e){var t=this;return new Promise((function(n,r){y.debug("SDP answer created, setting local description"),"closed"===t.pc.signalingState&&r("RTCPeerConnection is closed when trying to set local description"),t.pc.setLocalDescription(e).then((function(){return n()})).catch((function(e){return r(e)}))}))},e.prototype.processRemoteAnswer=function(e){var t=this;return new Promise((function(n,r){var o={type:"answer",sdp:e};y.debug("SDP answer received, setting remote description"),"closed"===t.pc.signalingState&&r("RTCPeerConnection is closed when trying to set remote description"),t.setRemoteDescription(o).then((function(){return n()})).catch((function(e){return r(e)}))}))},e.prototype.setRemoteDescription=function(e){return d(this,void 0,void 0,(function(){return l(this,(function(t){return[2,this.pc.setRemoteDescription(e)]}))}))},e.prototype.addIceCandidate=function(e){var t=this;return new Promise((function(n,r){switch(y.debug("Remote ICE candidate received",e),t.remoteCandidatesQueue.push(e),t.pc.signalingState){case"closed":r(new Error("PeerConnection object is closed"));break;case"stable":t.pc.remoteDescription?t.pc.addIceCandidate(e).then((function(){return n()})).catch((function(e){return r(e)})):(t.iceCandidateList.push(e),n());break;default:t.iceCandidateList.push(e),n()}}))},e.prototype.addIceConnectionStateChangeListener=function(e){var t=this;this.pc.addEventListener("iceconnectionstatechange",(function(){switch(t.pc.iceConnectionState){case"disconnected":var n="IceConnectionState of RTCPeerConnection "+t.configuration.id+" ("+e+') change to "disconnected". Possible network disconnection';y.warn(n),t.configuration.onIceConnectionStateException(m.ExceptionEventName.ICE_CONNECTION_DISCONNECTED,n);break;case"failed":var r="IceConnectionState of RTCPeerConnection "+t.configuration.id+" ("+e+') to "failed"';y.error(r),t.configuration.onIceConnectionStateException(m.ExceptionEventName.ICE_CONNECTION_FAILED,r);break;case"closed":y.log("IceConnectionState of RTCPeerConnection "+t.configuration.id+" ("+e+') change to "closed"');break;case"new":y.log("IceConnectionState of RTCPeerConnection "+t.configuration.id+" ("+e+') change to "new"');break;case"checking":y.log("IceConnectionState of RTCPeerConnection "+t.configuration.id+" ("+e+') change to "checking"');break;case"connected":y.log("IceConnectionState of RTCPeerConnection "+t.configuration.id+" ("+e+') change to "connected"');break;case"completed":y.log("IceConnectionState of RTCPeerConnection "+t.configuration.id+" ("+e+') change to "completed"')}}))},e.prototype.generateUniqueId=function(){return f.v4()},e}();t.WebRtcPeer=w;var O=function(e){function t(t){return t.mode="recvonly",e.call(this,t)||this}return o(t,e),t}(w);t.WebRtcPeerRecvonly=O;var C=function(e){function t(t){return t.mode="sendonly",e.call(this,t)||this}return o(t,e),t}(w);t.WebRtcPeerSendonly=C;var I=function(e){function t(t){return t.mode="sendrecv",e.call(this,t)||this}return o(t,e),t}(w);t.WebRtcPeerSendrecv=I},1249:function(e,t,n){"use strict";var r=n(1250);e.exports=function(e){var t,o={stun:(e||{}).stun||n(1251),turn:(e||{}).turn||n(1252)},c=(e||{}).stunCount||2,d=(e||{}).turnCount||0;function l(e,t){for(var n,c=[],input=[].concat(o[e]);input.length&&c.length<t;)n=Math.random()*input.length|0,c=c.concat(input.splice(n,1));return c.map((function(t){return"string"==typeof t||t instanceof String?r(e+":"+t):t}))}return t=[].concat(l("stun",c)),d&&(t=t.concat(l("turn",d))),t}},1250:function(e,t){var n=["stun:","turn:"];e.exports=function(input){var e,t,r=(input||{}).url||input,output={};return"string"==typeof r||r instanceof String?(r=r.trim(),(e=n[n.indexOf(r.slice(0,5))])?(t=(r=r.slice(5)).split("@"),output.username=input.username,output.credential=input.credential,t.length>1&&(r=t[1],t=t[0].split(":"),output.username=t[0],output.credential=(input||{}).credential||t[1]||""),output.url=e+r,output.urls=[output.url],output):input):input}},1251:function(e){e.exports=JSON.parse('["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org"]')},1252:function(e){e.exports=JSON.parse("[]")},1253:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,c){function d(e){try{h(r.next(e))}catch(e){c(e)}}function l(e){try{h(r.throw(e))}catch(e){c(e)}}function h(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,l)}h((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,body){var t,n,r,g,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return g={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function c(c){return function(d){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(r=2&c[0]?n.return:c[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,c[1])).done)return r;switch(n=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,n=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){o.label=c[1];break}if(6===c[0]&&o.label<r[1]){o.label=r[1],r=c;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(c);break}r[2]&&o.ops.pop(),o.trys.pop();continue}c=body.call(e,o)}catch(e){c=[6,e],n=0}finally{t=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,d])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebRtcStats=void 0;var c,d=n(452),l=n(568),h=d.OpenViduLogger.getInstance(),f=function(){function e(e){this.stream=e,this.STATS_ITEM_NAME="webrtc-stats-config",this.webRtcStatsEnabled=!1,this.statsInterval=1,c=l.PlatformUtils.getInstance()}return e.prototype.isEnabled=function(){return this.webRtcStatsEnabled},e.prototype.initWebRtcStats=function(){var e=this,t=localStorage.getItem(this.STATS_ITEM_NAME);if(t){this.webRtcStatsEnabled=!0;var n=JSON.parse(t);h.warn("WebRtc stats enabled for stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId),h.warn("localStorage item: "+JSON.stringify(n)),this.POST_URL=n.httpEndpoint,this.statsInterval=n.interval,this.webRtcStatsIntervalId=setInterval((function(){return r(e,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.sendStatsToHttpEndpoint()];case 1:return e.sent(),[2]}}))}))}),1e3*this.statsInterval)}else h.debug("WebRtc stats not enabled")},e.prototype.getSelectedIceCandidateInfo=function(){var e=this;return new Promise((function(t,n){return r(e,void 0,void 0,(function(){var e,n,r,d,l,h,f,m,v,i,E,y,S,w,O,C,I,R,P,k,_,N;return o(this,(function(o){switch(o.label){case 0:return[4,this.stream.getRTCPeerConnection().getStats()];case 1:if(e=o.sent(),r=new Map,d=new Map,l=new Map,e.forEach((function(e){switch("transport"===e.type&&(c.isChromium()||c.isSafariBrowser()||c.isReactNative())&&(n=e),e.type){case"candidate-pair":r.set(e.id,e);break;case"local-candidate":d.set(e.id,e);break;case"remote-candidate":l.set(e.id,e)}})),null!=n)f=n.selectedCandidatePairId,h=r.get(f);else for(m=r.size,v=r.values(),i=0;i<m;i++)if((E=v.next().value).selected){h=E;break}if(y=h.localCandidateId,S=h.remoteCandidateId,w=d.get(y))for(R=this.stream.getLocalIceCandidateList(),P=R.filter((function(e){return!!e.candidate&&(e.candidate.indexOf(w.ip)>=0||e.candidate.indexOf(w.address)>=0)&&e.candidate.indexOf(w.port)>=0})),w.raw=[],O=0,C=P;O<C.length;O++)N=C[O],w.raw.push(N.candidate);else w="ERROR: No active local ICE candidate. Probably ICE-TCP is being used";if(I=l.get(S))for(R=this.stream.getRemoteIceCandidateList(),P=R.filter((function(e){return!!e.candidate&&(e.candidate.indexOf(I.ip)>=0||e.candidate.indexOf(I.address)>=0)&&e.candidate.indexOf(I.port)>=0})),I.raw=[],k=0,_=P;k<_.length;k++)N=_[k],I.raw.push(N.candidate);else I="ERROR: No active remote ICE candidate. Probably ICE-TCP is being used";return t({localCandidate:w,remoteCandidate:I}),[2]}}))}))}))},e.prototype.stopWebRtcStats=function(){this.webRtcStatsEnabled&&(clearInterval(this.webRtcStatsIntervalId),h.warn("WebRtc stats stopped for disposed stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId))},e.prototype.sendStats=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n={headers:{"Content-type":"application/json"},body:JSON.stringify(t),method:"POST"},[4,fetch(e,n)];case 1:return o.sent(),[3,3];case 2:return r=o.sent(),h.error("sendStats error: "+JSON.stringify(r)),[3,3];case 3:return[2]}}))}))},e.prototype.sendStatsToHttpEndpoint=function(){return r(this,void 0,void 0,(function(){var e,t,n;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this.getCommonStats()];case 1:return e=r.sent(),t=this.generateJSONStatsResponse(e),[4,this.sendStats(this.POST_URL,t)];case 2:return r.sent(),[3,4];case 3:return n=r.sent(),h.log(n),[3,4];case 4:return[2]}}))}))},e.prototype.getCommonStats=function(){return r(this,void 0,void 0,(function(){var e=this;return o(this,(function(t){return[2,new Promise((function(t,n){return r(e,void 0,void 0,(function(){var e,r,c,d,l,f=this;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.stream.getRTCPeerConnection().getStats()];case 1:return e=o.sent(),r=this.getWebRtcStatsResponseOutline(),c=["framesReceived","framesDropped","framesSent","frameHeight","frameWidth"],d=["availableOutgoingBitrate","currentRoundTripTime"],e.forEach((function(e){var t=null!=e.mediaType?e.mediaType:e.kind,n=function(n,o){null!=e[o]&&null!=r[n]&&(!t&&c.indexOf(o)>-1&&(t="video"),null!=n&&null!=t&&null!=o&&null!=r[n][t]?r[n][t][o]=Number(e[o]):null!=n&&null!=o&&d.includes(o)&&(r[n][o]=Number(e[o])))};switch(e.type){case"outbound-rtp":n("outbound","bytesSent"),n("outbound","packetsSent"),n("outbound","framesEncoded"),n("outbound","nackCount"),n("outbound","firCount"),n("outbound","pliCount"),n("outbound","qpSum");break;case"inbound-rtp":n("inbound","bytesReceived"),n("inbound","packetsReceived"),n("inbound","packetsLost"),n("inbound","jitter"),n("inbound","framesDecoded"),n("inbound","nackCount"),n("inbound","firCount"),n("inbound","pliCount");break;case"track":n("inbound","jitterBufferDelay"),n("inbound","framesReceived"),n("outbound","framesDropped"),n("outbound","framesSent"),n(f.stream.isLocal()?"outbound":"inbound","frameHeight"),n(f.stream.isLocal()?"outbound":"inbound","frameWidth");break;case"candidate-pair":n("candidatepair","currentRoundTripTime"),n("candidatepair","availableOutgoingBitrate")}})),(null==r?void 0:r.candidatepair)&&0!==Object.keys(r.candidatepair).length||delete r.candidatepair,[2,t(r)];case 2:return l=o.sent(),h.error("Error getting common stats: ",l),[2,n(l)];case 3:return[2]}}))}))}))]}))}))},e.prototype.generateJSONStatsResponse=function(e){return{"@timestamp":(new Date).toISOString(),participant_id:this.stream.connection.data,session_id:this.stream.session.sessionId,platform:c.getName(),platform_description:c.getDescription(),stream:"webRTC",webrtc_stats:e}},e.prototype.getWebRtcStatsResponseOutline=function(){return this.stream.isLocal()?{outbound:{audio:{},video:{}},candidatepair:{}}:{inbound:{audio:{},video:{}}}},e}();t.WebRtcStats=f},1254:function(e,t,n){var r,o=n(1255);"undefined"!=typeof window&&(r=window.AudioContext||window.webkitAudioContext);var c=null;e.exports=function(e,t){var n=new o;if(!r)return n;var d,l,h,f=(t=t||{}).smoothing||.1,m=t.interval||50,v=t.threshold,E=t.play,y=t.history||10,S=!0;c=t.audioContext||c||new r,(h=c.createAnalyser()).fftSize=512,h.smoothingTimeConstant=f,l=new Float32Array(h.frequencyBinCount),e.jquery&&(e=e[0]),e instanceof HTMLAudioElement||e instanceof HTMLVideoElement?(d=c.createMediaElementSource(e),void 0===E&&(E=!0),v=v||-50):(d=c.createMediaStreamSource(e),v=v||-50),d.connect(h),E&&h.connect(c.destination),n.speaking=!1,n.suspend=function(){return c.suspend()},n.resume=function(){return c.resume()},Object.defineProperty(n,"state",{get:function(){return c.state}}),c.onstatechange=function(){n.emit("state_change",c.state)},n.setThreshold=function(e){v=e},n.setInterval=function(i){m=i},n.stop=function(){S=!1,n.emit("volume_change",-100,v),n.speaking&&(n.speaking=!1,n.emit("stopped_speaking")),h.disconnect(),d.disconnect()},n.speakingHistory=[];for(var i=0;i<y;i++)n.speakingHistory.push(0);var w=function(){setTimeout((function(){if(S){var e=function(e,t){var n=-1/0;e.getFloatFrequencyData(t);for(var i=4,r=t.length;i<r;i++)t[i]>n&&t[i]<0&&(n=t[i]);return n}(h,l);n.emit("volume_change",e,v);var t=0;if(e>v&&!n.speaking){for(var i=n.speakingHistory.length-3;i<n.speakingHistory.length;i++)t+=n.speakingHistory[i];t>=2&&(n.speaking=!0,n.emit("speaking"))}else if(e<v&&n.speaking){for(i=0;i<n.speakingHistory.length;i++)t+=n.speakingHistory[i];0==t&&(n.speaking=!1,n.emit("stopped_speaking"))}n.speakingHistory.shift(),n.speakingHistory.push(0+(e>v)),w()}}),m)};return w(),n}},1255:function(e,t){function n(){}e.exports=n,n.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,n){this.callbacks=this.callbacks||{};var r=3===arguments.length,o=r?arguments[1]:void 0,c=r?arguments[2]:arguments[1];return c._groupName=o,(this.callbacks[e]=this.callbacks[e]||[]).push(c),this},t.once=function(e,t,n){var r=this,o=3===arguments.length,c=o?arguments[1]:void 0,d=o?arguments[2]:arguments[1];function l(){r.off(e,l),d.apply(this,arguments)}return this.on(e,c,l),this},t.releaseGroup=function(e){var t,i,n,r;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(i=0,n=(r=this.callbacks[t]).length;i<n;i++)r[i]._groupName===e&&(r.splice(i,1),i--,n--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var i,n=this.callbacks[e];return n?1===arguments.length?(delete this.callbacks[e],this):(-1!==(i=n.indexOf(t))&&(n.splice(i,1),0===n.length&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var i,t,n,r=[].slice.call(arguments,1),o=this.callbacks[e],c=this.getWildcardCallbacks(e);if(o)for(i=0,t=(n=o.slice()).length;i<t&&n[i];++i)n[i].apply(this,r);if(c)for(t=c.length,i=0,t=(n=c.slice()).length;i<t&&n[i];++i)n[i].apply(this,[e].concat(r));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,n,r=[];for(t in this.callbacks)n=t.split("*"),("*"===t||2===n.length&&e.slice(0,n[0].length)===n[0])&&(r=r.concat(this.callbacks[t]));return r}},n.mixin(n)},1256:function(e,t){function n(e,t,n){var r={audio:!1,video:{mandatory:{chromeMediaSource:e?"screen":"desktop",maxWidth:window.screen.width>1920?window.screen.width:1920,maxHeight:window.screen.height>1080?window.screen.height:1080},optional:[]}};return n&&(r.audio={mandatory:{chromeMediaSource:e?"screen":"desktop"},optional:[]}),t&&(r.video.mandatory.chromeMediaSourceId=t,r.audio&&r.audio.mandatory&&(r.audio.mandatory.chromeMediaSourceId=t)),r}function r(e){iframe?iframe.isLoaded?e?e.forEach?iframe.contentWindow.postMessage({captureCustomSourceId:e},"*"):iframe.contentWindow.postMessage({captureSourceIdWithAudio:!0},"*"):iframe.contentWindow.postMessage({captureSourceId:!0},"*"):setTimeout((function(){r(e)}),100):o((function(){r(e)}))}var iframe;function o(e){iframe?e():((iframe=document.createElement("iframe")).onload=function(){iframe.isLoaded=!0,e()},iframe.src="https://openvidu.github.io/openvidu-screen-sharing-chrome-extension/",iframe.style.display="none",(document.body||document.documentElement).appendChild(iframe))}function c(){iframe?iframe.isLoaded?iframe.contentWindow.postMessage({getChromeExtensionStatus:!0},"*"):setTimeout(c,100):o(c)}window.getScreenId=function(e,t,o){-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob?navigator.mozGetUserMedia?t(null,"firefox",{video:{mozMediaSource:e,mediaSource:e}}):(window.addEventListener("message",(function e(r){if(!r.data)return;r.data.chromeMediaSourceId&&("PermissionDeniedError"===r.data.chromeMediaSourceId?t("permission-denied"):t(null,r.data.chromeMediaSourceId,n(null,r.data.chromeMediaSourceId,r.data.canRequestAudioTrack)),window.removeEventListener("message",e));r.data.chromeExtensionStatus&&(t(r.data.chromeExtensionStatus,null,n(r.data.chromeExtensionStatus)),window.removeEventListener("message",e))})),o?setTimeout((function(){r(o)}),100):setTimeout(r,100)):t({video:!0})},window.getScreenConstraints=function(e){o((function(){getScreenId((function(t,n,r){r||(r={video:!0}),e(t,r.video)}))}))},window.getChromeExtensionStatus=function(e){navigator.mozGetUserMedia?e("installed-enabled"):(window.addEventListener("message",(function t(n){if(!n.data)return;n.data.chromeExtensionStatus&&(e(n.data.chromeExtensionStatus),window.removeEventListener("message",t))})),setTimeout(c,100))},t.getScreenId=window.getScreenId},1257:function(e,t){var n,r,o="screen";if("undefined"!=typeof window&&"undefined"!=typeof navigator&&void 0!==navigator.userAgent){var c=void 0!==window.InstallTrigger,d=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;window.chrome;window.addEventListener("message",(function(e){e.origin==window.location.origin&&function(data){if("PermissionDeniedError"==data){if(r)return r("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==data&&(o="desktop");data.sourceId&&r&&r(n=data.sourceId,!0===data.canRequestAudioTrack)}(e.data)}))}function l(e){if(!e)throw'"callback" parameter is mandatory.';if(n)return e(n);r=e,window.postMessage("get-sourceId","*")}function h(e,t){n="";if(c)return e(null,{mozMediaSource:"window",mediaSource:"window"});var d={mandatory:{chromeMediaSource:o,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]};"desktop"!=o||n?("desktop"==o&&(d.mandatory.chromeMediaSourceId=n),e(null,d)):t?function(e){if(!e)throw'"callback" parameter is mandatory.';if(n)return e(n);r=e,window.postMessage("audio-plus-tab","*")}((function(t,n){d.mandatory.chromeMediaSourceId=t,n&&(d.canRequestAudioTrack=!0),e("PermissionDeniedError"==t?t:null,d)})):l((function(t){d.mandatory.chromeMediaSourceId=t,e("PermissionDeniedError"==t?t:null,d)}))}t.getScreenConstraints=h,t.getScreenConstraintsWithAudio=function(e){h(e,!0)},t.isChromeExtensionAvailable=function(e){if(e){if("desktop"==o)return e(!0);window.postMessage("are-you-there","*"),setTimeout((function(){e("screen"!=o)}),2e3)}},t.getChromeExtensionStatus=function(e,t){if(c)return t("not-chrome");2!=arguments.length&&(t=e,e="lfcgfepafnobdloecchnfaclibenjold");var image=document.createElement("img");image.src="chrome-extension://"+e+"/icon.png",image.onload=function(){o="screen",window.postMessage("are-you-there","*"),setTimeout((function(){t("screen"==o?"installed-disabled":"installed-enabled")}),2e3)},image.onerror=function(){t("not-installed")}},t.getSourceId=l},1258:function(e,t,n){"use strict";var r,o="object"==typeof Reflect?Reflect:null,c=o&&"function"==typeof o.apply?o.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var d=Number.isNaN||function(e){return e!=e};function l(){l.init.call(this)}e.exports=l,e.exports.once=function(e,t){return new Promise((function(n,r){function o(n){e.removeListener(t,c),r(n)}function c(){"function"==typeof e.removeListener&&e.removeListener("error",o),n([].slice.call(arguments))}C(e,t,c,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&C(e,"error",t,n)}(e,o,{once:!0})}))},l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var h=10;function f(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function m(e){return void 0===e._maxListeners?l.defaultMaxListeners:e._maxListeners}function v(e,t,n,r){var o,c,d,l;if(f(n),void 0===(c=e._events)?(c=e._events=Object.create(null),e._eventsCount=0):(void 0!==c.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),c=e._events),d=c[t]),void 0===d)d=c[t]=n,++e._eventsCount;else if("function"==typeof d?d=c[t]=r?[n,d]:[d,n]:r?d.unshift(n):d.push(n),(o=m(e))>0&&d.length>o&&!d.warned){d.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+d.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=e,h.type=t,h.count=d.length,l=h,console&&console.warn&&console.warn(l)}return e}function E(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=E.bind(r);return o.listener=n,r.wrapFn=o,o}function S(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(o):O(o,o.length)}function w(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function O(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function C(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function o(c){r.once&&e.removeEventListener(t,o),n(c)}))}}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(e){if("number"!=typeof e||e<0||d(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");h=e}}),l.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||d(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},l.prototype.getMaxListeners=function(){return m(this)},l.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var d=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw d.context=o,d}var l=r[e];if(void 0===l)return!1;if("function"==typeof l)c(l,this,t);else{var h=l.length,f=O(l,h);for(i=0;i<h;++i)c(f[i],this,t)}return!0},l.prototype.addListener=function(e,t){return v(this,e,t,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(e,t){return v(this,e,t,!0)},l.prototype.once=function(e,t){return f(t),this.on(e,y(this,e,t)),this},l.prototype.prependOnceListener=function(e,t){return f(t),this.prependListener(e,y(this,e,t)),this},l.prototype.removeListener=function(e,t){var n,r,o,i,c;if(f(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){c=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,c||t)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},l.prototype.listeners=function(e){return S(this,e,!0)},l.prototype.rawListeners=function(e){return S(this,e,!1)},l.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):w.call(e,t)},l.prototype.listenerCount=w,l.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},1259:function(e,t){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},1260:function(e,t,n){var r=n(1261),o=n(1262);t.JsonRPC=r,t.XmlRPC=o},1261:function(e,t){t.pack=function(e,t){var n={jsonrpc:"2.0"};if(e.method)n.method=e.method,e.params&&(n.params=e.params),null!=t&&(n.id=t);else if(null!=t){if(e.error){if(void 0!==e.result)throw new TypeError("Both result and error are defined");n.error=e.error}else{if(void 0===e.result)throw new TypeError("No result or error is defined");n.result=e.result}n.id=t}return JSON.stringify(n)},t.unpack=function(e){var t=e;("string"==typeof e||e instanceof String)&&(t=JSON.parse(e));var n=t.jsonrpc;if("2.0"!==n)throw new TypeError("Invalid JsonRPC version '"+n+"': "+e);if(null==t.method){if(null==t.id)throw new TypeError("Invalid message: "+e);var r=void 0!==t.result,o=void 0!==t.error;if(r&&o)throw new TypeError("Both result and error are defined: "+e);if(!r&&!o)throw new TypeError("No result or error is defined: "+e);t.ack=t.id,delete t.id}return t}},1262:function(e,t){t.pack=function(e){throw new TypeError("Not yet implemented")},t.unpack=function(e){throw new TypeError("Not yet implemented")}},1263:function(e,t){function n(){var e={};this.forEach=function(t){for(var n in e){var source=e[n];for(var r in source)t(source[r])}},this.get=function(t,source){var n=e[source];if(null!=n)return n[t]},this.remove=function(t,source){var n=e[source];if(null!=n){for(var i in delete n[t],n)return!1;delete e[source]}},this.set=function(t,n,source){if(null==t)return this.remove(n,source);var r=e[source];null==r&&(e[source]=r={}),r[n]=t}}n.prototype.pop=function(e,source){var t=this.get(e,source);if(null!=t)return this.remove(e,source),t},e.exports=n},1264:function(e,t,n){var r=n(1265);t.JsonRpcClient=r},1265:function(e,t,n){var r=n(1131),o=n(1132),c=n(452).OpenViduLogger;Date.now=Date.now||function(){return+new Date};var d="RECONNECTING",l="CONNECTED",h="DISCONNECTED",f=c.getInstance();e.exports=function(e){var t,n=this,c=e.ws,m=-1,v=0,E=!0,y=!1,S=h,w=c.onreconnecting,O=c.onreconnected,C=c.onconnected,I=c.onerror;e.rpc.pull=function(e,t){t.reply(null,"push")},c.onreconnecting=function(){f.debug("--------- ONRECONNECTING -----------"),S!==d?(L(),S=d,w&&w()):f.error("Websocket already in RECONNECTING state when receiving a new ONRECONNECTING message. Ignoring it")},c.onreconnected=function(){f.debug("--------- ONRECONNECTED -----------"),S!==l?(S=l,_(),O&&O()):f.error("Websocket already in CONNECTED state when receiving a new ONRECONNECTED message. Ignoring it")},c.onconnected=function(){f.debug("--------- ONCONNECTED -----------"),S!==l?(S=l,E=!0,T(),C&&C()):f.error("Websocket already in CONNECTED state when receiving a new ONCONNECTED message. Ignoring it")},c.onerror=function(e){f.debug("--------- ONERROR -----------"),S=h,L(),I&&I(e)};var R=new o(c);f.debug("Connecting websocket to URI: "+c.uri);var P={request_timeout:e.rpc.requestTimeout,ping_request_timeout:e.rpc.heartbeatRequestTimeout},k=new r(r.packers.JsonRPC,P,R,(function(t){f.debug("Received request: "+JSON.stringify(t));try{var n=e.rpc[t.method];void 0===n?f.error("Method "+t.method+" not registered in client"):n(t.params,t)}catch(e){f.error("Exception processing request: "+JSON.stringify(t)),f.error(e)}}));function _(){f.debug("notReconnectIfNumLessThan = "+v+" (old="+m+")"),m=v}function N(){if(E){var t=null;0!=v&&v!=m||(t={interval:e.heartbeat||5e3}),v++,n.send("ping",t,(r=v,function(e,t){e&&(f.debug("Error in ping request #"+r+" ("+e.message+")"),r>m&&(E=!1,_(),f.debug("Server did not respond to ping message #"+r+". Reconnecting... "),R.reconnectWs()))}))}else f.debug("Trying to send ping, but ping is not enabled");var r}function T(){y||(f.debug("Starting ping (if configured)"),y=!0,null!=e.heartbeat&&(t=setInterval(N,e.heartbeat),N()))}function L(){clearInterval(t),y=!1,E=!1,v=-1,k.cancel()}this.send=function(e,t,n){var r=Date.now();k.encode(e,t,(function(o,c){if(o){try{f.error("ERROR:"+o.message+" in Request: method:"+e+" params:"+JSON.stringify(t)+" request:"+o.request),o.data&&f.error("ERROR DATA:"+JSON.stringify(o.data))}catch(e){}o.requestTime=r}n&&(null!=c&&"pong"!==c.value&&f.debug("Response: "+JSON.stringify(c)),n(o,c))}))},this.close=function(code,e){f.debug("Closing  with code: "+code+" because: "+e),null!=t&&(f.debug("Clearing ping interval"),clearInterval(t)),y=!1,E=!1,R.close(code,e)},this.forceClose=function(e){R.forceClose(e)},this.reconnect=function(){R.reconnectWs()},this.resetPing=function(){E=!0,v=0,T()},this.getReadyState=function(){return R.getReadyState()}}},1266:function(e,t,n){var r=n(1132);t.WebSocketWithReconnection=r},1267:function(e){e.exports=JSON.parse('{"author":"OpenVidu","dependencies":{"freeice":"2.2.2","hark":"1.2.3","jsnlog":"2.30.0","platform":"1.3.6","uuid":"8.3.2","wolfy87-eventemitter":"5.2.9"},"description":"OpenVidu Browser","devDependencies":{"@types/node":"15.12.2","@types/platform":"1.3.3","browserify":"17.0.0","grunt":"1.4.1","grunt-cli":"1.4.3","grunt-contrib-copy":"1.0.0","grunt-contrib-sass":"2.0.0","grunt-contrib-uglify":"5.0.1","grunt-contrib-watch":"1.1.0","grunt-postcss":"0.9.0","grunt-string-replace":"1.3.1","grunt-ts":"6.0.0-beta.22","terser":"5.7.0","tsify":"5.0.4","tslint":"6.1.3","typedoc":"0.19.2","typescript":"4.0.7"},"license":"Apache-2.0","main":"lib/index.js","name":"openvidu-browser","repository":{"type":"git","url":"git://github.com/OpenVidu/openvidu"},"scripts":{"browserify":"VERSION=${VERSION:-dev}; mkdir -p static/js/ && cd src && ../node_modules/browserify/bin/cmd.js Main.ts -p [ tsify ] --exclude kurento-browser-extensions --debug -o ../static/js/openvidu-browser-$VERSION.js -v","browserify-prod":"VERSION=${VERSION:-dev}; mkdir -p static/js/ && cd src && ../node_modules/browserify/bin/cmd.js --debug Main.ts -p [ tsify ] --exclude kurento-browser-extensions | ../node_modules/terser/bin/terser --source-map content=inline --output ../static/js/openvidu-browser-$VERSION.min.js","build":"cd src/OpenVidu && ./../../node_modules/typescript/bin/tsc && cd ../.. && ./node_modules/typescript/bin/tsc --declaration src/index.ts --outDir ./lib --sourceMap --target es5 --lib dom,es5,es2015.promise,scripthost","docs":"./generate-docs.sh"},"types":"lib/index.d.ts","version":"2.21.0-beta1"}')},1333:function(e,t,n){"use strict";var r;n.r(t),n.d(t,"v1",(function(){return w})),n.d(t,"v3",(function(){return L})),n.d(t,"v4",(function(){return M})),n.d(t,"v5",(function(){return V})),n.d(t,"NIL",(function(){return x})),n.d(t,"version",(function(){return B})),n.d(t,"validate",(function(){return l})),n.d(t,"stringify",(function(){return E})),n.d(t,"parse",(function(){return O}));var o=new Uint8Array(16);function c(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(o)}var d=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var l=function(e){return"string"==typeof e&&d.test(e)},h=[],f=0;f<256;++f)h.push((f+256).toString(16).substr(1));var m,v,E=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(h[e[t+0]]+h[e[t+1]]+h[e[t+2]]+h[e[t+3]]+"-"+h[e[t+4]]+h[e[t+5]]+"-"+h[e[t+6]]+h[e[t+7]]+"-"+h[e[t+8]]+h[e[t+9]]+"-"+h[e[t+10]]+h[e[t+11]]+h[e[t+12]]+h[e[t+13]]+h[e[t+14]]+h[e[t+15]]).toLowerCase();if(!l(n))throw TypeError("Stringified UUID is invalid");return n},y=0,S=0;var w=function(e,t,n){var i=t&&n||0,b=t||new Array(16),r=(e=e||{}).node||m,o=void 0!==e.clockseq?e.clockseq:v;if(null==r||null==o){var d=e.random||(e.rng||c)();null==r&&(r=m=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==o&&(o=v=16383&(d[6]<<8|d[7]))}var l=void 0!==e.msecs?e.msecs:Date.now(),h=void 0!==e.nsecs?e.nsecs:S+1,dt=l-y+(h-S)/1e4;if(dt<0&&void 0===e.clockseq&&(o=o+1&16383),(dt<0||l>y)&&void 0===e.nsecs&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");y=l,S=h,v=o;var f=(1e4*(268435455&(l+=122192928e5))+h)%4294967296;b[i++]=f>>>24&255,b[i++]=f>>>16&255,b[i++]=f>>>8&255,b[i++]=255&f;var w=l/4294967296*1e4&268435455;b[i++]=w>>>8&255,b[i++]=255&w,b[i++]=w>>>24&15|16,b[i++]=w>>>16&255,b[i++]=o>>>8|128,b[i++]=255&o;for(var O=0;O<6;++O)b[i+O]=r[O];return t||E(b)};var O=function(e){if(!l(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};var C=function(e,t,n){function r(e,r,o,c){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],i=0;i<e.length;++i)t.push(e.charCodeAt(i));return t}(e)),"string"==typeof r&&(r=O(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var d=new Uint8Array(16+e.length);if(d.set(r),d.set(e,r.length),(d=n(d))[6]=15&d[6]|t,d[8]=63&d[8]|128,o){c=c||0;for(var i=0;i<16;++i)o[c+i]=d[i];return o}return E(d)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r};function I(e){return 14+(e+64>>>9<<4)+1}function R(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function P(q,a,b,e,s,t){return R((n=R(R(a,q),R(e,t)))<<(r=s)|n>>>32-r,b);var n,r}function k(a,b,e,t,n,s,r){return P(b&e|~b&t,a,b,n,s,r)}function _(a,b,e,t,n,s,r){return P(b&t|e&~t,a,b,n,s,r)}function N(a,b,e,t,n,s,r){return P(b^e^t,a,b,n,s,r)}function T(a,b,e,t,n,s,r){return P(e^(b|~t),a,b,n,s,r)}var L=C("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var i=0;i<t.length;++i)e[i]=t.charCodeAt(i)}return function(input){for(var output=[],e=32*input.length,t="0123456789abcdef",i=0;i<e;i+=8){var n=input[i>>5]>>>i%32&255,r=parseInt(t.charAt(n>>>4&15)+t.charAt(15&n),16);output.push(r)}return output}(function(e,t){e[t>>5]|=128<<t%32,e[I(t)-1]=t;for(var a=1732584193,b=-271733879,n=-1732584194,r=271733878,i=0;i<e.length;i+=16){var o=a,c=b,d=n,l=r;a=k(a,b,n,r,e[i],7,-680876936),r=k(r,a,b,n,e[i+1],12,-389564586),n=k(n,r,a,b,e[i+2],17,606105819),b=k(b,n,r,a,e[i+3],22,-1044525330),a=k(a,b,n,r,e[i+4],7,-176418897),r=k(r,a,b,n,e[i+5],12,1200080426),n=k(n,r,a,b,e[i+6],17,-1473231341),b=k(b,n,r,a,e[i+7],22,-45705983),a=k(a,b,n,r,e[i+8],7,1770035416),r=k(r,a,b,n,e[i+9],12,-1958414417),n=k(n,r,a,b,e[i+10],17,-42063),b=k(b,n,r,a,e[i+11],22,-1990404162),a=k(a,b,n,r,e[i+12],7,1804603682),r=k(r,a,b,n,e[i+13],12,-40341101),n=k(n,r,a,b,e[i+14],17,-1502002290),a=_(a,b=k(b,n,r,a,e[i+15],22,1236535329),n,r,e[i+1],5,-165796510),r=_(r,a,b,n,e[i+6],9,-1069501632),n=_(n,r,a,b,e[i+11],14,643717713),b=_(b,n,r,a,e[i],20,-373897302),a=_(a,b,n,r,e[i+5],5,-701558691),r=_(r,a,b,n,e[i+10],9,38016083),n=_(n,r,a,b,e[i+15],14,-660478335),b=_(b,n,r,a,e[i+4],20,-405537848),a=_(a,b,n,r,e[i+9],5,568446438),r=_(r,a,b,n,e[i+14],9,-1019803690),n=_(n,r,a,b,e[i+3],14,-187363961),b=_(b,n,r,a,e[i+8],20,1163531501),a=_(a,b,n,r,e[i+13],5,-1444681467),r=_(r,a,b,n,e[i+2],9,-51403784),n=_(n,r,a,b,e[i+7],14,1735328473),a=N(a,b=_(b,n,r,a,e[i+12],20,-1926607734),n,r,e[i+5],4,-378558),r=N(r,a,b,n,e[i+8],11,-2022574463),n=N(n,r,a,b,e[i+11],16,1839030562),b=N(b,n,r,a,e[i+14],23,-35309556),a=N(a,b,n,r,e[i+1],4,-1530992060),r=N(r,a,b,n,e[i+4],11,1272893353),n=N(n,r,a,b,e[i+7],16,-155497632),b=N(b,n,r,a,e[i+10],23,-1094730640),a=N(a,b,n,r,e[i+13],4,681279174),r=N(r,a,b,n,e[i],11,-358537222),n=N(n,r,a,b,e[i+3],16,-722521979),b=N(b,n,r,a,e[i+6],23,76029189),a=N(a,b,n,r,e[i+9],4,-640364487),r=N(r,a,b,n,e[i+12],11,-421815835),n=N(n,r,a,b,e[i+15],16,530742520),a=T(a,b=N(b,n,r,a,e[i+2],23,-995338651),n,r,e[i],6,-198630844),r=T(r,a,b,n,e[i+7],10,1126891415),n=T(n,r,a,b,e[i+14],15,-1416354905),b=T(b,n,r,a,e[i+5],21,-57434055),a=T(a,b,n,r,e[i+12],6,1700485571),r=T(r,a,b,n,e[i+3],10,-1894986606),n=T(n,r,a,b,e[i+10],15,-1051523),b=T(b,n,r,a,e[i+1],21,-2054922799),a=T(a,b,n,r,e[i+8],6,1873313359),r=T(r,a,b,n,e[i+15],10,-30611744),n=T(n,r,a,b,e[i+6],15,-1560198380),b=T(b,n,r,a,e[i+13],21,1309151649),a=T(a,b,n,r,e[i+4],6,-145523070),r=T(r,a,b,n,e[i+11],10,-1120210379),n=T(n,r,a,b,e[i+2],15,718787259),b=T(b,n,r,a,e[i+9],21,-343485551),a=R(a,o),b=R(b,c),n=R(n,d),r=R(r,l)}return[a,b,n,r]}(function(input){if(0===input.length)return[];for(var e=8*input.length,output=new Uint32Array(I(e)),i=0;i<e;i+=8)output[i>>5]|=(255&input[i/8])<<i%32;return output}(e),8*e.length))}));var M=function(e,t,n){var r=(e=e||{}).random||(e.rng||c)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return E(r)};function D(s,e,t,n){switch(s){case 0:return e&t^~e&n;case 1:case 3:return e^t^n;case 2:return e&t^e&n^t&n}}function A(e,t){return e<<t|e>>>32-t}var V=C("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var i=0;i<r.length;++i)e.push(r.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var o=e.length/4+2,c=Math.ceil(o/16),d=new Array(c),l=0;l<c;++l){for(var h=new Uint32Array(16),f=0;f<16;++f)h[f]=e[64*l+4*f]<<24|e[64*l+4*f+1]<<16|e[64*l+4*f+2]<<8|e[64*l+4*f+3];d[l]=h}d[c-1][14]=8*(e.length-1)/Math.pow(2,32),d[c-1][14]=Math.floor(d[c-1][14]),d[c-1][15]=8*(e.length-1)&4294967295;for(var m=0;m<c;++m){for(var v=new Uint32Array(80),E=0;E<16;++E)v[E]=d[m][E];for(var y=16;y<80;++y)v[y]=A(v[y-3]^v[y-8]^v[y-14]^v[y-16],1);for(var a=n[0],b=n[1],S=n[2],w=n[3],O=n[4],C=0;C<80;++C){var s=Math.floor(C/20),I=A(a,5)+D(s,b,S,w)+O+t[s]+v[C]>>>0;O=w,w=S,S=A(b,30)>>>0,b=a,a=I}n[0]=n[0]+a>>>0,n[1]=n[1]+b>>>0,n[2]=n[2]+S>>>0,n[3]=n[3]+w>>>0,n[4]=n[4]+O>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]})),x="00000000-0000-0000-0000-000000000000";var B=function(e){if(!l(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},424:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},452:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenViduLogger=void 0;var r=n(1119),o=n(1246),c=n(1122),d=function(){function e(){this.JSNLOG_URL="/openvidu/elk/openvidu-browser-logs",this.MAX_JSNLOG_BATCH_LOG_MESSAGES=100,this.MAX_MSECONDS_BATCH_MESSAGES=5e3,this.MAX_LENGTH_STRING_JSON=1e3,this.defaultConsoleLogger=new o.ConsoleLogger(window.console),this.isProdMode=!1,this.isJSNLogSetup=!1}return e.configureJSNLog=function(e,t){var n=this;try{if(window.LOG_JSNLOG_RESULTS||this.instance&&e.isPro&&this.instance.isOpenViduBrowserLogsDebugActive(e)&&this.instance.canConfigureJSNLog(e,this.instance)){e.sendBrowserLogs===c.OpenViduLoggerConfiguration.debug_app&&this.instance.replaceWindowConsole(),this.instance.isJSNLogSetup=!1,this.instance.info("Configuring JSNLogs.");var o=e.finalUserId,d=e.session.sessionId;this.instance.currentAppender=r.JL.createAjaxAppender("appender-"+o+"-"+d),this.instance.currentAppender.setOptions({beforeSend:function(e){var r=e.onreadystatechange;e.onreadystatechange=function(){n.isInvalidResponse(e)&&(Object.defineProperty(e,"readyState",{value:4}),Object.defineProperty(e,"status",{value:200}),n.instance.disableLogger()),r()},e.setRequestHeader("Authorization","Basic "+btoa(o+"%/%"+d+":"+t)),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("OV-Final-User-Id",o),e.setRequestHeader("OV-Session-Id",d),e.setRequestHeader("OV-Token",t)},maxBatchSize:1e3,batchSize:this.instance.MAX_JSNLOG_BATCH_LOG_MESSAGES,batchTimeout:this.instance.MAX_MSECONDS_BATCH_MESSAGES});r.JL.setOptions({defaultAjaxUrl:e.httpUri+this.instance.JSNLOG_URL,serialize:function(e){var t,r=JSON.stringify(e,(t=new WeakSet,function(e,n){if("object"==typeof n&&null!=n){if(t.has(n)||HTMLElement&&n instanceof HTMLElement)return;t.add(n)}return n}));return r.length>n.instance.MAX_LENGTH_STRING_JSON&&(r=r.substring(0,n.instance.MAX_LENGTH_STRING_JSON)+"..."),window.LOG_JSNLOG_RESULTS&&console.log(r),r},enabled:!0}),r.JL().setOptions({appenders:[this.instance.currentAppender]}),this.instance.isJSNLogSetup=!0,this.instance.loggingSessionId=d,this.instance.info("JSNLog configured.")}}catch(e){console.error("Error configuring JSNLog: "),console.error(e),this.instance.disableLogger()}},e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.isInvalidResponse=function(e){return 401==e.status||403==e.status||404==e.status||0==e.status},e.prototype.canConfigureJSNLog=function(e,t){return e.session.sessionId!=t.loggingSessionId},e.prototype.isOpenViduBrowserLogsDebugActive=function(e){return e.sendBrowserLogs===c.OpenViduLoggerConfiguration.debug||e.sendBrowserLogs===c.OpenViduLoggerConfiguration.debug_app},e.prototype.getConsoleWithJSNLog=function(){return e=this,{log:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.defaultConsoleLogger.log.apply(e.defaultConsoleLogger.logger,arguments),e.isJSNLogSetup&&r.JL().info(arguments)},info:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.defaultConsoleLogger.info.apply(e.defaultConsoleLogger.logger,arguments),e.isJSNLogSetup&&r.JL().info(arguments)},debug:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.defaultConsoleLogger.debug.apply(e.defaultConsoleLogger.logger,arguments)},warn:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.defaultConsoleLogger.warn.apply(e.defaultConsoleLogger.logger,arguments),e.isJSNLogSetup&&r.JL().warn(arguments)},error:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.defaultConsoleLogger.error.apply(e.defaultConsoleLogger.logger,arguments),e.isJSNLogSetup&&r.JL().error(arguments)}};var e},e.prototype.replaceWindowConsole=function(){window.console=this.defaultConsoleLogger.logger,window.console.log=this.getConsoleWithJSNLog().log,window.console.info=this.getConsoleWithJSNLog().info,window.console.debug=this.getConsoleWithJSNLog().debug,window.console.warn=this.getConsoleWithJSNLog().warn,window.console.error=this.getConsoleWithJSNLog().error},e.prototype.disableLogger=function(){r.JL.setOptions({enabled:!1}),this.isJSNLogSetup=!1,this.loggingSessionId=void 0,this.currentAppender=void 0,window.console=this.defaultConsoleLogger.logger,window.console.log=this.defaultConsoleLogger.log,window.console.info=this.defaultConsoleLogger.info,window.console.debug=this.defaultConsoleLogger.debug,window.console.warn=this.defaultConsoleLogger.warn,window.console.error=this.defaultConsoleLogger.error},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isProdMode||this.defaultConsoleLogger.log.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&r.JL().info(arguments)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isProdMode||this.defaultConsoleLogger.debug.apply(this.defaultConsoleLogger.logger,arguments)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isProdMode||this.defaultConsoleLogger.info.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&r.JL().info(arguments)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isProdMode||this.defaultConsoleLogger.warn.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&r.JL().warn(arguments)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.defaultConsoleLogger.error.apply(this.defaultConsoleLogger.logger,arguments),this.isJSNLogSetup&&r.JL().error(arguments)},e.prototype.flush=function(){this.isJSNLogSetup&&null!=this.currentAppender&&this.currentAppender.sendBatch()},e.prototype.enableProdMode=function(){this.isProdMode=!0},e}();t.OpenViduLogger=d},473:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Event=void 0;var r=function(){function e(e,t,n){this.hasBeenPrevented=!1,this.cancelable=e,this.target=t,this.type=n}return e.prototype.isDefaultPrevented=function(){return this.hasBeenPrevented},e.prototype.preventDefault=function(){this.callDefaultBehavior=function(){},this.hasBeenPrevented=!0},e}();t.Event=r},527:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=t.ExceptionEvent=t.NetworkQualityLevelChangedEvent=t.FilterEvent=t.ConnectionPropertyChangedEvent=t.StreamPropertyChangedEvent=t.VideoElementEvent=t.StreamManagerEvent=t.StreamEvent=t.SignalEvent=t.SessionDisconnectedEvent=t.RecordingEvent=t.PublisherSpeakingEvent=t.ConnectionEvent=t.Event=t.VideoInsertMode=t.OpenViduError=t.LocalRecorderState=t.Filter=t.LocalRecorder=t.Connection=t.Stream=t.StreamManager=t.Subscriber=t.Publisher=t.Session=t.OpenVidu=void 0;var r=n(1119),o=n(1245);Object.defineProperty(t,"OpenVidu",{enumerable:!0,get:function(){return o.OpenVidu}});var c=n(990);Object.defineProperty(t,"Session",{enumerable:!0,get:function(){return c.Session}});var d=n(1055);Object.defineProperty(t,"Publisher",{enumerable:!0,get:function(){return d.Publisher}});var l=n(1058);Object.defineProperty(t,"Subscriber",{enumerable:!0,get:function(){return l.Subscriber}});var h=n(1059);Object.defineProperty(t,"StreamManager",{enumerable:!0,get:function(){return h.StreamManager}});var f=n(1056);Object.defineProperty(t,"Stream",{enumerable:!0,get:function(){return f.Stream}});var m=n(1123);Object.defineProperty(t,"Connection",{enumerable:!0,get:function(){return m.Connection}});var v=n(1120);Object.defineProperty(t,"LocalRecorder",{enumerable:!0,get:function(){return v.LocalRecorder}});var E=n(1057);Object.defineProperty(t,"Filter",{enumerable:!0,get:function(){return E.Filter}});var y=n(1121);Object.defineProperty(t,"LocalRecorderState",{enumerable:!0,get:function(){return y.LocalRecorderState}});var S=n(804);Object.defineProperty(t,"OpenViduError",{enumerable:!0,get:function(){return S.OpenViduError}});var w=n(991);Object.defineProperty(t,"VideoInsertMode",{enumerable:!0,get:function(){return w.VideoInsertMode}});var O=n(473);Object.defineProperty(t,"Event",{enumerable:!0,get:function(){return O.Event}});var C=n(1125);Object.defineProperty(t,"ConnectionEvent",{enumerable:!0,get:function(){return C.ConnectionEvent}});var I=n(1124);Object.defineProperty(t,"PublisherSpeakingEvent",{enumerable:!0,get:function(){return I.PublisherSpeakingEvent}});var R=n(1127);Object.defineProperty(t,"RecordingEvent",{enumerable:!0,get:function(){return R.RecordingEvent}});var P=n(1064);Object.defineProperty(t,"SessionDisconnectedEvent",{enumerable:!0,get:function(){return P.SessionDisconnectedEvent}});var k=n(1128);Object.defineProperty(t,"SignalEvent",{enumerable:!0,get:function(){return k.SignalEvent}});var _=n(1065);Object.defineProperty(t,"StreamEvent",{enumerable:!0,get:function(){return _.StreamEvent}});var N=n(1062);Object.defineProperty(t,"StreamManagerEvent",{enumerable:!0,get:function(){return N.StreamManagerEvent}});var T=n(1063);Object.defineProperty(t,"VideoElementEvent",{enumerable:!0,get:function(){return T.VideoElementEvent}});var L=n(803);Object.defineProperty(t,"StreamPropertyChangedEvent",{enumerable:!0,get:function(){return L.StreamPropertyChangedEvent}});var M=n(1129);Object.defineProperty(t,"ConnectionPropertyChangedEvent",{enumerable:!0,get:function(){return M.ConnectionPropertyChangedEvent}});var D=n(1126);Object.defineProperty(t,"FilterEvent",{enumerable:!0,get:function(){return D.FilterEvent}});var A=n(1130);Object.defineProperty(t,"NetworkQualityLevelChangedEvent",{enumerable:!0,get:function(){return A.NetworkQualityLevelChangedEvent}});var V=n(966);Object.defineProperty(t,"ExceptionEvent",{enumerable:!0,get:function(){return V.ExceptionEvent}});var x=n(1060);Object.defineProperty(t,"EventDispatcher",{enumerable:!0,get:function(){return x.EventDispatcher}}),r.JL.setOptions({enabled:!1})},568:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformUtils=void 0;var r=n(1247),o=function(){function e(){}return e.getInstance=function(){return this.instance||(this.instance=new e),e.instance},e.prototype.isChromeBrowser=function(){return"Chrome"===r.name},e.prototype.isSafariBrowser=function(){return"Safari"===r.name},e.prototype.isChromeMobileBrowser=function(){return"Chrome Mobile"===r.name},e.prototype.isFirefoxBrowser=function(){return"Firefox"===r.name},e.prototype.isFirefoxMobileBrowser=function(){return"Firefox Mobile"===r.name||"Firefox for iOS"===r.name},e.prototype.isOperaBrowser=function(){return"Opera"===r.name},e.prototype.isOperaMobileBrowser=function(){return"Opera Mobile"===r.name},e.prototype.isEdgeBrowser=function(){var e=(null==r?void 0:r.version)?parseFloat(r.version):-1;return"Microsoft Edge"===r.name&&e>=80},e.prototype.isEdgeMobileBrowser=function(){var e,t,n=(null==r?void 0:r.version)?parseFloat(r.version):-1;return"Microsoft Edge"===r.name&&("Android"===(null===(e=r.os)||void 0===e?void 0:e.family)||"iOS"===(null===(t=r.os)||void 0===t?void 0:t.family))&&n>45},e.prototype.isAndroidBrowser=function(){return"Android Browser"===r.name},e.prototype.isElectron=function(){return"Electron"===r.name},e.prototype.isSamsungBrowser=function(){return"Samsung Internet Mobile"===r.name||"Samsung Internet"===r.name},e.prototype.isIPhoneOrIPad=function(){var e=r.ua?r.ua:navigator.userAgent,t="ontouchend"in document,n=/\b(\w*Macintosh\w*)\b/.test(e)&&t,o=/\b(\w*iPhone\w*)\b/.test(e)&&/\b(\w*Mobile\w*)\b/.test(e)&&t;return n||o},e.prototype.isIOSWithSafari=function(){var e=r.ua?r.ua:navigator.userAgent;return this.isIPhoneOrIPad()&&/\b(\w*Apple\w*)\b/.test(navigator.vendor)&&/\b(\w*Safari\w*)\b/.test(e)&&!/\b(\w*CriOS\w*)\b/.test(e)&&!/\b(\w*FxiOS\w*)\b/.test(e)},e.prototype.isIonicIos=function(){return this.isIPhoneOrIPad()&&-1===r.ua.indexOf("Safari")},e.prototype.isIonicAndroid=function(){return"Android"===r.os.family&&"Android Browser"==r.name},e.prototype.isMobileDevice=function(){return"iOS"===r.os.family||"Android"===r.os.family},e.prototype.isReactNative=function(){return!1},e.prototype.isChromium=function(){return this.isChromeBrowser()||this.isChromeMobileBrowser()||this.isOperaBrowser()||this.isOperaMobileBrowser()||this.isEdgeBrowser()||this.isEdgeMobileBrowser()||this.isSamsungBrowser()||this.isIonicAndroid()||this.isIonicIos()||this.isElectron()},e.prototype.canScreenShare=function(){var e=(null==r?void 0:r.version)?parseFloat(r.version):-1;return!this.isMobileDevice()&&(this.isChromeBrowser()||this.isFirefoxBrowser()||this.isOperaBrowser()||this.isElectron()||this.isEdgeBrowser()||this.isSafariBrowser()&&e>=13)},e.prototype.getName=function(){return r.name||""},e.prototype.getVersion=function(){return r.version||""},e.prototype.getFamily=function(){return r.os.family||""},e.prototype.getDescription=function(){return r.description||""},e}();t.PlatformUtils=o},803:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)});Object.defineProperty(t,"__esModule",{value:!0}),t.StreamPropertyChangedEvent=void 0;var c=function(e){function t(t,n,r,o,c,d){var l=e.call(this,!1,t,"streamPropertyChanged")||this;return l.stream=n,l.changedProperty=r,l.newValue=o,l.oldValue=c,l.reason=d,l}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(n(473).Event);t.StreamPropertyChangedEvent=c},804:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenViduError=t.OpenViduErrorName=void 0,function(e){e.BROWSER_NOT_SUPPORTED="BROWSER_NOT_SUPPORTED",e.DEVICE_ACCESS_DENIED="DEVICE_ACCESS_DENIED",e.DEVICE_ALREADY_IN_USE="DEVICE_ALREADY_IN_USE",e.SCREEN_CAPTURE_DENIED="SCREEN_CAPTURE_DENIED",e.SCREEN_SHARING_NOT_SUPPORTED="SCREEN_SHARING_NOT_SUPPORTED",e.SCREEN_EXTENSION_NOT_INSTALLED="SCREEN_EXTENSION_NOT_INSTALLED",e.SCREEN_EXTENSION_DISABLED="SCREEN_EXTENSION_DISABLED",e.INPUT_VIDEO_DEVICE_NOT_FOUND="INPUT_VIDEO_DEVICE_NOT_FOUND",e.INPUT_AUDIO_DEVICE_NOT_FOUND="INPUT_AUDIO_DEVICE_NOT_FOUND",e.INPUT_AUDIO_DEVICE_GENERIC_ERROR="INPUT_AUDIO_DEVICE_GENERIC_ERROR",e.NO_INPUT_SOURCE_SET="NO_INPUT_SOURCE_SET",e.PUBLISHER_PROPERTIES_ERROR="PUBLISHER_PROPERTIES_ERROR",e.OPENVIDU_PERMISSION_DENIED="OPENVIDU_PERMISSION_DENIED",e.OPENVIDU_NOT_CONNECTED="OPENVIDU_NOT_CONNECTED",e.GENERIC_ERROR="GENERIC_ERROR"}(t.OpenViduErrorName||(t.OpenViduErrorName={}));var r=function(e,t){this.name=e,this.message=t};t.OpenViduError=r},966:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)});Object.defineProperty(t,"__esModule",{value:!0}),t.ExceptionEvent=t.ExceptionEventName=void 0;var c=n(473);!function(e){e.ICE_CANDIDATE_ERROR="ICE_CANDIDATE_ERROR",e.ICE_CONNECTION_FAILED="ICE_CONNECTION_FAILED",e.ICE_CONNECTION_DISCONNECTED="ICE_CONNECTION_DISCONNECTED",e.NO_STREAM_PLAYING_EVENT="NO_STREAM_PLAYING_EVENT"}(t.ExceptionEventName||(t.ExceptionEventName={}));var d=function(e){function t(t,n,r,o,data){var c=e.call(this,!1,t,"exception")||this;return c.name=n,c.origin=r,c.message=o,c.data=data,c}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(c.Event);t.ExceptionEvent=d},990:function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,b){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,b){e.__proto__=b}||function(e,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(e[p]=b[p])},r(e,b)},function(e,b){function t(){this.constructor=e}r(e,b),e.prototype=null===b?Object.create(b):(t.prototype=b.prototype,new t)}),c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,c){function d(e){try{h(r.next(e))}catch(e){c(e)}}function l(e){try{h(r.throw(e))}catch(e){c(e)}}function h(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,l)}h((r=r.apply(e,t||[])).next())}))},d=this&&this.__generator||function(e,body){var t,n,r,g,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return g={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function c(c){return function(d){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(r=2&c[0]?n.return:c[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,c[1])).done)return r;switch(n=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,n=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){o.label=c[1];break}if(6===c[0]&&o.label<r[1]){o.label=r[1],r=c;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(c);break}r[2]&&o.ops.pop(),o.trys.pop();continue}c=body.call(e,o)}catch(e){c=[6,e],n=0}finally{t=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,d])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;var l,h=n(1123),f=n(1057),m=n(1058),v=n(1060),E=n(1125),y=n(1126),S=n(1127),w=n(1064),O=n(1128),C=n(1065),I=n(803),R=n(1129),P=n(1130),k=n(804),_=n(991),N=n(452),T=n(568),L=N.OpenViduLogger.getInstance(),M=function(e){function t(t){var n=e.call(this)||this;return n.streamManagers=[],n.remoteStreamsCreated=new Map,n.remoteConnections=new Map,l=T.PlatformUtils.getInstance(),n.openvidu=t,n}return o(t,e),t.prototype.connect=function(e,t){var n=this;return new Promise((function(r,o){n.processToken(e),n.openvidu.checkSystemRequirements()?(n.options={sessionId:n.sessionId,participantId:e,metadata:t?n.stringClientMetadata(t):""},n.connectAux(e).then((function(){r()})).catch((function(e){o(e)}))):o(new k.OpenViduError(k.OpenViduErrorName.BROWSER_NOT_SUPPORTED,"Browser "+l.getName()+" (version "+l.getVersion()+") for "+l.getFamily()+" is not supported in OpenVidu"))}))},t.prototype.disconnect=function(){this.leave(!1,"disconnect")},t.prototype.subscribe=function(e,t,n,r){var o={};o=n&&"function"!=typeof n?{insertMode:void 0!==n.insertMode?"string"==typeof n.insertMode?_.VideoInsertMode[n.insertMode]:o.insertMode:_.VideoInsertMode.APPEND,subscribeToAudio:void 0===n.subscribeToAudio||n.subscribeToAudio,subscribeToVideo:void 0===n.subscribeToVideo||n.subscribeToVideo}:{insertMode:_.VideoInsertMode.APPEND,subscribeToAudio:!0,subscribeToVideo:!0};var c=void 0;if(n&&"function"==typeof n?c=n:r&&(c=r),!this.sessionConnected())throw void 0!==c&&c(this.notConnectedError()),this.notConnectedError();L.info("Subscribing to "+e.connection.connectionId),e.subscribe().then((function(){L.info("Subscribed correctly to "+e.connection.connectionId),void 0!==c&&c(void 0)})).catch((function(e){void 0!==c&&c(e)}));var d=new m.Subscriber(e,t,o);return d.targetElement&&e.streamManager.createVideoElement(d.targetElement,o.insertMode),d},t.prototype.subscribeAsync=function(e,t,n){var r=this;return new Promise((function(o,c){var d;r.sessionConnected()||c(r.notConnectedError());var l=function(e){e?c(e):o(d)};d=n?r.subscribe(e,t,n,l):r.subscribe(e,t,l)}))},t.prototype.unsubscribe=function(e){var t=this;return new Promise((function(n,r){if(t.sessionConnected()){var o=e.stream.connection.connectionId;L.info("Unsubscribing from "+o),t.openvidu.sendRequest("unsubscribeFromVideo",{sender:e.stream.connection.connectionId},(function(t,c){t?(L.error("Error unsubscribing from "+o),r(t)):(L.info("Unsubscribed correctly from "+o),e.stream.streamManager.removeAllVideos(),e.stream.disposeWebRtcPeer(),e.stream.disposeMediaStream(),n())}))}else r(t.notConnectedError())}))},t.prototype.publish=function(e){var t=this;return new Promise((function(n,r){t.sessionConnected()||r(t.notConnectedError()),e.session=t,e.stream.session=t,e.stream.publishedOnce?e.initialize().then((function(){t.connection.addStream(e.stream),e.reestablishStreamPlayingEvent(),e.stream.publish().then((function(){t.sendVideoData(e,8,!0,5),n()})).catch((function(e){r(e)}))})).catch((function(e){r(e)})):(t.connection.addStream(e.stream),e.stream.publish().then((function(){t.sendVideoData(e,8,!0,5),n()})).catch((function(e){r(e)})))}))},t.prototype.unpublish=function(e){var t=this;return new Promise((function(n,r){if(!t.sessionConnected())throw t.notConnectedError();var o=e.stream;o.connection?o.connection!==t.connection?r(new Error("The associated Connection object of this Publisher is not your local Connection.Only moderators can force unpublish on remote Streams via 'forceUnpublish' method")):(L.info("Unpublishing local media ("+o.connection.connectionId+")"),t.openvidu.sendRequest("unpublishVideo",(function(t,c){if(t)r(t);else{L.info("Media unpublished correctly"),o.disposeWebRtcPeer(),o.connection.stream==o&&delete o.connection.stream;var d=new C.StreamEvent(!0,e,"streamDestroyed",e.stream,"unpublish");e.emitEvent("streamDestroyed",[d]),d.callDefaultBehavior(),n()}}))):r(new Error("The associated Connection object of this Publisher is null"))}))},t.prototype.forceDisconnect=function(e){var t=this;return new Promise((function(n,r){t.sessionConnected()||r(t.notConnectedError()),L.info("Forcing disconnect for connection "+e.connectionId),t.openvidu.sendRequest("forceDisconnect",{connectionId:e.connectionId},(function(t,o){t?(L.error("Error forcing disconnect for Connection "+e.connectionId,t),401===t.code?r(new k.OpenViduError(k.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force a disconnection")):r(t)):(L.info("Forcing disconnect correctly for Connection "+e.connectionId),n())}))}))},t.prototype.forceUnpublish=function(e){var t=this;return new Promise((function(n,r){t.sessionConnected()||r(t.notConnectedError()),L.info("Forcing unpublish for stream "+e.streamId),t.openvidu.sendRequest("forceUnpublish",{streamId:e.streamId},(function(t,o){t?(L.error("Error forcing unpublish for Stream "+e.streamId,t),401===t.code?r(new k.OpenViduError(k.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force an unpublishing")):r(t)):(L.info("Forcing unpublish correctly for Stream "+e.streamId),n())}))}))},t.prototype.signal=function(e){var t=this;return new Promise((function(n,r){t.sessionConnected()||r(t.notConnectedError());var o={};if(e.to&&e.to.length>0){var c=[];e.to.forEach((function(e){e.connectionId&&c.push(e.connectionId)})),o.to=c}else o.to=[];o.data=e.data?e.data:"";var d=e.type?e.type:"signal";d&&"signal:"!==d.substring(0,7)&&(d="signal:"+d),o.type=d,t.openvidu.sendRequest("sendMessage",{message:JSON.stringify(o)},(function(e,t){e?r(e):n()}))}))},t.prototype.on=function(t,n){var r,o,c,d;return e.prototype.onAux.call(this,t,"Event '"+t+"' triggered by 'Session'",n),"publisherStartSpeaking"===t&&(this.remoteConnections.forEach((function(e){var t;(null===(t=e.stream)||void 0===t?void 0:t.hasAudio)&&e.stream.enableHarkSpeakingEvent()})),(null===(o=null===(r=this.connection)||void 0===r?void 0:r.stream)||void 0===o?void 0:o.hasAudio)&&this.connection.stream.enableHarkSpeakingEvent()),"publisherStopSpeaking"===t&&(this.remoteConnections.forEach((function(e){var t;(null===(t=e.stream)||void 0===t?void 0:t.hasAudio)&&e.stream.enableHarkStoppedSpeakingEvent()})),(null===(d=null===(c=this.connection)||void 0===c?void 0:c.stream)||void 0===d?void 0:d.hasAudio)&&this.connection.stream.enableHarkStoppedSpeakingEvent()),this},t.prototype.once=function(t,n){var r,o,c,d;return e.prototype.onceAux.call(this,t,"Event '"+t+"' triggered once by 'Session'",n),"publisherStartSpeaking"===t&&(this.remoteConnections.forEach((function(e){var t;(null===(t=e.stream)||void 0===t?void 0:t.hasAudio)&&e.stream.enableOnceHarkSpeakingEvent()})),(null===(o=null===(r=this.connection)||void 0===r?void 0:r.stream)||void 0===o?void 0:o.hasAudio)&&this.connection.stream.enableOnceHarkSpeakingEvent()),"publisherStopSpeaking"===t&&(this.remoteConnections.forEach((function(e){var t;(null===(t=e.stream)||void 0===t?void 0:t.hasAudio)&&e.stream.enableOnceHarkStoppedSpeakingEvent()})),(null===(d=null===(c=this.connection)||void 0===c?void 0:c.stream)||void 0===d?void 0:d.hasAudio)&&this.connection.stream.enableOnceHarkStoppedSpeakingEvent()),this},t.prototype.off=function(t,n){var r,o,c,d,l=this;return e.prototype.off.call(this,t,n),"publisherStartSpeaking"===t&&(this.anySpeechEventListenerEnabled("publisherStartSpeaking",!1)||(this.remoteConnections.forEach((function(e){var t;(null===(t=e.stream)||void 0===t?void 0:t.streamManager)&&(l.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,e.stream.streamManager)||e.stream.disableHarkSpeakingEvent(!1))})),(null===(o=null===(r=this.connection)||void 0===r?void 0:r.stream)||void 0===o?void 0:o.streamManager)&&(this.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,this.connection.stream.streamManager)||this.connection.stream.disableHarkSpeakingEvent(!1)))),"publisherStopSpeaking"===t&&(this.anySpeechEventListenerEnabled("publisherStopSpeaking",!1)||(this.remoteConnections.forEach((function(e){var t;(null===(t=e.stream)||void 0===t?void 0:t.streamManager)&&(l.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,e.stream.streamManager)||e.stream.disableHarkStoppedSpeakingEvent(!1))})),(null===(d=null===(c=this.connection)||void 0===c?void 0:c.stream)||void 0===d?void 0:d.streamManager)&&(this.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,this.connection.stream.streamManager)||this.connection.stream.disableHarkStoppedSpeakingEvent(!1)))),this},t.prototype.onParticipantJoined=function(e){var t=this;this.getConnection(e.id,"").then((function(e){L.warn("Connection "+e.connectionId+" already exists in connections list")})).catch((function(n){var r=new h.Connection(t,e);t.remoteConnections.set(e.id,r),t.ee.emitEvent("connectionCreated",[new E.ConnectionEvent(!1,t,"connectionCreated",r,"")])}))},t.prototype.onParticipantLeft=function(e){var t=this;this.getRemoteConnection(e.connectionId,"onParticipantLeft").then((function(n){if(n.stream){var r=n.stream,o=new C.StreamEvent(!0,t,"streamDestroyed",r,e.reason);t.ee.emitEvent("streamDestroyed",[o]),o.callDefaultBehavior(),t.remoteStreamsCreated.delete(r.streamId)}t.remoteConnections.delete(n.connectionId),t.ee.emitEvent("connectionDestroyed",[new E.ConnectionEvent(!1,t,"connectionDestroyed",n,e.reason)])})).catch((function(e){L.error(e)}))},t.prototype.onParticipantPublished=function(e){var t,n=this,r=function(e){n.remoteConnections.set(e.connectionId,e),n.remoteStreamsCreated.get(e.stream.streamId)||n.ee.emitEvent("streamCreated",[new C.StreamEvent(!1,n,"streamCreated",e.stream,"")]),n.remoteStreamsCreated.set(e.stream.streamId,!0)};this.getRemoteConnection(e.id,"onParticipantPublished").then((function(n){t=n,e.metadata=n.data,t.remoteOptions=e,t.initRemoteStreams(e.streams),r(t)})).catch((function(o){t=new h.Connection(n,e),r(t)}))},t.prototype.onParticipantUnpublished=function(e){var t=this;e.connectionId===this.connection.connectionId?this.stopPublisherStream(e.reason):this.getRemoteConnection(e.connectionId,"onParticipantUnpublished").then((function(n){var r=new C.StreamEvent(!0,t,"streamDestroyed",n.stream,e.reason);t.ee.emitEvent("streamDestroyed",[r]),r.callDefaultBehavior();var o=n.stream.streamId;t.remoteStreamsCreated.delete(o),n.removeStream(o)})).catch((function(e){L.error(e)}))},t.prototype.onParticipantEvicted=function(e){e.connectionId===this.connection.connectionId&&this.sessionId&&!this.connection.disposed&&this.leave(!0,e.reason)},t.prototype.onNewMessage=function(e){var t=this;L.info("New signal: "+JSON.stringify(e));var n=e.type?e.type.replace(/^(signal:)/,""):void 0;e.from?this.getConnection(e.from,"Connection '"+e.from+"' unknown when 'onNewMessage'. Existing remote connections: "+JSON.stringify(this.remoteConnections.keys())+". Existing local connection: "+this.connection.connectionId).then((function(r){t.ee.emitEvent("signal",[new O.SignalEvent(t,n,e.data,r)]),e.type&&"signal"!==e.type&&t.ee.emitEvent(e.type,[new O.SignalEvent(t,n,e.data,r)])})).catch((function(e){L.error(e)})):(this.ee.emitEvent("signal",[new O.SignalEvent(this,n,e.data,void 0)]),e.type&&"signal"!==e.type&&this.ee.emitEvent(e.type,[new O.SignalEvent(this,n,e.data,void 0)]))},t.prototype.onStreamPropertyChanged=function(e){var t=this,n=function(n){if(n.stream&&n.stream.streamId===e.streamId){var r=n.stream,o=void 0;switch(e.property){case"audioActive":o=r.audioActive,e.newValue="true"===e.newValue,r.audioActive=e.newValue;break;case"videoActive":o=r.videoActive,e.newValue="true"===e.newValue,r.videoActive=e.newValue;break;case"videoDimensions":o=r.videoDimensions,e.newValue=JSON.parse(JSON.parse(e.newValue)),r.videoDimensions=e.newValue;break;case"filter":o=r.filter,e.newValue=Object.keys(e.newValue).length>0?e.newValue:void 0,void 0!==e.newValue?(r.filter=new f.Filter(e.newValue.type,e.newValue.options),r.filter.stream=r,e.newValue.lastExecMethod&&(r.filter.lastExecMethod=e.newValue.lastExecMethod)):delete r.filter,e.newValue=r.filter}t.ee.emitEvent("streamPropertyChanged",[new I.StreamPropertyChangedEvent(t,r,e.property,e.newValue,o,e.reason)]),r.streamManager&&r.streamManager.emitEvent("streamPropertyChanged",[new I.StreamPropertyChangedEvent(r.streamManager,r,e.property,e.newValue,o,e.reason)])}else L.error("No stream with streamId '"+e.streamId+"' found for connection '"+e.connectionId+"' on 'streamPropertyChanged' event")};e.connectionId===this.connection.connectionId?n(this.connection):this.getRemoteConnection(e.connectionId,"onStreamPropertyChanged").then((function(e){n(e)})).catch((function(e){L.error(e)}))},t.prototype.onConnectionPropertyChanged=function(e){var t;switch(e.property){case"role":t=this.connection.role.slice(),this.connection.role=e.newValue,this.connection.localOptions.role=e.newValue;break;case"record":t=this.connection.record,e.newValue="true"===e.newValue,this.connection.record=e.newValue,this.connection.localOptions.record=e.newValue}this.ee.emitEvent("connectionPropertyChanged",[new R.ConnectionPropertyChangedEvent(this,this.connection,e.property,e.newValue,t)])},t.prototype.onNetworkQualityLevelChangedChanged=function(e){var t=this;e.connectionId===this.connection.connectionId?this.ee.emitEvent("networkQualityLevelChanged",[new P.NetworkQualityLevelChangedEvent(this,e.newValue,e.oldValue,this.connection)]):this.getConnection(e.connectionId,"Connection not found for connectionId "+e.connectionId).then((function(n){t.ee.emitEvent("networkQualityLevelChanged",[new P.NetworkQualityLevelChangedEvent(t,e.newValue,e.oldValue,n)])})).catch((function(e){L.error(e)}))},t.prototype.recvIceCandidate=function(e){var t={candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex,component:null,foundation:null,port:null,priority:null,protocol:null,relatedAddress:null,relatedPort:null,tcpType:null,usernameFragment:null,type:null,toJSON:function(){return{candidate:e.candidate}}};this.getConnection(e.senderConnectionId,"Connection not found for connectionId "+e.senderConnectionId+" owning endpoint "+e.endpointName+". Ice candidate will be ignored: "+t).then((function(n){var r=n.stream;r.getWebRtcPeer().addIceCandidate(t).catch((function(t){L.error("Error adding candidate for "+r.streamId+" stream of endpoint "+e.endpointName+": "+t)}))})).catch((function(e){L.error(e)}))},t.prototype.onSessionClosed=function(e){L.info("Session closed: "+JSON.stringify(e));var s=e.sessionId;void 0!==s?this.ee.emitEvent("session-closed",[{session:s}]):L.warn("Session undefined on session closed",e)},t.prototype.onLostConnection=function(e){L.warn("Lost connection in Session "+this.sessionId),this.sessionId&&this.connection&&!this.connection.disposed&&this.leave(!0,e)},t.prototype.onRecoveredConnection=function(){L.info("Recovered connection in Session "+this.sessionId),this.reconnectBrokenStreams(),this.ee.emitEvent("reconnected",[])},t.prototype.onMediaError=function(e){L.error("Media error: "+JSON.stringify(e));var t=e.error;t?this.ee.emitEvent("error-media",[{error:t}]):L.warn("Received undefined media error:",e)},t.prototype.onRecordingStarted=function(e){this.ee.emitEvent("recordingStarted",[new S.RecordingEvent(this,"recordingStarted",e.id,e.name)])},t.prototype.onRecordingStopped=function(e){this.ee.emitEvent("recordingStopped",[new S.RecordingEvent(this,"recordingStopped",e.id,e.name,e.reason)])},t.prototype.onFilterEventDispatched=function(e){var t=this,n=e.connectionId;this.getConnection(n,"No connection found for connectionId "+n).then((function(n){var r;L.info("Filter event dispatched");var o=n.stream;null===(r=o.filter.handlers.get(e.eventType))||void 0===r||r.call(t,new y.FilterEvent(o.filter,e.eventType,e.data))}))},t.prototype.onForciblyReconnectSubscriber=function(e){var t=this;return new Promise((function(n,r){t.getRemoteConnection(e.connectionId,"onForciblyReconnectSubscriber").then((function(o){if(o.stream&&o.stream.streamId===e.streamId){var c=o.stream;if(c.setupReconnectionEventEmitter(n,r)){if(null!=c.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent)c.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent=e,r("Ongoing forced subscriber reconnection");else{c.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent=e;var d=function(){var e=c.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent;delete c.reconnectionEventEmitter.onForciblyReconnectSubscriberLastEvent,t.onForciblyReconnectSubscriber(e)};c.reconnectionEventEmitter.once("success",(function(){d()})),c.reconnectionEventEmitter.once("error",(function(){d()}))}return}c.completeWebRtcPeerReceive(!0,!0,e.sdpOffer).then((function(){return c.finalResolveForSubscription(!0,n)})).catch((function(t){return c.finalRejectForSubscription(!0,"Error while forcibly reconnecting remote stream "+e.streamId+": "+t.toString(),r)}))}else{var l="No stream with streamId '"+e.streamId+"' found for connection '"+e.connectionId+"' on 'streamPropertyChanged' event";L.error(l),r(l)}})).catch((function(e){L.error(e),r(e)}))}))},t.prototype.reconnectBrokenStreams=function(){L.info("Re-establishing media connections...");var e=!1;this.connection.stream&&this.connection.stream.streamIceConnectionStateBroken()&&(L.warn("Re-establishing Publisher "+this.connection.stream.streamId),this.connection.stream.initWebRtcPeerSend(!0),e=!0),this.remoteConnections.forEach((function(t){t.stream&&t.stream.streamIceConnectionStateBroken()&&(L.warn("Re-establishing Subscriber "+t.stream.streamId),t.stream.initWebRtcPeerReceive(!0),e=!0)})),e||L.info("There were no media streams in need of a reconnection")},t.prototype.emitEvent=function(e,t){this.ee.emitEvent(e,t)},t.prototype.leave=function(e,t){var n=this;if(e=!!e,L.info("Leaving Session (forced="+e+")"),this.stopVideoDataIntervals(),this.connection){if(this.connection.disposed||e?this.openvidu.closeWs():this.openvidu.sendRequest("leaveRoom",(function(e,t){e&&L.error("leaveRoom error: "+JSON.stringify(e)),n.openvidu.closeWs()})),this.stopPublisherStream(t),!this.connection.disposed){var r=new w.SessionDisconnectedEvent(this,t);this.ee.emitEvent("sessionDisconnected",[r]),r.callDefaultBehavior()}}else L.warn("You were not connected to the session "+this.sessionId);L.flush()},t.prototype.initializeParams=function(e){return{token:e||"",session:this.sessionId,platform:l.getDescription()?l.getDescription():"unknown",metadata:this.options.metadata?this.options.metadata:"",secret:this.openvidu.getSecret(),recorder:this.openvidu.getRecorder()}},t.prototype.sendVideoData=function(e,t,n,r){var o,h,f=this;if(void 0===t&&(t=1),void 0===n&&(n=!1),void 0===r&&(r=1),l.isChromeBrowser()||l.isChromeMobileBrowser()||l.isOperaBrowser()||l.isOperaMobileBrowser()||l.isEdgeBrowser()||l.isEdgeMobileBrowser()||l.isElectron()||l.isSafariBrowser()&&!l.isIonicIos()||l.isAndroidBrowser()||l.isSamsungBrowser()||l.isIonicAndroid()||l.isIOSWithSafari()){var m=function(){return c(f,void 0,void 0,(function(){var t,n,r;return d(this,(function(o){switch(o.label){case 0:return"connected"!==(t=e.stream.getRTCPeerConnection()).connectionState?[3,2]:[4,t.getStats()];case 1:n=o.sent(),r=[],n.forEach((function(e){"frameWidth"in e&&"frameHeight"in e&&0===r.length&&r.push(e)})),r.length>0&&this.openvidu.sendRequest("videoData",{height:r[0].frameHeight,width:r[0].frameWidth,videoActive:null!=e.stream.videoActive&&e.stream.videoActive,audioActive:null!=e.stream.audioActive&&e.stream.audioActive},(function(e,t){e&&L.error("Error sending 'videoData' event",e)})),o.label=2;case 2:return[2]}}))}))};if(n){var v=1;this.videoDataInterval=setInterval((function(){v<r?(v++,m()):clearInterval(f.videoDataInterval)}),1e3*t)}else this.videoDataTimeout=setTimeout(m,1e3*t)}else l.isFirefoxBrowser()||l.isFirefoxMobileBrowser()||l.isIonicIos()||l.isReactNative()?this.openvidu.sendRequest("videoData",{height:(null===(o=e.stream.videoDimensions)||void 0===o?void 0:o.height)||0,width:(null===(h=e.stream.videoDimensions)||void 0===h?void 0:h.width)||0,videoActive:null!=e.stream.videoActive&&e.stream.videoActive,audioActive:null!=e.stream.audioActive&&e.stream.audioActive},(function(e,t){e&&L.error("Error sending 'videoData' event",e)})):L.error("Browser "+l.getName()+" (version "+l.getVersion()+") for "+l.getFamily()+" is not supported in OpenVidu for Network Quality")},t.prototype.sessionConnected=function(){return null!=this.connection},t.prototype.notConnectedError=function(){return new k.OpenViduError(k.OpenViduErrorName.OPENVIDU_NOT_CONNECTED,"There is no connection to the session. Method 'Session.connect' must be successfully completed first")},t.prototype.anySpeechEventListenerEnabled=function(e,t,n){var r=this.ee.getListeners(e);if(t&&(r=r.filter((function(e){return e.once}))),r.length>0)return!0;var o=0;if(n){var c=n.ee.getListeners(e);t&&(c=c.filter((function(e){return e.once}))),o=c.length}return o>0},t.prototype.connectAux=function(e){var t=this;return new Promise((function(n,r){t.openvidu.startWs((function(o){if(o)r(o);else{var c=t.initializeParams(e);t.openvidu.sendRequest("joinRoom",c,(function(o,c){if(o)r(o);else{t.processJoinRoomResponse(c),N.OpenViduLogger.configureJSNLog(t.openvidu,e),t.connection=new h.Connection(t,c);var d={connections:new Array,streams:new Array};c.value.forEach((function(e){var n=new h.Connection(t,e);t.remoteConnections.set(n.connectionId,n),d.connections.push(n),n.stream&&(t.remoteStreamsCreated.set(n.stream.streamId,!0),d.streams.push(n.stream))})),t.ee.emitEvent("connectionCreated",[new E.ConnectionEvent(!1,t,"connectionCreated",t.connection,"")]),d.connections.forEach((function(e){t.ee.emitEvent("connectionCreated",[new E.ConnectionEvent(!1,t,"connectionCreated",e,"")])})),d.streams.forEach((function(e){t.ee.emitEvent("streamCreated",[new C.StreamEvent(!1,t,"streamCreated",e,"")])})),n()}}))}}))}))},t.prototype.stopPublisherStream=function(e){this.connection.stream&&(this.connection.stream.disposeWebRtcPeer(),this.connection.stream.isLocalStreamPublished&&this.connection.stream.ee.emitEvent("local-stream-destroyed",[e]))},t.prototype.stopVideoDataIntervals=function(){clearInterval(this.videoDataInterval),clearTimeout(this.videoDataTimeout)},t.prototype.stringClientMetadata=function(e){return"string"!=typeof e?JSON.stringify(e):e},t.prototype.getConnection=function(e,t){var n=this;return new Promise((function(r,o){var c=n.remoteConnections.get(e);c?r(c):n.connection.connectionId===e?r(n.connection):o(new k.OpenViduError(k.OpenViduErrorName.GENERIC_ERROR,t))}))},t.prototype.getRemoteConnection=function(e,t){var n=this;return new Promise((function(r,o){var c=n.remoteConnections.get(e);if(c)r(c);else{var d="Remote connection "+e+" unknown when '"+t+"'. Existing remote connections: "+JSON.stringify(n.remoteConnections.keys());o(new k.OpenViduError(k.OpenViduErrorName.GENERIC_ERROR,d))}}))},t.prototype.processToken=function(e){var t=e.match(/^(wss?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var n={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7]},r=e.split("?"),o=decodeURI(r[1]).split("&").map((function(param){return param.split("=")})).reduce((function(e,t){var n=t[0],r=t[1];return e[n]=r,e}),{});this.sessionId=o.sessionId;var c=o.secret,d=o.recorder,l=o.webrtcStatsInterval,h=o.sendBrowserLogs;c&&(this.openvidu.secret=c),d&&(this.openvidu.recorder=!0),l&&(this.openvidu.webrtcStatsInterval=+l),h&&(this.openvidu.sendBrowserLogs=h),this.openvidu.isPro=!!l&&!!h,this.openvidu.wsUri="wss://"+n.host+"/openvidu",this.openvidu.httpUri="https://"+n.host}else L.error('Token "'+e+'" is not valid')},t.prototype.processJoinRoomResponse=function(e){if(this.sessionId=e.session,null!=e.coturnIp&&null!=e.coturnPort&&null!=e.turnUsername&&null!=e.turnCredential){var t="turn:"+e.coturnIp+":"+e.coturnPort;this.openvidu.iceServers=[{urls:[t],username:e.turnUsername,credential:e.turnCredential}],L.log("STUN/TURN server IP: "+e.coturnIp),L.log("TURN temp credentials ["+e.turnUsername+":"+e.turnCredential+"]")}this.openvidu.role=e.role,this.openvidu.finalUserId=e.finalUserId,this.openvidu.mediaServer=e.mediaServer,this.capabilities={subscribe:!0,publish:"SUBSCRIBER"!==this.openvidu.role,forceUnpublish:"MODERATOR"===this.openvidu.role,forceDisconnect:"MODERATOR"===this.openvidu.role},L.info("openvidu-server version: "+e.version),null!=e.life&&(this.openvidu.life=e.life),e.version!==this.openvidu.libraryVersion&&L.warn("OpenVidu Server ("+e.version+") and OpenVidu Browser ("+this.openvidu.libraryVersion+") versions do NOT match. There may be incompatibilities")},t}(v.EventDispatcher);t.Session=M},991:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VideoInsertMode=void 0,function(e){e.AFTER="AFTER",e.APPEND="APPEND",e.BEFORE="BEFORE",e.PREPEND="PREPEND",e.REPLACE="REPLACE"}(t.VideoInsertMode||(t.VideoInsertMode={}))}}]);